<!DOCTYPE html>
<html lang="en"><head><title>How to use a Raspberry Pi 4B as hacking accessory</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto Sans Mono&amp;family=Noto Sans:wght@400;700&amp;family=Noto Sans:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="How to use a Raspberry Pi 4B as hacking accessory"/><meta property="og:description" content="This guide will cover setting up Kali Linux on a Raspberry Pi 4B so that: It can be used as a USB C “gadget” with an iPad Pro (or similar device); All files except for /boot are encrypted; A full desktop environment is available on demand via RDP; and The system still works as a desktop device in a pinch (BYO keyboard, ..."/><meta property="og:image" content="https://cardboard-iguana.com/grimoire/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="This guide will cover setting up Kali Linux on a Raspberry Pi 4B so that: It can be used as a USB C “gadget” with an iPad Pro (or similar device); All files except for /boot are encrypted; A full desktop environment is available on demand via RDP; and The system still works as a desktop device in a pinch (BYO keyboard, ..."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="spellbook/how-to-use-a-raspberry-pi-4b-as-hacking-accessory"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title"><a href="..">Cardboard Iguana Security</a></h1><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>Search</p><div></div><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><div class="explorer desktop-only"><button type="button" id="explorer" data-behavior="collapse" data-collapsed="open" data-savestate="true" data-tree="[{&quot;path&quot;:&quot;commentaries&quot;,&quot;collapsed&quot;:false},{&quot;path&quot;:&quot;spellbook&quot;,&quot;collapsed&quot;:false},{&quot;path&quot;:&quot;spells&quot;,&quot;collapsed&quot;:false},{&quot;path&quot;:&quot;tales&quot;,&quot;collapsed&quot;:false}]"><h1>Explorer</h1><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-content"><ul class="overflow" id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="commentaries"><button class="folder-button"><span class="folder-title">Commentaries</span></button></div></div><div class="folder-outer open"><ul style="padding-left:1.4rem;" class="content" data-folderul="commentaries"><li><a href="../commentaries/2022-08-15-notes-from-hope-and-def-con" data-for="commentaries/2022-08-15-notes-from-hope-and-def-con">Notes from HOPE and DEF CON</a></li><li><a href="../commentaries/2022-11-27-trying-and-failing-to-deploy-a-smart-contract-using-an-ipad-pro" data-for="commentaries/2022-11-27-trying-and-failing-to-deploy-a-smart-contract-using-an-ipad-pro">Trying (and failing) to deploy a smart contract using an iPad Pro</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="spellbook"><button class="folder-button"><span class="folder-title">Spellbook</span></button></div></div><div class="folder-outer open"><ul style="padding-left:1.4rem;" class="content" data-folderul="spellbook"><li><a href="../spellbook/admin-like-windows-permissions" data-for="spellbook/admin-like-windows-permissions">Admin-like Windows permissions</a></li><li><a href="../spellbook/aix" data-for="spellbook/aix">AIX</a></li><li><a href="../spellbook/arp" data-for="spellbook/arp">ARP</a></li><li><a href="../spellbook/as-rep-roasting" data-for="spellbook/as-rep-roasting">AS-REP roasting</a></li><li><a href="../spellbook/bash" data-for="spellbook/bash">Bash</a></li><li><a href="../spellbook/burp-suite" data-for="spellbook/burp-suite">Burp Suite</a></li><li><a href="../spellbook/certutil" data-for="spellbook/certutil">certutil</a></li><li><a href="../spellbook/cifs" data-for="spellbook/cifs">CIFS</a></li><li><a href="../spellbook/cisco-ios" data-for="spellbook/cisco-ios">Cisco IOS</a></li><li><a href="../spellbook/classic-windows-login-and-lock-screen-hacks" data-for="spellbook/classic-windows-login-and-lock-screen-hacks">Classic Windows login and lock screen hacks</a></li><li><a href="../spellbook/common-ipv4-addresses" data-for="spellbook/common-ipv4-addresses">Common IPv4 addresses</a></li><li><a href="../spellbook/xss-attacks" data-for="spellbook/xss-attacks">Cross-site scripting (XSS) attacks</a></li><li><a href="../spellbook/custom-rules-in-john-the-ripper" data-for="spellbook/custom-rules-in-john-the-ripper">Custom rules in John the Ripper</a></li><li><a href="../spellbook/evil-winrm" data-for="spellbook/evil-winrm">Evil-WinRM</a></li><li><a href="../spellbook/ffmpeg" data-for="spellbook/ffmpeg">ffmpeg</a></li><li><a href="../spellbook/find" data-for="spellbook/find">find</a></li><li><a href="../spellbook/find-file-metadata-flags" data-for="spellbook/find-file-metadata-flags">find file metadata flags</a></li><li><a href="../spellbook/ftp" data-for="spellbook/ftp">FTP (protocol)</a></li><li><a href="../spellbook/fuff" data-for="spellbook/fuff">fuff</a></li><li><a href="../spellbook/gdb" data-for="spellbook/gdb">gdb</a></li><li><a href="../spellbook/gemini-compatible-markdown" data-for="spellbook/gemini-compatible-markdown">“Gemini compatible” Markdown</a></li><li><a href="../spellbook/get-winevent" data-for="spellbook/get-winevent">Get-WinEvent</a></li><li><a href="../spellbook/get-winevent-filterhashtable" data-for="spellbook/get-winevent-filterhashtable">Get-WinEvent FilterHashtable</a></li><li><a href="../spellbook/hashcat" data-for="spellbook/hashcat">Hashcat</a></li><li><a href="../spellbook/how-to-automate-netlify-builds-with-ifttt" data-for="spellbook/how-to-automate-netlify-builds-with-ifttt">How to automate Netlify builds with IFTTT</a></li><li><a href="../spellbook/how-to-bypass-the-powershell-execution-policy" data-for="spellbook/how-to-bypass-the-powershell-execution-policy">How to bypass the PowerShell execution policy</a></li><li><a href="../spellbook/how-to-compact-vm-disk-images" data-for="spellbook/how-to-compact-vm-disk-images">How to compact VM disk images</a></li><li><a href="../spellbook/how-to-create-a-gpg-key-with-ssh-support" data-for="spellbook/how-to-create-a-gpg-key-with-ssh-support">How to create a GPG Key (with SSH support!)</a></li><li><a href="../spellbook/how-to-disable-amsi" data-for="spellbook/how-to-disable-amsi">How to disable AMSI</a></li><li><a href="../spellbook/how-to-exploit-python-pickles" data-for="spellbook/how-to-exploit-python-pickles">How to exploit Python pickles</a></li><li><a href="../spellbook/how-to-exploit-windows-services" data-for="spellbook/how-to-exploit-windows-services">How to exploit Windows services</a></li><li><a href="../spellbook/how-to-exploit-windows-tasks" data-for="spellbook/how-to-exploit-windows-tasks">How to exploit Windows tasks</a></li><li><a href="../spellbook/how-to-get-an-ssl-certificate" data-for="spellbook/how-to-get-an-ssl-certificate">How to get an SSL certificate</a></li><li><a href="../spellbook/how-to-load-a-shell-with-a-simple-executable" data-for="spellbook/how-to-load-a-shell-with-a-simple-executable">How to load a shell with a simple executable</a></li><li><a href="../spellbook/how-to-manipulate-local-windows-services" data-for="spellbook/how-to-manipulate-local-windows-services">How to manipulate local Windows services</a></li><li><a href="../spellbook/how-to-manipulate-local-windows-tasks" data-for="spellbook/how-to-manipulate-local-windows-tasks">How to manipulate local Windows tasks</a></li><li><a href="../spellbook/how-to-manipulate-remote-windows-services" data-for="spellbook/how-to-manipulate-remote-windows-services">How to manipulate remote Windows services</a></li><li><a href="../spellbook/how-to-match-files-to-packages" data-for="spellbook/how-to-match-files-to-packages">How to match files to packages</a></li><li><a href="../spellbook/how-to-remotely-install-a-windows-package-with-powershell" data-for="spellbook/how-to-remotely-install-a-windows-package-with-powershell">How to remotely install a Windows package with PowerShell</a></li><li><a href="../spellbook/how-to-remove-duplicate-lines-in-bash" data-for="spellbook/how-to-remove-duplicate-lines-in-bash">How to remove duplicate lines in Bash</a></li><li><a href="../spellbook/how-to-retrieve-aix-fileset-information" data-for="spellbook/how-to-retrieve-aix-fileset-information">How to retrieve AIX fileset information</a></li><li><a href="../spellbook/how-to-run-a-remote-windows-command-using-powershell" data-for="spellbook/how-to-run-a-remote-windows-command-using-powershell">How to run a remote Windows command using PowerShell</a></li><li><a href="../spellbook/how-to-set-the-PATH-in-a-session" data-for="spellbook/how-to-set-the-PATH-in-a-session">How to set the PATH in a session</a></li><li><a href="../spellbook/how-to-set-up-wmi-in-powershell" data-for="spellbook/how-to-set-up-wmi-in-powershell">How to set up WMI in PowerShell</a></li><li><a href="../spellbook/how-to-use-an-alternate-ssh-key-with-git" data-for="spellbook/how-to-use-an-alternate-ssh-key-with-git">How to use an alternate SSH key with Git</a></li><li><a href="../spellbook/how-to-use-mimikatz-to-dump-kerberos-tickets" data-for="spellbook/how-to-use-mimikatz-to-dump-kerberos-tickets">How to use Mimikatz to dump Kerberos tickets</a></li><li><a href="../spellbook/how-to-use-a-raspberry-pi-4b-as-hacking-accessory" data-for="spellbook/how-to-use-a-raspberry-pi-4b-as-hacking-accessory">How to use a Raspberry Pi 4B as hacking accessory</a></li><li><a href="../spellbook/how-to-use-windows-remote-management" data-for="spellbook/how-to-use-windows-remote-management">How to use Windows Remote Management</a></li><li><a href="../spellbook/html-applications" data-for="spellbook/html-applications">HTML applications</a></li><li><a href="../spellbook/http" data-for="spellbook/http">HTTP</a></li><li><a href="../spellbook/hydra" data-for="spellbook/hydra">Hydra</a></li><li><a href="../spellbook/impacket" data-for="spellbook/impacket">Impacket</a></li><li><a href="../spellbook/invoke-mimikatz" data-for="spellbook/invoke-mimikatz">Invoke-Mimikatz</a></li><li><a href="../spellbook/ios-quirks" data-for="spellbook/ios-quirks">iOS quirks</a></li><li><a href="../spellbook/ios-shortcuts-quirks" data-for="spellbook/ios-shortcuts-quirks">iOS Shortcuts quirks</a></li><li><a href="../spellbook/ipv4" data-for="spellbook/ipv4">IPv4</a></li><li><a href="../spellbook/java" data-for="spellbook/java">Java</a></li><li><a href="../spellbook/john-the-ripper" data-for="spellbook/john-the-ripper">John the Ripper</a></li><li><a href="../spellbook/json-web-tokens" data-for="spellbook/json-web-tokens">JSON Web Tokens (JWTs)</a></li><li><a href="../spellbook/kerberoasting" data-for="spellbook/kerberoasting">Kerberoasting</a></li><li><a href="../spellbook/kerberos" data-for="spellbook/kerberos">Kerberos</a></li><li><a href="../spellbook/kerberos-authentication-process" data-for="spellbook/kerberos-authentication-process">Kerberos authentication process</a></li><li><a href="../spellbook/kerbrute" data-for="spellbook/kerbrute">Kerbrute</a></li><li><a href="../spellbook/linux" data-for="spellbook/linux">Linux</a></li><li><a href="../spellbook/linux-reconnaissance" data-for="spellbook/linux-reconnaissance">Linux reconnaissance</a></li><li><a href="../spellbook/local-file-inclusion-attacks" data-for="spellbook/local-file-inclusion-attacks">Local file inclusion (LFI) attacks</a></li><li><a href="../spellbook/local-port-forwarding-with-ssh" data-for="spellbook/local-port-forwarding-with-ssh">Local port forwarding with SSH</a></li><li><a href="../spellbook/metasploit" data-for="spellbook/metasploit">Metasploit</a></li><li><a href="../spellbook/metasploit-module-usage-basics" data-for="spellbook/metasploit-module-usage-basics">Metasploit module usage basics</a></li><li><a href="../spellbook/meterpreter" data-for="spellbook/meterpreter">meterpreter</a></li><li><a href="../spellbook/mimikatz" data-for="spellbook/mimikatz">Mimikatz</a></li><li><a href="../spellbook/msfconsole" data-for="spellbook/msfconsole">msfconsole</a></li><li><a href="../spellbook/msfvenom" data-for="spellbook/msfvenom">msfvenom</a></li><li><a href="../spellbook/ms-sql" data-for="spellbook/ms-sql">MS SQL</a></li><li><a href="../spellbook/netcat" data-for="spellbook/netcat">ncat</a></li><li><a href="../spellbook/net" data-for="spellbook/net">net</a></li><li><a href="../spellbook/netcat-reverse-shells" data-for="spellbook/netcat-reverse-shells">netcat reverse shells</a></li><li><a href="../spellbook/nfs" data-for="spellbook/nfs">NFS</a></li><li><a href="../spellbook/nmap" data-for="spellbook/nmap">Nmap</a></li><li><a href="../spellbook/nmap-flags" data-for="spellbook/nmap-flags">Nmap flags</a></li><li><a href="../spellbook/ntlm-hashes" data-for="spellbook/ntlm-hashes">NTLM hashes</a></li><li><a href="../spellbook/owasp-zap" data-for="spellbook/owasp-zap">OWASP ZAP</a></li><li><a href="../spellbook/php" data-for="spellbook/php">PHP</a></li><li><a href="../spellbook/php-local-file-inclusion-attacks" data-for="spellbook/php-local-file-inclusion-attacks">PHP local file inclusion attacks</a></li><li><a href="../spellbook/poison-null-byte-attack" data-for="spellbook/poison-null-byte-attack">Poison null byte attack</a></li><li><a href="../spellbook/polkit" data-for="spellbook/polkit">Polkit</a></li><li><a href="../spellbook/powercat" data-for="spellbook/powercat">Powercat</a></li><li><a href="../spellbook/powershell" data-for="spellbook/powershell">PowerShell</a></li><li><a href="../spellbook/powerview" data-for="spellbook/powerview">PowerView</a></li><li><a href="../spellbook/python" data-for="spellbook/python">Python</a></li><li><a href="../spellbook/rubeus" data-for="spellbook/rubeus">Rubeus</a></li><li><a href="../spellbook/server-configuration-data-ipv4-address" data-for="spellbook/server-configuration-data-ipv4-address">Server donfiguration data IPv4 address</a></li><li><a href="../spellbook/sip" data-for="spellbook/sip">SIP</a></li><li><a href="../spellbook/sip-methods" data-for="spellbook/sip-methods">SIP methods</a></li><li><a href="../spellbook/smbclient" data-for="spellbook/smbclient">smbclient</a></li><li><a href="../spellbook/socat" data-for="spellbook/socat">socat</a></li><li><a href="../spellbook/sql-injection-attacks" data-for="spellbook/sql-injection-attacks">SQL injection attacks</a></li><li><a href="../spellbook/ssh" data-for="spellbook/ssh">SSH</a></li><li><a href="../spellbook/tcp" data-for="spellbook/tcp">TCP</a></li><li><a href="../spellbook/tcp-headers" data-for="spellbook/tcp-headers">TCP headers</a></li><li><a href="../spellbook/tcp-model" data-for="spellbook/tcp-model">TCP model</a></li><li><a href="../spellbook/unix-permissions" data-for="spellbook/unix-permissions">UNIX permissions</a></li><li><a href="../spellbook/useful-scripts-for-windows-reconnaissance" data-for="spellbook/useful-scripts-for-windows-reconnaissance">Useful scripts for Windows reconnaissance</a></li><li><a href="../spellbook/vim" data-for="spellbook/vim">ViM</a></li><li><a href="../spellbook/visual-basic" data-for="spellbook/visual-basic">Visual Basic</a></li><li><a href="../spellbook/visual-basic-for-applications" data-for="spellbook/visual-basic-for-applications">Visual Basic for Applications</a></li><li><a href="../spellbook/windows" data-for="spellbook/windows">Windows</a></li><li><a href="../spellbook/windows-event-logs" data-for="spellbook/windows-event-logs">Windows event logs</a></li><li><a href="../spellbook/windows-reconnaissance-with-powershell" data-for="spellbook/windows-reconnaissance-with-powershell">Windows reconnaissance with PowerShell</a></li><li><a href="../spellbook/windows-services" data-for="spellbook/windows-services">Windows services</a></li><li><a href="../spellbook/wireshark" data-for="spellbook/wireshark">Wireshark</a></li><li><a href="../spellbook/wmic" data-for="spellbook/wmic">wmic</a></li><li><a href="../spellbook/xxe-attacks" data-for="spellbook/xxe-attacks">XML external entity (XXE) attacks</a></li><li><a href="../spellbook/youtube-dl" data-for="spellbook/youtube-dl">youtube-dl</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="spells"><button class="folder-button"><span class="folder-title">spells</span></button></div></div><div class="folder-outer open"><ul style="padding-left:1.4rem;" class="content" data-folderul="spells"><li><a href="../spells/abusing-wildcard-expansion-in-bash" data-for="spells/abusing-wildcard-expansion-in-bash">Abusing wildcard expansion in Bash</a></li><li><a href="../spells/adding-and-setting-variables-in-ios-shortcuts" data-for="spells/adding-and-setting-variables-in-ios-shortcuts">Adding and setting variables in iOS Shortcuts</a></li><li><a href="../spells/aircrack-ng" data-for="spells/aircrack-ng">Aircrack-NG</a></li><li><a href="../spells/all-in-one-windows-reverse-shell-with-powercat" data-for="spells/all-in-one-windows-reverse-shell-with-powercat">All-in-one Windows reverse shell with Powercat</a></li><li><a href="../spells/arp-scanning" data-for="spells/arp-scanning">ARP scanning</a></li><li><a href="../spells/as-rep-roasting-with-impacket" data-for="spells/as-rep-roasting-with-impacket">AS-REP roasting with Impacket</a></li><li><a href="../spells/as-rep-roasting-with-rubeus" data-for="spells/as-rep-roasting-with-rubeus">AS-REP roasting With Rubeus</a></li><li><a href="../spells/awk" data-for="spells/awk">awk</a></li><li><a href="../spells/basenc" data-for="spells/basenc">basenc</a></li><li><a href="../spells/bash-reverse-shell" data-for="spells/bash-reverse-shell">Bash reverse shell</a></li><li><a href="../spells/bash-scripting" data-for="spells/bash-scripting">Bash scripting</a></li><li><a href="../spells/boolean-based-sqli" data-for="spells/boolean-based-sqli">Boolean-based SQLi</a></li><li><a href="../spells/burp-suite-decoder" data-for="spells/burp-suite-decoder">Burp Suite Decoder</a></li><li><a href="../spells/burp-suite-intruder-battering-ram-attacks" data-for="spells/burp-suite-intruder-battering-ram-attacks">Burp Suite Intruder Battering Ram attacks</a></li><li><a href="../spells/burp-suite-intruder-cluster-bomb-attacks" data-for="spells/burp-suite-intruder-cluster-bomb-attacks">Burp Suite Intruder Cluster Bomb attacks</a></li><li><a href="../spells/burp-suite-intruder-pitchfork-attacks" data-for="spells/burp-suite-intruder-pitchfork-attacks">Burp Suite Intruder Pitchfork attacks</a></li><li><a href="../spells/burp-suite-intruder-sniper-attacks" data-for="spells/burp-suite-intruder-sniper-attacks">Burp Suite Intruder Sniper attacks</a></li><li><a href="../spells/burp-suite-keyboard-shortcuts" data-for="spells/burp-suite-keyboard-shortcuts">Burp Suite keyboard shortcuts</a></li><li><a href="../spells/burp-suite-macros" data-for="spells/burp-suite-macros">Burp Suite macros</a></li><li><a href="../spells/cat" data-for="spells/cat">cat</a></li><li><a href="../spells/cewl" data-for="spells/cewl">cewl</a></li><li><a href="../spells/cifs-reconnaissance-with-nmap" data-for="spells/cifs-reconnaissance-with-nmap">CIFS reconnaissance with Nmap</a></li><li><a href="../spells/cisco-ios-general-configuration-commands" data-for="spells/cisco-ios-general-configuration-commands">Cisco IOS general configuration commands</a></li><li><a href="../spells/cisco-ios-interface-configuration-commands" data-for="spells/cisco-ios-interface-configuration-commands">Cisco IOS interface configuration commands</a></li><li><a href="../spells/cisco-ios-line-configuration-commands" data-for="spells/cisco-ios-line-configuration-commands">Cisco IOS line (login) configuration commands</a></li><li><a href="../spells/cisco-ios-system-information-commands" data-for="spells/cisco-ios-system-information-commands">Cisco IOS system information commands</a></li><li><a href="../spells/common-http-headers" data-for="spells/common-http-headers">Common HTTP headers</a></li><li><a href="../spells/common-meterpreter-commands" data-for="spells/common-meterpreter-commands">Common meterpreter commands</a></li><li><a href="../spells/common-msfconsole-commands" data-for="spells/common-msfconsole-commands">Common msfconsole commands</a></li><li><a href="../spells/common-nmap-long-flags" data-for="spells/common-nmap-long-flags">Common Nmap long flags</a></li><li><a href="../spells/common-nmap-short-flags" data-for="spells/common-nmap-short-flags">Common Nmap short flags</a></li><li><a href="../spells/common-video-resolutions" data-for="spells/common-video-resolutions">Common video resolutions</a></li><li><a href="../spells/common-windows-user-types" data-for="spells/common-windows-user-types">Common Windows user types</a></li><li><a href="../spells/comparison-of-the-tcp-and-osi-models" data-for="spells/comparison-of-the-tcp-and-osi-models">Comparison of the TCP and OSI models</a></li><li><a href="../spells/crackmapexec" data-for="spells/crackmapexec">crackmapexec</a></li><li><a href="../spells/cupp" data-for="spells/cupp">CUPP</a></li><li><a href="../spells/cve-2021-3560" data-for="spells/cve-2021-3560">CVE-2021-3560</a></li><li><a href="../spells/cve-2021-4034" data-for="spells/cve-2021-4034">CVE-2021-4034 (“Pwnkit”)</a></li><li><a href="../spells/dcerpc" data-for="spells/dcerpc">DCERPC</a></li><li><a href="../spells/debugging-bash-scripts" data-for="spells/debugging-bash-scripts">Debugging Bash scripts</a></li><li><a href="../spells/default-cifs-shares" data-for="spells/default-cifs-shares">Default CIFS shares</a></li><li><a href="../spells/different-ip-address-representations" data-for="spells/different-ip-address-representations">Different IP address representations</a></li><li><a href="../spells/dig" data-for="spells/dig">dig</a></li><li><a href="../spells/dir" data-for="spells/dir">dir</a></li><li><a href="../spells/domain-enumeration-with-powerview" data-for="spells/domain-enumeration-with-powerview">Domain enumeration with PowerView</a></li><li><a href="../spells/drsuapi" data-for="spells/drsuapi">DRSUAPI</a></li><li><a href="../spells/dynamic-port-forwarding-with-ssh" data-for="spells/dynamic-port-forwarding-with-ssh">Dynamic port forwarding with SSH</a></li><li><a href="../spells/easy-reverse-dns-lookups" data-for="spells/easy-reverse-dns-lookups">Easy reverse DNS lookups</a></li><li><a href="../spells/enum4linux" data-for="spells/enum4linux">enum4linux</a></li><li><a href="../spells/equivalent-burp-suite-and-owasp-zap-functionality" data-for="spells/equivalent-burp-suite-and-owasp-zap-functionality">Equivalent Burp Suite and OWASP ZAP functionality</a></li><li><a href="../spells/equivalent-socat-and-netcat-commands" data-for="spells/equivalent-socat-and-netcat-commands">Equivalent socat and netcat commands</a></li><li><a href="../spells/equivalent-windows-and-nix-commands" data-for="spells/equivalent-windows-and-nix-commands">Equivalent Windows and *NIX commands</a></li><li><a href="../spells/error-based-sqli" data-for="spells/error-based-sqli">Error-based SQLi</a></li><li><a href="../spells/evading-anti-xss-filtering" data-for="spells/evading-anti-xss-filtering">Evading anti-XSS filtering</a></li><li><a href="../spells/file-transfers-in-evil-winrm" data-for="spells/file-transfers-in-evil-winrm">File transfers in Evil-WinRM</a></li><li><a href="../spells/filter-files-based-on-file-permissions-in-find" data-for="spells/filter-files-based-on-file-permissions-in-find">Filter files based on file permissions in find</a></li><li><a href="../spells/filter-files-based-on-ownership-in-find" data-for="spells/filter-files-based-on-ownership-in-find">Filter files based on ownership in find</a></li><li><a href="../spells/filter-files-based-on-size-in-find" data-for="spells/filter-files-based-on-size-in-find">Filter files based on size in find</a></li><li><a href="../spells/filter-files-based-on-timestamp-in-find" data-for="spells/filter-files-based-on-timestamp-in-find">Filter files based on timestamp in find</a></li><li><a href="../spells/find-shell-escape" data-for="spells/find-shell-escape">find shell escape</a></li><li><a href="../spells/findstr" data-for="spells/findstr">findstr</a></li><li><a href="../spells/finger" data-for="spells/finger">finger</a></li><li><a href="../spells/ftp-application" data-for="spells/ftp-application">ftp (application)</a></li><li><a href="../spells/ftp-commands" data-for="spells/ftp-commands">FTP commands</a></li><li><a href="../spells/ftps" data-for="spells/ftps">FTPS</a></li><li><a href="../spells/general-gdb-commands" data-for="spells/general-gdb-commands">General gdb commands</a></li><li><a href="../spells/get-filehash" data-for="spells/get-filehash">Get-FileHash</a></li><li><a href="../spells/get-winevent-filterhashtable-keywords" data-for="spells/get-winevent-filterhashtable-keywords">Get-WinEvent FilterHashtable keywords</a></li><li><a href="../spells/get-winevent-filterhashtable-log-levels" data-for="spells/get-winevent-filterhashtable-log-levels">Get-WinEvent FilterHashtable log levels</a></li><li><a href="../spells/gobuster" data-for="spells/gobuster">gobuster</a></li><li><a href="../spells/golden-and-silver-tickets" data-for="spells/golden-and-silver-tickets">Golden and silver tickets</a></li><li><a href="../spells/grep" data-for="spells/grep">grep</a></li><li><a href="../spells/harvester" data-for="spells/harvester">Harvester</a></li><li><a href="../spells/hashcat-combinator" data-for="spells/hashcat-combinator">Hashcat combinator</a></li><li><a href="../spells/hashcat-password-hash-types" data-for="spells/hashcat-password-hash-types">Hashcat password hash types</a></li><li><a href="../spells/helpful-metasploit-modules-to-use-with-meterpreter" data-for="spells/helpful-metasploit-modules-to-use-with-meterpreter">Helpful Metasploit modules to use with meterpreter</a></li><li><a href="../spells/how-to-access-the-windows-registry-using-powershell" data-for="spells/how-to-access-the-windows-registry-using-powershell">How to access the Windows Registry using PowerShell</a></li><li><a href="../spells/how-to-add-windows-users-at-the-command-line" data-for="spells/how-to-add-windows-users-at-the-command-line">How to add Windows users at the command line</a></li><li><a href="../spells/how-to-attack-json-apis-with-hydra" data-for="spells/how-to-attack-json-apis-with-hydra">How to attack JSON APIs with Hydra</a></li><li><a href="../spells/how-to-automatically-stabilize-a-reverse-shell-with-socat" data-for="spells/how-to-automatically-stabilize-a-reverse-shell-with-socat">How to automatically stabilize a reverse shell with socat</a></li><li><a href="../spells/how-to-avoid-dropping-privileges-with-suid-bash" data-for="spells/how-to-avoid-dropping-privileges-with-suid-bash">How to avoid dropping privileges with SUID Bash</a></li><li><a href="../spells/how-to-backdoor-visual-basic-scripts" data-for="spells/how-to-backdoor-visual-basic-scripts">How to backdoor Visual Basic Scripts</a></li><li><a href="../spells/how-to-brute-force-http-logins-with-hydra" data-for="spells/how-to-brute-force-http-logins-with-hydra">How to brute force HTTP logins with Hydra</a></li><li><a href="../spells/how-to-brute-force-login-credentials-with-fuff" data-for="spells/how-to-brute-force-login-credentials-with-fuff">How to brute force login credentials with fuff</a></li><li><a href="../spells/how-to-brute-force-virtual-host-entries-with-fuff" data-for="spells/how-to-brute-force-virtual-host-entries-with-fuff">How to brute force virtual host entries with fuff</a></li><li><a href="../spells/how-to-brute-force-weak-jwt-secrets" data-for="spells/how-to-brute-force-weak-jwt-secrets">How to brute force weak JWT secrets</a></li><li><a href="../spells/how-to-bulk-edit-windows-permissions" data-for="spells/how-to-bulk-edit-windows-permissions">How to bulk edit Windows permissions</a></li><li><a href="../spells/how-to-bypass-windows-antivirus-with-c-sharp" data-for="spells/how-to-bypass-windows-antivirus-with-c-sharp">How to bypass Windows antivirus with C#</a></li><li><a href="../spells/how-to-calculate-a-file-hash-on-windows-with-certutil" data-for="spells/how-to-calculate-a-file-hash-on-windows-with-certutil">How to calculate a file hash on Windows with certutil</a></li><li><a href="../spells/how-to-call-mimikatz-from-a-meterpreter-shell" data-for="spells/how-to-call-mimikatz-from-a-meterpreter-shell">How to call Mimikatz from a meterpreter shell</a></li><li><a href="../spells/how-to-change-a-branch-name-in-git" data-for="spells/how-to-change-a-branch-name-in-git">How to change a branch name in Git</a></li><li><a href="../spells/how-to-change-a-key-passphrase-with-openssl" data-for="spells/how-to-change-a-key-passphrase-with-openssl">How to change a key passphrase with OpenSSL</a></li><li><a href="../spells/how-to-change-an-ssh-key-passphrase" data-for="spells/how-to-change-an-ssh-key-passphrase">How to change an SSH Key passphrase</a></li><li><a href="../spells/how-to-change-a-user-password-with-rubeus" data-for="spells/how-to-change-a-user-password-with-rubeus">How to change a user’s password with Rubeus</a></li><li><a href="../spells/how-to-compact-a-libvirt-disk-image" data-for="spells/how-to-compact-a-libvirt-disk-image">How to compact a libVirt disk image</a></li><li><a href="../spells/how-to-compact-a-virtualbox-linux-guest-disk-image" data-for="spells/how-to-compact-a-virtualbox-linux-guest-disk-image">How to compact a VirtualBox Linux guest disk image</a></li><li><a href="../spells/how-to-compact-a-virtualbox-windows-guest-disk-image" data-for="spells/how-to-compact-a-virtualbox-windows-guest-disk-image">How to compact a VirtualBox Windows guest disk image</a></li><li><a href="../spells/how-to-confirm-the-existence-of-a-gmail-address" data-for="spells/how-to-confirm-the-existence-of-a-gmail-address">How to confirm the existence of a Gmail address</a></li><li><a href="../spells/how-to-convert-from-m4a-to-mp3-using-ffmpeg" data-for="spells/how-to-convert-from-m4a-to-mp3-using-ffmpeg">How to convert from M4A to MP3 using ffmpeg</a></li><li><a href="../spells/how-to-convert-from-mp4-to-gif-using-ffmpeg" data-for="spells/how-to-convert-from-mp4-to-gif-using-ffmpeg">How to convert from MP4 to GIF using ffmpeg</a></li><li><a href="../spells/how-to-convert-from-mp4-to-webp-using-ffmpeg" data-for="spells/how-to-convert-from-mp4-to-webp-using-ffmpeg">How to convert from MP4 to WebP using ffmpeg</a></li><li><a href="../spells/how-to-create-a-gold-or-silver-ticket-with-mimikatz" data-for="spells/how-to-create-a-gold-or-silver-ticket-with-mimikatz">How to create a gold or silver ticket with Mimikatz</a></li><li><a href="../spells/how-to-create-a-KDC-skeleton-key-with-mimikatz" data-for="spells/how-to-create-a-KDC-skeleton-key-with-mimikatz">How to create a KDC skeleton key with Mimikatz</a></li><li><a href="../spells/how-to-dump-cleartext-passwords-with-mimikatz" data-for="spells/how-to-dump-cleartext-passwords-with-mimikatz">How to dump cleartext passwords with Mimikatz</a></li><li><a href="../spells/how-to-dump-ntlm-hashes-from-the-local-sam-with-mimikatz" data-for="spells/how-to-dump-ntlm-hashes-from-the-local-sam-with-mimikatz">How to dump NTLM hashes from the local SAM with Mimikatz</a></li><li><a href="../spells/how-to-dump-ntlm-hashes-from-lsass-with-mimikatz" data-for="spells/how-to-dump-ntlm-hashes-from-lsass-with-mimikatz">How to dump NTLM hashes from LSASS with Mimikatz</a></li><li><a href="../spells/how-to-encrypt-a-reverse-shell-connection-with-socat" data-for="spells/how-to-encrypt-a-reverse-shell-connection-with-socat">How to encrypt a reverse shell connection with socat</a></li><li><a href="../spells/how-to-enumerate-ad-cs-templates-with-certutil" data-for="spells/how-to-enumerate-ad-cs-templates-with-certutil">How to enumerate AD CS templates with certutil</a></li><li><a href="../spells/how-to-enumerate-services-and-shares-using-smbclient" data-for="spells/how-to-enumerate-services-and-shares-using-smbclient">How to enumerate services and shares using smbclient</a></li><li><a href="../spells/how-to-enumerate-url-paths-with-fuff" data-for="spells/how-to-enumerate-url-paths-with-fuff">How to enumerate URL paths with fuff</a></li><li><a href="../spells/how-to-enumerate-url-paths-with-owasp-zap" data-for="spells/how-to-enumerate-url-paths-with-owasp-zap">How to enumerate URL paths with OWASP ZAP</a></li><li><a href="../spells/how-to-enumerate-users-with-fuff" data-for="spells/how-to-enumerate-users-with-fuff">How to enumerate users with fuff</a></li><li><a href="../spells/how-to-escalate-privileges-from-suid-vim" data-for="spells/how-to-escalate-privileges-from-suid-vim">How to escalate privileges from SUID ViM</a></li><li><a href="../spells/how-to-exploit-asp-scripts-with-msfvenom" data-for="spells/how-to-exploit-asp-scripts-with-msfvenom">How to exploit ASP scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-the-bash-ps4-prompt" data-for="spells/how-to-exploit-the-bash-ps4-prompt">How to exploit the Bash PS4 (debugging) prompt</a></li><li><a href="../spells/how-to-exploit-jsp-scripts-with-msfvenom" data-for="spells/how-to-exploit-jsp-scripts-with-msfvenom">How to exploit JSP Scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-jwts-signed-using-a-public-key" data-for="spells/how-to-exploit-jwts-signed-using-a-public-key">How to exploit JWTs signed using a public key</a></li><li><a href="../spells/how-to-exploit-jwts-that-support-the-none-signature-algorithm" data-for="spells/how-to-exploit-jwts-that-support-the-none-signature-algorithm">How to exploit JWTs that support the NONE signature algorithm</a></li><li><a href="../spells/how-to-exploit-ld_library_path" data-for="spells/how-to-exploit-ld_library_path">How to exploit LD_LIBRARY_PATH</a></li><li><a href="../spells/how-to-exploit-ld_preload" data-for="spells/how-to-exploit-ld_preload">How to exploit LD_PRELOAD</a></li><li><a href="../spells/how-to-exploit-linux-elf-executables-with-msfvenom" data-for="spells/how-to-exploit-linux-elf-executables-with-msfvenom">How to exploit Linux ELF executables with msfvenom</a></li><li><a href="../spells/how-to-exploit-log4shell" data-for="spells/how-to-exploit-log4shell">How to exploit Log4Shell</a></li><li><a href="../spells/how-to-exploit-macos-mach-o-executables-with-msfvenom" data-for="spells/how-to-exploit-macos-mach-o-executables-with-msfvenom">How to exploit macOS MACH-O executables with msfvenom</a></li><li><a href="../spells/how-to-exploit-perl-scripts-with-msfvenom" data-for="spells/how-to-exploit-perl-scripts-with-msfvenom">How to exploit Perl scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-php-scripts-with-msfvenom" data-for="spells/how-to-exploit-php-scripts-with-msfvenom">How to exploit PHP scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-python-scripts-with-msfvenom" data-for="spells/how-to-exploit-python-scripts-with-msfvenom">How to exploit Python scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-shell-scripts-with-msfvenom" data-for="spells/how-to-exploit-shell-scripts-with-msfvenom">How to exploit shell scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-vba-scripts-with-msfvenom" data-for="spells/how-to-exploit-vba-scripts-with-msfvenom">How to exploit VBA scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-weak-etc-passwd-permissions" data-for="spells/how-to-exploit-weak-etc-passwd-permissions">How to exploit weak /etc/passwd permissions</a></li><li><a href="../spells/how-to-exploit-weak-etc-shadow-permissions" data-for="spells/how-to-exploit-weak-etc-shadow-permissions">How to exploit weak /etc/shadow permissions</a></li><li><a href="../spells/how-to-exploit-the-windows-dll-search-order" data-for="spells/how-to-exploit-the-windows-dll-search-order">How to exploit the Windows DLL search order</a></li><li><a href="../spells/how-to-exploit-windows-executables-with-msfvenom" data-for="spells/how-to-exploit-windows-executables-with-msfvenom">How to exploit Windows executables with msfvenom</a></li><li><a href="../spells/how-to-exploit-the-windows-feature-on-demand-helper" data-for="spells/how-to-exploit-the-windows-feature-on-demand-helper">How to exploit the Windows “Feature on Demand” Helper</a></li><li><a href="../spells/how-to-exploit-windows-file-associations" data-for="spells/how-to-exploit-windows-file-associations">How to exploit Windows file associations</a></li><li><a href="../spells/how-to-exploit-windows-html-applications-with-msfvenom" data-for="spells/how-to-exploit-windows-html-applications-with-msfvenom">How to exploit Windows HTML applications with msfvenom</a></li><li><a href="../spells/how-to-exploit-windows-msi-installers-with-msfvenom" data-for="spells/how-to-exploit-windows-msi-installers-with-msfvenom">How to exploit Windows MSI installers with msfvenom</a></li><li><a href="../spells/how-to-exploit-windows-shortcut-files" data-for="spells/how-to-exploit-windows-shortcut-files">How to exploit Windows shortcut files</a></li><li><a href="../spells/how-to-exploit-the-winlogon-initialization-sequence" data-for="spells/how-to-exploit-the-winlogon-initialization-sequence">How to exploit the WinLogon initialization sequence</a></li><li><a href="../spells/how-to-export-highlights-and-annotations-from-kobo-ereaders" data-for="spells/how-to-export-highlights-and-annotations-from-kobo-ereaders">How to export highlights and annotations from Kobo eReaders</a></li><li><a href="../spells/how-to-extract-the-webpage-title-from-a-url" data-for="spells/how-to-extract-the-webpage-title-from-a-url">How to extract the webpage title from a URL</a></li><li><a href="../spells/how-to-find-executables-with-suid-capabilities" data-for="spells/how-to-find-executables-with-suid-capabilities">How to find executables with SUID capabilities</a></li><li><a href="../spells/how-to-find-and-replace-a-single-line-in-a-large-text-file" data-for="spells/how-to-find-and-replace-a-single-line-in-a-large-text-file">How to find and replace a single line in a large text file</a></li><li><a href="../spells/how-to-find-suid-and-sgid-executables-with-find" data-for="spells/how-to-find-suid-and-sgid-executables-with-find">How to find SUID and SGID executables with find</a></li><li><a href="../spells/how-to-find-world-accessible-and-world-modifiable-folders-with-find" data-for="spells/how-to-find-world-accessible-and-world-modifiable-folders-with-find">How to find world-accessible and world-modifiable folders with find</a></li><li><a href="../spells/how-to-fix-exif-data-on-google-photos-exports" data-for="spells/how-to-fix-exif-data-on-google-photos-exports">How to fix EXIF data on Google Photos exports</a></li><li><a href="../spells/how-to-forward-a-port-with-netcat" data-for="spells/how-to-forward-a-port-with-netcat">How to forward a port with netcat</a></li><li><a href="../spells/how-to-generate-a-self-signed-ssl-certificate" data-for="spells/how-to-generate-a-self-signed-ssl-certificate">How to generate a self-signed SSL certificate</a></li><li><a href="../spells/how-to-get-ios-shortcuts-to-show-up-in-the-share-sheet-after-reinstallation" data-for="spells/how-to-get-ios-shortcuts-to-show-up-in-the-share-sheet-after-reinstallation">How to get iOS Shortcuts to show up in the share sheet after reinstallation</a></li><li><a href="../spells/how-to-get-a-shell-from-vim" data-for="spells/how-to-get-a-shell-from-vim">How to get a shell from ViM</a></li><li><a href="../spells/how-to-get-an-ssl-certificate-from-a-real-registrar" data-for="spells/how-to-get-an-ssl-certificate-from-a-real-registrar">How to get an SSL certificate from a real registrar</a></li><li><a href="../spells/how-to-harvest-kerberos-tickets-with-rubeus" data-for="spells/how-to-harvest-kerberos-tickets-with-rubeus">How to harvest Kerberos tickets with Rubeus</a></li><li><a href="../spells/how-to-hide-windows-tasks-using-psexec" data-for="spells/how-to-hide-windows-tasks-using-psexec">How to hide Windows tasks using PsExec</a></li><li><a href="../spells/how-to-impersonate-a-user-with-meterpreter" data-for="spells/how-to-impersonate-a-user-with-meterpreter">How to impersonate a user with meterpreter</a></li><li><a href="../spells/how-to-load-drivers-in-windows" data-for="spells/how-to-load-drivers-in-windows">How to load drivers in Windows</a></li><li><a href="../spells/how-to-look-up-unicode-and-emoji-symbols" data-for="spells/how-to-look-up-unicode-and-emoji-symbols">How to look up unicode and emoji symbols</a></li><li><a href="../spells/how-to-manipulate-remote-windows-tasks" data-for="spells/how-to-manipulate-remote-windows-tasks">How to manipulate remote Windows tasks</a></li><li><a href="../spells/how-to-manipulate-users-and-groups-at-the-windows-command-line-using-net" data-for="spells/how-to-manipulate-users-and-groups-at-the-windows-command-line-using-net">How to manipulate users and groups at the Windows command line using net</a></li><li><a href="../spells/how-to-match-files-to-packages-in-debian-based-operating-systems" data-for="spells/how-to-match-files-to-packages-in-debian-based-operating-systems">How to match files to packages in Debian-based operating systems</a></li><li><a href="../spells/how-to-match-files-to-packages-in-red-hat-based-operating-systems" data-for="spells/how-to-match-files-to-packages-in-red-hat-based-operating-systems">How to match files to packages in Red Hat-based operating systems</a></li><li><a href="../spells/how-to-pass-the-hash-with-mimikatz" data-for="spells/how-to-pass-the-hash-with-mimikatz">How to pass the hash with Mimikatz</a></li><li><a href="../spells/how-to-pass-the-key-with-mimikatz" data-for="spells/how-to-pass-the-key-with-mimikatz">How to pass the key with Mimikatz</a></li><li><a href="../spells/how-to-pass-the-ticket-with-mimikatz" data-for="spells/how-to-pass-the-ticket-with-mimikatz">How to pass the ticket with Mimikatz</a></li><li><a href="../spells/how-to-pop-a-system-shell-on-the-windows-login-screen-using-sticky-keys" data-for="spells/how-to-pop-a-system-shell-on-the-windows-login-screen-using-sticky-keys">How to pop a SYSTEM shell on the Windows login screen using sticky keys</a></li><li><a href="../spells/how-to-pop-a-system-shell-on-the-windows-login-screen-using-utilman" data-for="spells/how-to-pop-a-system-shell-on-the-windows-login-screen-using-utilman">How to pop a SYSTEM shell on the Windows login screen using Utilman</a></li><li><a href="../spells/how-to-port-scan-with-netcat" data-for="spells/how-to-port-scan-with-netcat">How to port scan with netcat</a></li><li><a href="../spells/how-to-pull-ssl-certificates-from-an-external-server" data-for="spells/how-to-pull-ssl-certificates-from-an-external-server">How to pull SSL certificates from an external server</a></li><li><a href="../spells/how-to-quickly-bypass-ssh-agent" data-for="spells/how-to-quickly-bypass-ssh-agent">How to quickly bypass ssh-agent</a></li><li><a href="../spells/how-to-quickly-find-the-canonical-path-of-a-file" data-for="spells/how-to-quickly-find-the-canonical-path-of-a-file">How to quickly find the canonical path of a file</a></li><li><a href="../spells/how-to-read-a-file-beginning-with-a-dash" data-for="spells/how-to-read-a-file-beginning-with-a-dash">How to read a file beginning with a dash (-)</a></li><li><a href="../spells/how-to-remotely-install-a-windows-package-with-wmic" data-for="spells/how-to-remotely-install-a-windows-package-with-wmic">How to remotely install a Windows package with wmic</a></li><li><a href="../spells/how-to-remove-all-but-the-first-occurrence-of-a-line-in-bash" data-for="spells/how-to-remove-all-but-the-first-occurrence-of-a-line-in-bash">How to remove all but the first occurrence of a line in Bash</a></li><li><a href="../spells/how-to-remove-all-but-the-last-occurrence-of-a-line-in-bash" data-for="spells/how-to-remove-all-but-the-last-occurrence-of-a-line-in-bash">How to remove all but the last occurrence of a line in Bash</a></li><li><a href="../spells/how-to-remove-duplicate-lines-in-bash-when-line-order-is-not-important" data-for="spells/how-to-remove-duplicate-lines-in-bash-when-line-order-is-not-important">How to remove duplicate lines in Bash when line order isn’t important</a></li><li><a href="../spells/how-to-retrieve-aix-system-information" data-for="spells/how-to-retrieve-aix-system-information">How to retrieve AIX system information</a></li><li><a href="../spells/how-to-run-commands-directly-with-powershell" data-for="spells/how-to-run-commands-directly-with-powershell">How to run commands directly with PowerShell</a></li><li><a href="../spells/how-to-run-a-remote-command-with-wmic" data-for="spells/how-to-run-a-remote-command-with-wmic">How to run a remote command with wmic</a></li><li><a href="../spells/how-to-send-a-command-using-openssl" data-for="spells/how-to-send-a-command-using-openssl">How to send a command using OpenSSL</a></li><li><a href="../spells/how-to-set-the-path-in-a-session-on-unix-like-operating-systems" data-for="spells/how-to-set-the-path-in-a-session-on-unix-like-operating-systems">How to set the PATH in a session on UNIX-like operating systems</a></li><li><a href="../spells/how-to-set-the-path-in-a-session-on-windows" data-for="spells/how-to-set-the-path-in-a-session-on-windows">How to set the PATH in a session on Windows</a></li><li><a href="../spells/how-to-specify-an-alternate-ssh-key-as-a-git-config-directive" data-for="spells/how-to-specify-an-alternate-ssh-key-as-a-git-config-directive">How to specify an alternate SSH key as a Git config directive</a></li><li><a href="../spells/how-to-specify-an-alternate-ssh-key-using-the-git_ssh_command-variable" data-for="spells/how-to-specify-an-alternate-ssh-key-using-the-git_ssh_command-variable">How to specify an alternate SSH key using the GIT_SSH_COMMAND variable</a></li><li><a href="../spells/how-to-specify-an-alternate-ssh-key-with-git-using-ssh-agent" data-for="spells/how-to-specify-an-alternate-ssh-key-with-git-using-ssh-agent">How to specify an alternate SSH key with git using ssh-agent</a></li><li><a href="../spells/how-to-spider-websites-and-apis-with-owasp-zap" data-for="spells/how-to-spider-websites-and-apis-with-owasp-zap">How to spider websites and APIs with OWASP ZAP</a></li><li><a href="../spells/how-to-start-a-netcat-client" data-for="spells/how-to-start-a-netcat-client">How to start a netcat client</a></li><li><a href="../spells/how-to-start-a-netcat-server" data-for="spells/how-to-start-a-netcat-server">How to start a netcat server</a></li><li><a href="../spells/how-to-start-powershell-from-a-meterpreter-session" data-for="spells/how-to-start-powershell-from-a-meterpreter-session">How to start PowerShell from a meterpreter session</a></li><li><a href="../spells/how-to-transfer-files-over-ftp-using-netcat" data-for="spells/how-to-transfer-files-over-ftp-using-netcat">How to transfer files over FTP using netcat</a></li><li><a href="../spells/how-to-upgrade-postgresql" data-for="spells/how-to-upgrade-postgresql">How to upgrade PostgreSQL</a></li><li><a href="../spells/how-to-use-bash-functions-to-backdoor-executables" data-for="spells/how-to-use-bash-functions-to-backdoor-executables">How to use Bash functions to “backdoor” executables</a></li><li><a href="../spells/how-to-use-burp-suite-with-firefox" data-for="spells/how-to-use-burp-suite-with-firefox">How to use Burp Suite with Firefox</a></li><li><a href="../spells/how-to-use-burp-suite-with-mobile-apps" data-for="spells/how-to-use-burp-suite-with-mobile-apps">How to use Burp Suite with mobile apps</a></li><li><a href="../spells/how-to-use-a-certificate-to-request-a-ticket-with-rubeus" data-for="spells/how-to-use-a-certificate-to-request-a-ticket-with-rubeus">How to use a certificate to request a ticket with Rubeus</a></li><li><a href="../spells/how-to-use-curl-and-jq-with-web-apis" data-for="spells/how-to-use-curl-and-jq-with-web-apis">How to use curl and jq with web APIs</a></li><li><a href="../spells/how-to-use-hashcat-for-brute-force-password-guessing" data-for="spells/how-to-use-hashcat-for-brute-force-password-guessing">How to use Hashcat for brute force password guessing</a></li><li><a href="../spells/how-to-use-hydra" data-for="spells/how-to-use-hydra">How to use Hydra</a></li><li><a href="../spells/how-to-use-msfvenom-to-generate-a-binary-that-launches-any-command-as-root" data-for="spells/how-to-use-msfvenom-to-generate-a-binary-that-launches-any-command-as-root">How to use msfvenom to generate a binary that launches any command as root</a></li><li><a href="../spells/how-to-use-netcat-as-a-replacement-for-telnet" data-for="spells/how-to-use-netcat-as-a-replacement-for-telnet">How to use netcat as a replacement for telnet</a></li><li><a href="../spells/how-to-use-openssl-to-encrypt-and-decrypt-files" data-for="spells/how-to-use-openssl-to-encrypt-and-decrypt-files">How to use OpenSSL to encrypt and decrypt files</a></li><li><a href="../spells/how-to-use-smbclient" data-for="spells/how-to-use-smbclient">How to use smbclient</a></li><li><a href="../spells/how-to-use-sqli-to-bypass-authentication" data-for="spells/how-to-use-sqli-to-bypass-authentication">How to use SQLi to bypass authentication</a></li><li><a href="../spells/how-to-use-the-windows-firewall-to-relay-ports" data-for="spells/how-to-use-the-windows-firewall-to-relay-ports">How to use the Windows Firewall to relay ports</a></li><li><a href="../spells/how-to-use-winrm-with-powershell" data-for="spells/how-to-use-winrm-with-powershell">How to use WinRM with PowerShell</a></li><li><a href="../spells/how-to-work-with-base64-encoding-using-powershell" data-for="spells/how-to-work-with-base64-encoding-using-powershell">How to work with base64 encoding using PowerShell</a></li><li><a href="../spells/how-to-work-with-remote-services-using-wmi-and-powershell" data-for="spells/how-to-work-with-remote-services-using-wmi-and-powershell">How to work with remote services using WMI and PowerShell</a></li><li><a href="../spells/how-to-create-work-with-remote-tasks-using-wmi-and-powershell" data-for="spells/how-to-create-work-with-remote-tasks-using-wmi-and-powershell">How to work with remote tasks using WMI and PowerShell</a></li><li><a href="../spells/icacls" data-for="spells/icacls">icacls</a></li><li><a href="../spells/icmp" data-for="spells/icmp">ICMP</a></li><li><a href="../spells/iftop" data-for="spells/iftop">iftop</a></li><li><a href="../spells/iis-configuration-data" data-for="spells/iis-configuration-data">IIS configuration data</a></li><li><a href="../spells/imap" data-for="spells/imap">IMAP</a></li><li><a href="../spells/impacket-psexec-reimplementation" data-for="spells/impacket-psexec-reimplementation">Impacket PsExec reimplementation</a></li><li><a href="../spells/injecting-javascript-using-iframe-and-image-tags" data-for="spells/injecting-javascript-using-iframe-and-image-tags">Injecting JavaScript using iframe and image tags</a></li><li><a href="../spells/invoke-webrequest" data-for="spells/invoke-webrequest">Invoke-WebRequest</a></li><li><a href="../spells/ipconfig" data-for="spells/ipconfig">ipconfig</a></li><li><a href="../spells/ipsec" data-for="spells/ipsec">IPSec</a></li><li><a href="../spells/ipv4-address-representations-for-localhost" data-for="spells/ipv4-address-representations-for-localhost">IPv4 address representations for localhost</a></li><li><a href="../spells/issue-definitions-in-burp-suite" data-for="spells/issue-definitions-in-burp-suite">Issue definitions in Burp Suite</a></li><li><a href="../spells/java-reverse-shell" data-for="spells/java-reverse-shell">Java reverse shell</a></li><li><a href="../spells/john-the-ripper-helper-applications" data-for="spells/john-the-ripper-helper-applications">John the Ripper helper applications</a></li><li><a href="../spells/john-the-ripper-single-crack-mode" data-for="spells/john-the-ripper-single-crack-mode">John the Ripper single crack mode</a></li><li><a href="../spells/kerberoasting-with-impacket" data-for="spells/kerberoasting-with-impacket">Kerberoasting with Impacket</a></li><li><a href="../spells/kerberoasting-with-rubeus" data-for="spells/kerberoasting-with-rubeus">Kerberoasting with Rubeus</a></li><li><a href="../spells/kerberos-teminology" data-for="spells/kerberos-teminology">Kerberos teminology</a></li><li><a href="../spells/keylogging-with-xss" data-for="spells/keylogging-with-xss">Keylogging with cross-site scripting</a></li><li><a href="../spells/kirbi-files" data-for="spells/kirbi-files">kirbi files</a></li><li><a href="../spells/less" data-for="spells/less">less</a></li><li><a href="../spells/mac-addresses" data-for="spells/mac-addresses">mac addresses</a></li><li><a href="../spells/magic-numbers" data-for="spells/magic-numbers">Magic numbers</a></li><li><a href="../spells/man" data-for="spells/man">man</a></li><li><a href="../spells/metasploit-cifs-modules" data-for="spells/metasploit-cifs-modules">Metasploit CIFS modules</a></li><li><a href="../spells/metasploit-exploit-modules" data-for="spells/metasploit-exploit-modules">Metasploit exploit modules</a></li><li><a href="../spells/metasploit-ms-sql-modules" data-for="spells/metasploit-ms-sql-modules">Metasploit MS SQL modules</a></li><li><a href="../spells/metasploit-scanner-modules" data-for="spells/metasploit-scanner-modules">Metasploit scanner modules</a></li><li><a href="../spells/minimal-request-http-request" data-for="spells/minimal-request-http-request">Minimal request HTTP request</a></li><li><a href="../spells/mitre-attack-emulation-plans" data-for="spells/mitre-attack-emulation-plans">MITRE ATT&amp;CK emulation plans</a></li><li><a href="../spells/more" data-for="spells/more">more</a></li><li><a href="../spells/mysql" data-for="spells/mysql">MySQL</a></li><li><a href="../spells/nano" data-for="spells/nano">Nano</a></li><li><a href="../spells/nbtscan" data-for="spells/nbtscan">nbtscan</a></li><li><a href="../spells/netsh" data-for="spells/netsh">netsh</a></li><li><a href="../spells/netstat" data-for="spells/netstat">netstat</a></li><li><a href="../spells/nfs-reconnaissance-with-nmap" data-for="spells/nfs-reconnaissance-with-nmap">NFS reconnaissance with Nmap</a></li><li><a href="../spells/nfs-root-squashing" data-for="spells/nfs-root-squashing">NFS root squashing</a></li><li><a href="../spells/nikto" data-for="spells/nikto">Nikto</a></li><li><a href="../spells/nmap-host-discovery-flags" data-for="spells/nmap-host-discovery-flags">Nmap host discovery flags</a></li><li><a href="../spells/nmap-output-flags" data-for="spells/nmap-output-flags">Nmap output flags</a></li><li><a href="../spells/nmap-port-states" data-for="spells/nmap-port-states">Nmap port states</a></li><li><a href="../spells/nmap-scan-type-flags" data-for="spells/nmap-scan-type-flags">Nmap scan type flags</a></li><li><a href="../spells/nmap-scripting-engine-categories" data-for="spells/nmap-scripting-engine-categories">Nmap scripting engine categories</a></li><li><a href="../spells/nmap-shell-escape" data-for="spells/nmap-shell-escape">Nmap shell escape</a></li><li><a href="../spells/node.js" data-for="spells/node.js">Node.js</a></li><li><a href="../spells/nslookup" data-for="spells/nslookup">nslookup</a></li><li><a href="../spells/onedrive-ios-quirks" data-for="spells/onedrive-ios-quirks">OneDrive iOS quirks</a></li><li><a href="../spells/oracle-sql-server" data-for="spells/oracle-sql-server">Oracle SQL Server</a></li><li><a href="../spells/osi-model" data-for="spells/osi-model">OSI model</a></li><li><a href="../spells/out-of-band-sqli" data-for="spells/out-of-band-sqli">Out-of-band SQLi</a></li><li><a href="../spells/pass-the-ticket-attacks" data-for="spells/pass-the-ticket-attacks">Pass the ticket attacks</a></li><li><a href="../spells/password-spraying-with-rubeus" data-for="spells/password-spraying-with-rubeus">Password spraying with Rubeus</a></li><li><a href="../spells/perl" data-for="spells/perl">Perl</a></li><li><a href="../spells/php-reverse-shell" data-for="spells/php-reverse-shell">PHP reverse shell</a></li><li><a href="../spells/php-web-shell" data-for="spells/php-web-shell">PHP web shell</a></li><li><a href="../spells/ping" data-for="spells/ping">ping</a></li><li><a href="../spells/poison-null-byte-in-php" data-for="spells/poison-null-byte-in-php">Poison null byte in PHP</a></li><li><a href="../spells/pop3" data-for="spells/pop3">POP3</a></li><li><a href="../spells/port-scanning-with-bash" data-for="spells/port-scanning-with-bash">Port scanning with Bash</a></li><li><a href="../spells/posix-process-signals" data-for="spells/posix-process-signals">POSIX process signals</a></li><li><a href="../spells/powershell-history-file" data-for="spells/powershell-history-file">PowerShell history file</a></li><li><a href="../spells/powershell-reverse-shell" data-for="spells/powershell-reverse-shell">PowerShell reverse shell</a></li><li><a href="../spells/process-migration-in-meterpreter" data-for="spells/process-migration-in-meterpreter">Process migration in meterpreter</a></li><li><a href="../spells/ps" data-for="spells/ps">ps</a></li><li><a href="../spells/python-reverse-shell" data-for="spells/python-reverse-shell">Python reverse shell</a></li><li><a href="../spells/quick-n-dirty-python-web-server" data-for="spells/quick-n-dirty-python-web-server">Quick-n-dirty Python web server</a></li><li><a href="../spells/rce-via-xxe-in-php" data-for="spells/rce-via-xxe-in-php">RCE via XXE in PHP</a></li><li><a href="../spells/reg" data-for="spells/reg">reg</a></li><li><a href="../spells/regex-metacharacters" data-for="spells/regex-metacharacters">Regex metacharacters</a></li><li><a href="../spells/remote-port-forwarding-with-ssh" data-for="spells/remote-port-forwarding-with-ssh">Remote port forwarding with SSH</a></li><li><a href="../spells/reverse-dynamic-port-forwarding-with-ssh" data-for="spells/reverse-dynamic-port-forwarding-with-ssh">Reverse dynamic port forwarding with SSH</a></li><li><a href="../spells/ruby" data-for="spells/ruby">Ruby</a></li><li><a href="../spells/runas" data-for="spells/runas">runas</a></li><li><a href="../spells/scoping-in-burp-suite" data-for="spells/scoping-in-burp-suite">Scoping in Burp Suite</a></li><li><a href="../spells/shell-stabilization" data-for="spells/shell-stabilization">Shell stabilization</a></li><li><a href="../spells/sip-response-codes" data-for="spells/sip-response-codes">SIP response codes</a></li><li><a href="../spells/smbget" data-for="spells/smbget">smbget</a></li><li><a href="../spells/smbmap" data-for="spells/smbmap">smbmap</a></li><li><a href="../spells/smtp" data-for="spells/smtp">SMTP</a></li><li><a href="../spells/sqli-defense" data-for="spells/sqli-defense">SQLi defense</a></li><li><a href="../spells/sqlmap" data-for="spells/sqlmap">SQLMap</a></li><li><a href="../spells/ss" data-for="spells/ss">ss</a></li><li><a href="../spells/stealing-cookies-with-xss" data-for="spells/stealing-cookies-with-xss">Stealing cookies with cross-site scripting</a></li><li><a href="../spells/sudo" data-for="spells/sudo">sudo</a></li><li><a href="../spells/systemctl" data-for="spells/systemctl">systemctl</a></li><li><a href="../spells/systeminfo" data-for="spells/systeminfo">systeminfo</a></li><li><a href="../spells/tar" data-for="spells/tar">tar</a></li><li><a href="../spells/tcp-acknowledgement-number" data-for="spells/tcp-acknowledgement-number">TCP acknowledgement number</a></li><li><a href="../spells/tcpdump" data-for="spells/tcpdump">tcpdump</a></li><li><a href="../spells/tcp-header-flags" data-for="spells/tcp-header-flags">TCP header flags</a></li><li><a href="../spells/tcp-initial-round-trip-time" data-for="spells/tcp-initial-round-trip-time">TCP initial round trip time</a></li><li><a href="../spells/tcp-options" data-for="spells/tcp-options">TCP options</a></li><li><a href="../spells/tcp-window-size" data-for="spells/tcp-window-size">TCP window size</a></li><li><a href="../spells/telnet" data-for="spells/telnet">Telnet</a></li><li><a href="../spells/time-based-sqli" data-for="spells/time-based-sqli">Time-based SQLi</a></li><li><a href="../spells/tips-for-writing-xss-attacks" data-for="spells/tips-for-writing-xss-attacks">Tips for writing cross-site scripting (XSS) attacks</a></li><li><a href="../spells/tmux" data-for="spells/tmux">tmux</a></li><li><a href="../spells/udp" data-for="spells/udp">UDP</a></li><li><a href="../spells/unbuffer" data-for="spells/unbuffer">unbuffer</a></li><li><a href="../spells/uniform-resource-locators" data-for="spells/uniform-resource-locators">Uniform resource locators (URLs)</a></li><li><a href="../spells/union-based-sqli" data-for="spells/union-based-sqli">Union-based SQLi</a></li><li><a href="../spells/unix-file-descriptors" data-for="spells/unix-file-descriptors">UNIX file descriptors</a></li><li><a href="../spells/unix-password-hashes" data-for="spells/unix-password-hashes">UNIX password hashes</a></li><li><a href="../spells/unix-permission-representation" data-for="spells/unix-permission-representation">UNIX permission representation</a></li><li><a href="../spells/unquoted-path-handling-in-windows" data-for="spells/unquoted-path-handling-in-windows">Unquoted path handling in Windows</a></li><li><a href="../spells/useful-built-in-commands-for-linux-reconnaissance" data-for="spells/useful-built-in-commands-for-linux-reconnaissance">Useful built-in commands for Linux reconnaissance</a></li><li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance" data-for="spells/useful-built-in-commands-for-windows-reconnaissance">Useful built-in commands for Windows reconnaissance</a></li><li><a href="../spells/useful-netcat-flags" data-for="spells/useful-netcat-flags">Useful netcat flags</a></li><li><a href="../spells/useful-net-commands" data-for="spells/useful-net-commands">Useful net commands</a></li><li><a href="../spells/website-defacement-with-cross-site-scripting" data-for="spells/website-defacement-with-cross-site-scripting">Website defacement with cross-site scripting</a></li><li><a href="../spells/wfuzz" data-for="spells/wfuzz">wfuzz</a></li><li><a href="../spells/whoami" data-for="spells/whoami">whoami</a></li><li><a href="../spells/wifi" data-for="spells/wifi">Wi-Fi</a></li><li><a href="../spells/windows-dll-search-order" data-for="spells/windows-dll-search-order">Windows DLL search order</a></li><li><a href="../spells/windows-event-ids" data-for="spells/windows-event-ids">Windows event IDs</a></li><li><a href="../spells/windows-local-service-accounts" data-for="spells/windows-local-service-accounts">Windows local service accounts</a></li><li><a href="../spells/windows-logon-scripts" data-for="spells/windows-logon-scripts">Windows logon scripts</a></li><li><a href="../spells/windows-permissions" data-for="spells/windows-permissions">Windows permissions</a></li><li><a href="../spells/windows-remote-management" data-for="spells/windows-remote-management">Windows remote management</a></li><li><a href="../spells/windows-run-and-runonce-registry-keys" data-for="spells/windows-run-and-runonce-registry-keys">Windows Run and RunOnce Registry keys</a></li><li><a href="../spells/windows-scripting-host" data-for="spells/windows-scripting-host">Windows Scripting Host</a></li><li><a href="../spells/windows-sebackup-and-serestore-permissions" data-for="spells/windows-sebackup-and-serestore-permissions">Windows SeBackup and SeRestore permissions</a></li><li><a href="../spells/windows-seimpersonate-and-seassignrimarytoken-permissions" data-for="spells/windows-seimpersonate-and-seassignrimarytoken-permissions">Windows SeImpersonate and SeAssignPrimaryToken permissions</a></li><li><a href="../spells/windows-service-acls" data-for="spells/windows-service-acls">Windows service ACLs</a></li><li><a href="../spells/windows-service-security" data-for="spells/windows-service-security">Windows service security</a></li><li><a href="../spells/windows-setakeownership-permission" data-for="spells/windows-setakeownership-permission">Windows SeTakeOwnership permission</a></li><li><a href="../spells/windows-startup-folder" data-for="spells/windows-startup-folder">Windows Startup folder</a></li><li><a href="../spells/windows-unattended-installation-data" data-for="spells/windows-unattended-installation-data">Windows unattended installation data</a></li><li><a href="../spells/winrs" data-for="spells/winrs">winrs</a></li><li><a href="../spells/wireshark-filters" data-for="spells/wireshark-filters">Wireshark filters</a></li><li><a href="../spells/working-with-gdb-breakpoints" data-for="spells/working-with-gdb-breakpoints">Working with gdb breakpoints</a></li><li><a href="../spells/working-with-gdb-watchpoints" data-for="spells/working-with-gdb-watchpoints">Working with gdb watchpoints</a></li><li><a href="../spells/working-with-services-in-powershell" data-for="spells/working-with-services-in-powershell">Working with services in PowerShell</a></li><li><a href="../spells/xfreerdp" data-for="spells/xfreerdp">XFreeRDP</a></li><li><a href="../spells/xp_cmdshell" data-for="spells/xp_cmdshell">xp_cmdshell</a></li><li><a href="../spells/xterm" data-for="spells/xterm">Xterm</a></li><li><a href="../spells/xxd" data-for="spells/xxd">xxd</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="tales"><button class="folder-button"><span class="folder-title">Tales</span></button></div></div><div class="folder-outer open"><ul style="padding-left:1.4rem;" class="content" data-folderul="tales"><li><a href="../tales/2020-07-27-bandit" data-for="tales/2020-07-27-bandit">Bandit</a></li><li><a href="../tales/2021-10-10-pickle-rick" data-for="tales/2021-10-10-pickle-rick">Pickle Rick</a></li><li><a href="../tales/2021-11-04-basic-pentesting" data-for="tales/2021-11-04-basic-pentesting">Basic pentesting</a></li><li><a href="../tales/2021-12-07-ice" data-for="tales/2021-12-07-ice">Ice</a></li><li><a href="../tales/2021-12-08-blaster" data-for="tales/2021-12-08-blaster">Blaster</a></li><li><a href="../tales/2021-12-14-overpass-2" data-for="tales/2021-12-14-overpass-2">Overpass 2: Hacked</a></li><li><a href="../tales/2021-12-30-attacktive-directory" data-for="tales/2021-12-30-attacktive-directory">Attacktive Directory</a></li><li><a href="../tales/2022-01-02-retro" data-for="tales/2022-01-02-retro">Retro</a></li><li><a href="../tales/2022-01-30-tools-r-us" data-for="tales/2022-01-30-tools-r-us">Tools‘R’us</a></li><li><a href="../tales/2022-02-01-inclusion" data-for="tales/2022-02-01-inclusion">Inclusion</a></li><li><a href="../tales/2022-02-02-jurassic-park" data-for="tales/2022-02-02-jurassic-park">Jurassic Park</a></li><li><a href="../tales/2022-04-03-net-sec-challenge" data-for="tales/2022-04-03-net-sec-challenge">Net sec challenge</a></li><li><a href="../tales/2023-04-27-union" data-for="tales/2023-04-27-union">Union</a></li></ul></div></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../spellbook/">Spellbook</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>How to use a Raspberry Pi 4B as hacking accessory</a></div></nav><h1 class="article-title">How to use a Raspberry Pi 4B as hacking accessory</h1><p show-comma="true" class="content-meta"><span>July 31, 2024</span><span>18 min read</span></p></div></div><article class="popover-hint"><p>This guide will cover setting up <a href="https://www.kali.org/" class="external" target="_blank">Kali Linux<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> on a <a href="https://www.raspberrypi.org/products/raspberry-pi-4-model-b/" class="external" target="_blank">Raspberry Pi 4B<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> so that:</p>
<ul>
<li>It can be used as a USB C “gadget” with an <a href="https://www.apple.com/ipad-pro/" class="external" target="_blank">iPad Pro<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> (or similar device);</li>
<li>All files except for /boot are encrypted;</li>
<li>A full desktop environment is available on demand via RDP; and</li>
<li>The system <em>still</em> works as a desktop device in a pinch (BYO keyboard, mouse, and monitor).</li>
</ul>
<p>Be aware that this guide was written using the 64-bit 2021.2 <a href="../spellbook/linux" class="internal alias" data-slug="spellbook/linux">Kali Linux</a> image; YMMV with other images!</p>
<p>It should be possible to adapt the steps here for other Debian-based operating systems with a Raspberry Pi 4B compatible image. It should <em>also</em> be possible to do this all in fewer steps; the guide below is split up in a very step-by-step fashion, and is in no way optimized for speed.</p>
<h2 id="hardware-and-software">Hardware and software<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hardware-and-software" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Things you’ll want/need:</p>
<ul>
<li>A Raspberry Pi. (I use an <a href="https://www.adafruit.com/product/4564" class="external" target="_blank">8 GB Raspberry Pi 4B<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>.)</li>
<li>A good USB C cable. (The <a href="https://www.amazon.com/dp/B07THFJ1J5" class="external" target="_blank">DockCase USB C cable<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> is surprisingly great.)</li>
<li>A good microSD card. (I use a <a href="https://www.kingston.com/en/memory-cards/canvas-go-plus-microsd-card" class="external" target="_blank">64 GB Kingston Canvass Go! Plus<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>.)</li>
<li>A second “bootstrap” microSD card that’s at least 32 GB in size. (You need something <em>twice</em> the size that your operating system image requires. This will just be used to “bootstrap” the encrypted microSD card, so it’s only necessary if you’re spinning the Pi up for the first time.)</li>
<li>A USB microSD card reader (since you’ll need to have <em>both</em> microSD cards connected to the Pi briefly.)</li>
<li>Physical access to a <a href="../spellbook/linux" class="internal alias" data-slug="spellbook/linux">Linux</a> system. (This could actually be the Pi itself, if you’ve already got it up and running with another operating system.)</li>
<li>An HDMI monitor, microHDMI-to-HDMI cable, and a USB keyboard (only needed until we set up network access and USB gadget mode).</li>
</ul>
<h2 id="create-the-bootstrap-microsd-if-necessary">Create the bootstrap microSD (if necessary)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#create-the-bootstrap-microsd-if-necessary" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>If you’re setting the Pi up for the first time, you’ll need to burn a <a href="../spellbook/linux" class="internal alias" data-slug="spellbook/linux">Kali Linux</a> microSD card to bootstrap off of. (If you already have a working Pi, then this can be skipped.)</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Download the latest version of Kali Linux from</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># https://www.kali.org/get-kali/#kali-arm. Check that page to</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># see which file name you should be using here (2021.2 is</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># current at the time of this writing).</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">curl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -O</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> https://images.kali.org/arm-images/kali-linux-2021.2-rpi4-nexmon-64.img.xz</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Check the sha256 hash to make sure you've downloaded a good</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># file (the hash used below is for the 2021.2 image).</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sha256sum</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> kali-linux-2021.2-rpi4-nexmon-64.img.xz</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	grep</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -E</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">^97549d9e24dbd73add004b9521874dff6351a6275428356e804b98eb9e842c99 </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> &amp;&amp;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">SUCCESS - Download checksum looks good</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ||</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">FAILURE - Download checksum doesn't match expected value; file corrupt or incorrect</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># /dev/mmcblk0 is the SD card device on my system; YMMV. Be</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># sure to use the right device here, or you can hose your</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># system! If your system automatically mounts partitions on</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># insert, then you'll need to unmount them before performing</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># this step.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">xzcat</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> kali-linux-2021.2-rpi4-nexmon-64.img.xz</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> dd</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> of=/dev/mmcblk0</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> bs=4M</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> status=progress</span></span></code></pre></figure>
<p>There’s a small amount of free space on the Kali ROOTFS partition; it may be useful to drop any of the <a href="../spellbook/ssh" class="internal alias" data-slug="spellbook/ssh">SSH</a> private keys here that you’ll eventually want to use to use to log into the Pi here to make it easier to copy them into the right locations later.</p>
<p>Pop the microSD card out, throw it in your Pi, boot up, log in. <a href="https://www.kali.org/docs/introduction/default-credentials/" class="external" target="_blank">The first-run username and password are both kali.<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<p>We’ll need more space in ROOTFS than the Kali image provides out-of-the-box. The kalipi-config tool can make this happen, but unfortunately it doesn’t recognize the the 64-bit images as a Raspberry Pi! To fix this, you’ll need to edit /usr/bin/kalipi-config and hack the <code>is_pi()</code> function so that it always returns 0. Once you’ve done this, run <a href="https://raspberrypi.stackexchange.com/questions/46520/expand-file-system-kali-linux-on-sd-card-of-16gb/127378#127378" class="external" target="_blank"><code>sudo kalipi-config</code><svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> and use Advanced Options → Expand Filesystem to reclaim the rest of your microSD card’s space.</p>
<p>You’re now ready to bootstrap your <em>actual</em> system!</p>
<h2 id="set-up-the-encrypted-microsd-sard">Set up the encrypted microSD sard<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#set-up-the-encrypted-microsd-sard" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Download the latest version of Kali Linux from</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># https://www.kali.org/get-kali/#kali-arm. Check that page to</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># see which file name you should be using here (2021.2 is</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># current at the time of this writing).</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">curl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -O</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> https://images.kali.org/arm-images/kali-linux-2021.2-rpi4-nexmon-64.img.xz</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Check the sha256 hash to make sure you've downloaded a good</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># file (the hash used below is for the 2021.2 image).</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sha256sum</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> kali-linux-2021.2-rpi4-nexmon-64.img.xz</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	grep</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -E</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">^97549d9e24dbd73add004b9521874dff6351a6275428356e804b98eb9e842c99 </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> &amp;&amp;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">SUCCESS - Download checksum looks good</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ||</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">FAILURE - Download checksum doesn't match expected value; file corrupt or incorrect</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Decompress the image. Note that you may experience I/O hangs</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># while decompressing the image; just be patient and wait for</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># the Pi's little green light to stop flashing.)</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">unxz</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> kali-linux-2021.2-rpi4-nexmon-64.img.xz</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Everything from here on out needs to be run as root, so</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># let's use sudo to open a root shell now.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sudo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -s</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Mount the partitions in the Kali disk image. Your image</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># partitions will *probably* show up as /dev/loop0p1 and</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># /dev/loop0p2, but you may want to check the symlinks under</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># /dev/disk/by-label first, just to be sure.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">losetup</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -Pf</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> kali-linux-2021.2-rpi4-nexmon-64.img</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/img-{root,boot}</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /dev/loop0p1</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/img-boot</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /dev/loop0p2</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/img-root</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Now connect up the microSD card reader and insert the first</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># microSD card and partition it. My card shows up as</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># /dev/mmcblk1 (so that's what I'll be using moving forward),</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># but you'll want to double-check this; if you use the wrong</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># device here you can hose your system!</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Delete the current partition, make sure you're using a DOS</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># partition table, and then create two new partitions:</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># The first partition should be a primary partition 256MB in</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># size of type 0c (W95 FAT32 LBA).</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># The second partition should also be a primary partition. It</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># should use the remainder of the space and be of type 83</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># (Linux).</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">fdisk</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /dev/mmcblk1</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Format the new partitions, mount them, and copy over the</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># operating system files.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mkfs.vfat</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -v</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -n</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> BOOT</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /dev/mmcblk1p1</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">cryptsetup</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -v</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -y</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> luksFormat</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /dev/mmcblk1p2</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">cryptsetup</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> luksOpen</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /dev/mmcblk1p2</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> crypt_rootfs</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mkfs.ext4</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -v</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -L</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> ROOTFS</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /dev/mapper/crypt_rootfs</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-{root,boot}</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /dev/mmcblk1p1</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-boot</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /dev/mapper/crypt_rootfs</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">rsync</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -avh</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/img-boot/</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-boot/</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">rsync</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -avh</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/img-root/</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># You should copy your SSH public key(s) over to /mnt/ext-root </span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># at this point, as you'll eventually need these to unlock the</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Kali ROOTFS partition via dropbear. I'm not writing out that</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># step explicitly though; you could be generating a new</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># keypair here, using keys you copied over to the bootstrap</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># microSD above, or just copying ~/.ssh/authorized_keys from</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># an existing system. You do you.</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Make the Pi load an initramfs on boot.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">initramfs initramfs.zst followkernel</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> >></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-boot/config.txt</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Make sure the kernel knows where ROOTFS is. Note that we use</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># /dev/mmcblk0p2 here rather than /dev/mmcblk1p2, because</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># we're going to remove the current microSD card and use the</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># one we're creating in a moment, which means that on boot</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># this new card with be /dev/mmcblk0!</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -i</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">s#root=/dev/mmcblk0p2#root=/dev/mapper/crypt_rootfs cryptdevice=/dev/mmcblk0p2:crypt_rootfs#</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-boot/cmdline.txt</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Fix paths in /etc/fstab.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -i</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">s#/dev/mmcblk0p2#/dev/mapper/crypt_rootfs#</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/etc/fstab</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Add ROOTFS to /etc/crypttab.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">echo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">crypt_rootfs	/dev/mmcblk0p2	none	luks</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> >></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/etc/crypttab</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Now let's actually generate the initramfs we need. Note that</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># mkinitramfs wants a (missing) kernel config, so we copy one</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># over from linux-headers as a work-around.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mount</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -t</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> proc</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> none</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/proc</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mount</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -t</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> sysfs</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> none</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/sys</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mount</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -o</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> bind</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /dev</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/dev</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mount</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -o</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> bind</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /dev/pts</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/dev/pts</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mount</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -o</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> bind</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-boot</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/boot</span></span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">LANG</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">C</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> chroot</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">cp</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/src/linux-headers-</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">uname</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -r</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">/.config</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">   /boot/config-</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">uname</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -r</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mkinitramfs</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -o</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /boot/initramfs.zst</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> $(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">uname</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -r</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">exit</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Cleanup our mess.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">umount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/boot</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">umount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/dev/pts</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">umount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/dev</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">umount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/sys</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">umount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root/proc</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">umount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-root</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">cryptsetup</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> luksClose</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> crypt_rootfs</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">umount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-boot</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">umount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/img-root</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">umount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/img-boot</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">losetup</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -D</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">rm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -rf</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/ext-</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;">*</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /mnt/img-</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;">*</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">exit</span></span></code></pre></figure>
<p>Now comes the moment of truth: Shut down and unplug the Pi, remove the bootstrap microSD card and the reader, put the microSD card you just created (from the reader, with the encrypted ROOTFS) into the Pi, and then plug the Pi back in. If everything went right, you should be prompted to enter the decryption passphrase you set for the microSD card, after which boot will continue and you’ll be able to log into the desktop environment!</p>
<p>(Note that the console unlock message can sometimes get lost in the initial dmesg output.)</p>
<h2 id="first-boot">First boot<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#first-boot" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>After the first successful boot there’s some basic housekeeping that we should do.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Change the default user password.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">passwd</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Become root.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sudo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -s</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># System update. DPKG may ask you some questions during this</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># process.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">apt</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> update</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">apt</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> full-upgrade</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">apt</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> autoremove</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> --purge</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> --autoremove</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">apt</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> clean</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Update the (missing) kernel config.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">cp</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/src/linux-headers-</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ls</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -1</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /lib/modules</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> grep</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">-Re4son-v8l+$</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> sort</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> tail</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -1</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">/.config</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">   /boot/config-</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ls</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -1</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /lib/modules</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> grep</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">-Re4son-v8l+$</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> sort</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> tail</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -1</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Regenerate initramfs.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mkinitramfs</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -o</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /boot/initramfs.zst</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	$(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ls</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -1</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /lib/modules</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> grep</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">-Re4son-v8l+$</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> sort</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> tail</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -1</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Drop permissions.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">exit</span></span></code></pre></figure>
<p><a href="../spellbook/linux" class="internal alias" data-slug="spellbook/linux">Kali Linux</a> on the Raspberry Pi isn’t configured to use swap, which makes sense because normally it’s running from a slow microSD card. Still, having <a href="https://haydenjames.io/linux-performance-almost-always-add-swap-space/" class="external" target="_blank">some swap can aid system stability<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>. We’re going to split the baby by <a href="https://haydenjames.io/linux-performance-almost-always-add-swap-part2-zram/" class="external" target="_blank">enabling ZRAM<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>.</p>
<p>Begin by create /usr/local/sbin/zram.sh:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#!/usr/bin/bash</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">case</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">$1</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> in</span></span>
<span data-line><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">	&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">start</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> )</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">		# The &quot;-s&quot; option sets the size of the ZRAM device</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">		# *before* compression; ZRAM will *actually* use</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">		# something closer to 30% - 50% of this value, depending</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">		# on the compression algorithm used. As a rule of thumb,</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">		# set &quot;-s&quot; to be equal to the amount of RAM you actually</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">		# have *or* 8G, whichever is *less*.</span></span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">		ZRAMDEV</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">zramctl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -f</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> 8G </span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;">-a</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> zstd</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">		mkswap</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $ZRAMDEV</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">		swapon</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -p</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 10</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $ZRAMDEV</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	;;</span></span>
<span data-line><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">	&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">stop</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> )</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">		for</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> ZRAMDEV</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> in</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> $(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">awk</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">/zram/ { print $1 }</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /proc/swaps</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">);</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> do</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">			swapoff</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $ZRAMDEV</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">			zramctl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -r</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $ZRAMDEV</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">		done</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	;;</span></span>
<span data-line><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">	&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">restart</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> )</span></span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">		$0</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> stop</span></span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">		$0</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> start</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	;;</span></span>
<span data-line><span style="--shiki-light:#AB5E3F;--shiki-dark:#AB5E3F;">	-</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> )</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">		echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">USAGE: </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">basename</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">$0</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> (start|stop|restart)</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	;;</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">esac</span></span></code></pre></figure>
<p>Then create the systemd service file /etc/systemd/system/zram.service:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="ini" data-theme="vitesse-light vitesse-light"><code data-language="ini" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">Unit</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">]</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">Description</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">ZRAM-based virtual swap device</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">Requires</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">systemd-modules-load.service</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">Install</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">]</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">WantedBy</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">sysinit.target</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">Service</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">]</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">Type</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">oneshot</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">ExecStart</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">/usr/local/sbin/zram.sh start</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">ExecStop</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">/usr/local/sbin/zram.sh stop</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">RemainAfterExit</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">true</span></span></code></pre></figure>
<p>Finally, make sure that everything’s enabled.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Become root.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sudo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -s</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Make sure that the ZRAM module is loaded.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">echo</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> zram</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> >></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/modules</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Make the zram.sh script executable.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/local/sbin/zram.sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Enable required services.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> daemon-reload</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> enable</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> zram.service</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Encourage the kernel to preferentially clean up memory and</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># swap into ZRAM sooner.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">vm.vfs_cache_pressure=500</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> >></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/sysctl.conf</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">vm.swappiness=100</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> >></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/sysctl.conf</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">vm.dirty_background_ratio=1</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> >></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/sysctl.conf</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">vm.dirty_ratio=50</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> >></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/sysctl.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Drop permissions.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">exit</span></span></code></pre></figure>
<p>You should reboot after doing all of this.</p>
<h2 id="network-access-and-usb-gadget-mode">Network access and USB gadget mode<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#network-access-and-usb-gadget-mode" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Become root.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sudo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -s</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Install pre-requisits.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">apt</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> dnsmasq</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Update firmware overlay and initramfs kernel modules.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">dtoverlay=dwc2</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> >></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /boot/config.txt</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> ''</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> >></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/initramfs-tools/modules</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">echo</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> dwc2</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> >></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/initramfs-tools/modules</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Create /etc/network/interfaces.d/usb0.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">cat</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/network/interfaces.d/usb0</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> &lt;&lt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> EOF</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">auto usb0</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">allow-hotplug usb0</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">iface usb0 inet static</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">	address 10.55.0.1</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">	netmask 255.255.255.248</span></span>
<span data-line><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">EOF</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Create /etc/dnsmasq.d/ipad.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">cat</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/dnsmasq.d/ipad</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> &lt;&lt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> EOF</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">interface=usb0</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">dhcp-range=10.55.0.2,10.55.0.6,255.255.255.248,1h</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">dhcp-option=3</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">dhcp-option=6</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">dhcp-authoritative</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">leasefile-ro</span></span>
<span data-line><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">EOF</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Regenerate initramfs.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mkinitramfs</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -o</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /boot/initramfs.zst</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	$(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ls</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -1</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /lib/modules</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> grep</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">-Re4son-v8l+$</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> sort</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> tail</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -1</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Drop permissions.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">exit</span></span></code></pre></figure>
<p>Create /usr/local/sbin/usb0up.sh:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="sh" data-theme="vitesse-light vitesse-light"><code data-language="sh" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#!/bin/sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">modprobe</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> libcomposite</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /sys/kernel/config/usb_gadget</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">if</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> [</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> !</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> -d</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> pi4 </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">];</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> then</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	mkdir</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> pi4</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	cd</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> pi4</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0x1d6b</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> idVendor</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">  # Linux Foundation</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0x0104</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> idProduct</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"> # Multifunction Composite Gadget</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0x0100</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> bcdDevice</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"> # v1.0.0</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0x0200</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> bcdUSB</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">    # USB2</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0xef</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">   ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> bDeviceClass</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0x02</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">   ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> bDeviceSubClass</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0x01</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">   ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> bDeviceProtocol</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	mkdir</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> strings/0x409</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">  fedcba9876543211</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> strings/0x409/serialnumber</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">Kali Linux</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">      ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> strings/0x409/manufacturer</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">Kali Linux</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">      ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> strings/0x409/product</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	mkdir</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> configs/c.1/strings/0x409</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">Config 1: ECM network</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> configs/c.1/strings/0x409/configuration</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">  250</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">                    ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> configs/c.1/MaxPower</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	mkdir</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> functions/ecm.usb0</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">00:dc:c8:f7:75:14</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> functions/ecm.usb0/host_addr</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"> # HostPC</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">00:dd:dc:eb:6d:a1</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> functions/ecm.usb0/dev_addr</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">  # BadUSB</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	ln</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> functions/ecm.usb0</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> configs/c.1/ecm.usb0</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	udevadm</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> settle</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -t</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 5</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ||</span><span style="--shiki-light:#998418;--shiki-dark:#998418;"> :</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	ls</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /sys/class/udc</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> UDC</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">fi</span></span></code></pre></figure>
<p>Create /usr/local/sbin/usb0down.sh:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="sh" data-theme="vitesse-light vitesse-light"><code data-language="sh" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#!/bin/sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /sys/kernel/config/usb_gadget</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">if</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> [</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> -d</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> pi4 </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">];</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> then</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	cd</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> pi4</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> ''</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> UDC</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	rm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> configs/c.1/ecm.usb0</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	rmdir</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> functions/ecm.usb0</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	rmdir</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> configs/c.1/strings/0x409</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	rmdir</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> configs/c.1</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	rmdir</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> strings/0x409</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	cd</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> ..</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	rmdir</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> pi4</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	cd</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	rmmod</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> usb_f_ecm</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	rmmod</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> u_ether</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	rmmod</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> libcomposite</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">fi</span></span></code></pre></figure>
<p>The usb0down.sh script is something you won’t find in <a href="https://www.hardill.me.uk/wordpress/2019/11/02/pi4-usb-c-gadget/" class="external" target="_blank">other tutorials<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> about setting up a Raspberry Pi in USB gadget mode. Those all focus on bringing the usb0 interface up — none cover how to tear it down successfully. Unfortunately, iPadOS 15 doesn’t like it when USB ethernet gadget goes partially down when exiting the initramfs (we’ll cover this part of things in the next section). To work around this, we need to have the ability to <a href="https://e2e.ti.com/support/processors-group/processors/f/processors-forum/627474/linux-am3352-dynamic-reconfiguration-of-usb-gadget" class="external" target="_blank">completely remove usb0 so that the device doesn’t exist at all when the initramfs terminates and normal userland takes over<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>.</p>
<p>Now that we can bring usb0 <em>completely</em> up and down, let’s tie things together. Create the systemd service file /etc/systemd/system/usb0.service:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="ini" data-theme="vitesse-light vitesse-light"><code data-language="ini" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">Unit</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">]</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">Description</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Raspberry Pi USB C ethernet gadget mode</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">Before</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">network.target NetworkManager.service dnsmasq.service</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">Requires</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">systemd-modules-load.service</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">Install</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">]</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">WantedBy</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">sysinit.target</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">Service</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">]</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">Type</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">oneshot</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">ExecStartPre</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">/usr/local/sbin/usb0up.sh</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">ExecStart</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">/usr/sbin/ifup usb0</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">ExecStop</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">/usr/sbin/ifdown usb0</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">ExecStopPost</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">/usr/local/sbin/usb0down.sh</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">RemainAfterExit</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">true</span></span></code></pre></figure>
<p>Finally, let’s activate everything.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Become root.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sudo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -s</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Make our usb0.sh script executable.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/local/sbin/usb0up.sh</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/local/sbin/usb0down.sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Enable required services.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> daemon-reload</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> enable</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> dnsmasq.service</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> enable</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> usb0.service</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Drop permissions.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">exit</span></span></code></pre></figure>
<p>Second moment of truth: Shut down the system, remove the power, and connect the Pi to your iPad over USB C. The Pi should power on, and then shortly after you unlock the ROOTFS the iPad should be assigned an <a href="../spellbook/ipv4" class="internal alias" data-slug="spellbook/ipv4">IPv4</a> address via the ethernet device “Kali Linux”. You should then be able to <a href="../spellbook/ssh" class="internal alias" data-slug="spellbook/ssh">SSH</a> in as kali@10.55.0.1.</p>
<h2 id="rootfs-unlock-over-ssh">RootFS unlock over SSH<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#rootfs-unlock-over-ssh" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Become root.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sudo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -s</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Install dropbear + initramfs hooks.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">apt</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> dropbear-initramfs</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Align dropbear SSH host keys with OpenSSH. Normally this</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># isn't considered a best practice, but...</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#     (1) We're only ever connecting to the Pi over usb0, not</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#         an open network (or, god forbid, the internet).</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#     (2) We're actually going to take steps in a moment to</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#         MAKE SURE that (1) is true.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Since we're only connecting to the Pi via SSH over a SINGLE</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># cable, using a private IP address, and with SSH host keys</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># that are unique to this device, the danger of having these</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># keys disclosed in the event that someone got ahold of the</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Pi's microSD card seems minimal (after all, such an attacker</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># could just trojan the initramfs.zst directly).</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># (Note that you should make sure to set an EMPTY password</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># when using ssh-keygen to convert they keys to PEM format, as</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># dropbear doesn't support password-protected host keys.)</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/dropbear/initramfs</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">rm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> dropbear_</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;">*</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">_host_key</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">cp</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/ssh/ssh_host_</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;">*</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">_key</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> .</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">for</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> SSH_KEY</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> in</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> $(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ls</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -1</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> ssh_host_</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;">*</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">_key</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">);</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> do</span></span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">	DROPBEAR_KEY</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$(</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">$SSH_KEY</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">		sed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">s/ssh_host_\(.*\)_key/dropbear_\1_host_key/</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	ssh-keygen</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -m</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> PEM</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -p</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -f</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $SSH_KEY</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	dropbearconvert</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> openssh</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> dropbear</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $SSH_KEY</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $DROPBEAR_KEY</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	rm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -f</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $SSH_KEY</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">done</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># At this point you'll need to add your SSH public keys to</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># /etc/dropbear/initramfs/authorized_keys. I'm not writing out</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># this step explicitly though; you could be generating a new</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># keypair here, using keys you copied over when setting up the</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># encrypted microSD card, or just copying</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># ~/.ssh/authorized_keys (and making sure that the permissions</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># are right!). You do you.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># That said!</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># As a fan of per-host keys I'm not in love with this step,</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># since it means that if I reset my iPad then I need an</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># external keyboard to unlock the Pi before I can copy over</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># the new public key. Unfortunately, I don't see any way to</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># support a password-based login (which I think is &quot;secure</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># enough&quot; in here for the same reason that I think that</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># re-using the SSH host keys is &quot;secure enough&quot; in this</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># particular context) without modifying dropbear's initramfs</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># setup hook (which I'd rather not do, as any changes will be</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># overwritten if the dropbear-initramfs package is updated).</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Add dropbear configuration options. In particular, for an</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># unlock of ROOTFS on successful login.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -i</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">s;^#DROPBEAR_OPTIONS=$;DROPBEAR_OPTIONS=&quot;-jks -c /usr/bin/cryptroot-unlock-ssh&quot;;</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/dropbear/initramfs/config</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Drop permissions.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">exit</span></span></code></pre></figure>
<p>Create /usr/local/sbin/cryptroot-unlock-ssh.sh:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="sh" data-theme="vitesse-light vitesse-light"><code data-language="sh" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#!/bin/sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">ROOTFS_DEV</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">crypt_rootfs</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">if</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> [</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> !</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> -b</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> /dev/mapper/</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">$ROOTFS_DEV</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> ];</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> then</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">	if</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> [</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> -f</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> /cryptroot/crypttab </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">];</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> then</span></span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">		ROOTFS_UID</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">`</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">grep</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> $ROOTFS_DEV /cryptroot/crypttab </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> cut</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -d</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -f</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 2</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">`</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">	elif</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> [</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> -f</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> /etc/crypttab </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">];</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> then</span></span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">		ROOTFS_UID</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">`</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">grep</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> $ROOTFS_DEV /etc/crypttab </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> cut</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -f</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 2</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">`</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">	else</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">		exit</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">	fi</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">	/usr/sbin/cryptsetup</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> luksOpen</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $ROOTFS_UID</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $ROOTFS_DEV</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> &amp;&amp;</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> killall</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> cryptroot</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">fi</span></span></code></pre></figure>
<p>Create /usr/share/initramfs-tools/hooks/cryptroot-unlock-ssh:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="sh" data-theme="vitesse-light vitesse-light"><code data-language="sh" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#!/bin/sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PREREQ</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">prereqs</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">()</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> {</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">$PREREQ</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">case</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">$1</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> in</span></span>
<span data-line><span style="--shiki-light:#AB5E3F;--shiki-dark:#AB5E3F;">	prereqs</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">)</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">		prereqs</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">		exit</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	;;</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">esac</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">.</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/share/initramfs-tools/hooks-functions</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">copy_file</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> script</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/local/sbin/cryptroot-unlock-ssh.sh</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/bin/cryptroot-unlock-ssh</span></span></code></pre></figure>
<p>Create /usr/share/initramfs-tools/hooks/ipad:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="sh" data-theme="vitesse-light vitesse-light"><code data-language="sh" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#!/bin/sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PREREQ</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">prereqs</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">()</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> {</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">$PREREQ</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">case</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">$1</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> in</span></span>
<span data-line><span style="--shiki-light:#AB5E3F;--shiki-dark:#AB5E3F;">	prereqs</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">)</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">		prereqs</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">		exit</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	;;</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">esac</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">.</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/share/initramfs-tools/hooks-functions</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">manual_add_modules</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> dwc2</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> libcomposite</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> usb_f_ecm</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">copy_file</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> script</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/local/sbin/usb0up.sh</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/sbin/usb0up.sh</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">copy_file</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> script</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/local/sbin/usb0down.sh</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/sbin/usb0down.sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">copy_exec</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/sbin/dnsmasq</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">copy_file</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> config</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/dnsmasq.d/ipad</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/dnsmasq.conf</span></span></code></pre></figure>
<p>Create /usr/share/initramfs-tools/scripts/init-top/ipad:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="sh" data-theme="vitesse-light vitesse-light"><code data-language="sh" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#!/bin/sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PREREQ</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">udev</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">prereqs</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">()</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> {</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">$PREREQ</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">case</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">$1</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> in</span></span>
<span data-line><span style="--shiki-light:#AB5E3F;--shiki-dark:#AB5E3F;">	prereqs</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">)</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">		prereqs</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">		exit</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	;;</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">esac</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">.</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /scripts/functions</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mount</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -t</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> configfs</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> none</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /sys/kernel/config</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">.</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/sbin/usb0up.sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ipconfig</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -d</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">10.55.0.1:::255.255.255.248:kali:usb0</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">/usr/sbin/dnsmasq</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> --local-service</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> --user=root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> --pid-file=/run/dnsmasq.pid</span></span></code></pre></figure>
<p>Create /usr/share/initramfs-tools/scripts/local-bottom/ipad:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="sh" data-theme="vitesse-light vitesse-light"><code data-language="sh" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#!/bin/sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PREREQ</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">prereqs</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">()</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> {</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">	echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">$PREREQ</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">case</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">$1</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> in</span></span>
<span data-line><span style="--shiki-light:#AB5E3F;--shiki-dark:#AB5E3F;">	prereqs</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">)</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">		prereqs</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">		exit</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	;;</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">esac</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">.</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /scripts/functions</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">kill</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -TERM</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> `</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">cat</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /run/dnsmasq.pid</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">`</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ip</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> link</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> dev</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> usb0</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> down</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ip</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> address</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> flush</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> dev</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> usb0</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ip</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> route</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> flush</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> dev</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> usb0</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">.</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/sbin/usb0down.sh</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">umount</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /sys/kernel/config</span></span></code></pre></figure>
<p>Fix up permissions and finish setting things up:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Become root.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sudo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -s</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Make sure that new initramfs-tools scripts are executable.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/local/sbin/cryptroot-unlock-ssh.sh</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/share/initramfs-tools/hooks/cryptroot-ssh</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/share/initramfs-tools/hooks/ipad</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/share/initramfs-tools/scripts/init-top/ipad</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /usr/share/initramfs-tools/scripts/local-bottom/ipad</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Regenerate initramfs.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">mkinitramfs</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -o</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /boot/initramfs.zst</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> $(</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ls</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -1</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /lib/modules</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> grep</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">-Re4son-v8l+$</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> sort</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> tail</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -1</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Drop permissions.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">exit</span></span></code></pre></figure>
<p>Third moment of truth: Reboot your system. After a few moments you should be able to <a href="../spellbook/ssh" class="internal alias" data-slug="spellbook/ssh">SSH</a> into it as root@10.55.0.1 (over USB C) and be prompted to unlock your root device. After you type in your decryption passphrase, <a href="../spellbook/ssh" class="internal alias" data-slug="spellbook/ssh">SSH</a> should automatically close and your system should continue to boot. In a few more moments you should be able to <a href="../spellbook/ssh" class="internal alias" data-slug="spellbook/ssh">SSH</a> back in as kali@10.55.0.1.</p>
<p>You can <em>also</em> still unlock the system at the console, which is handy if you want to use the Pi as a stand-alone computer.</p>
<p>Note an annoying feature of this setup — you have to <a href="../spellbook/ssh" class="internal alias" data-slug="spellbook/ssh">SSH</a> in as <em>root</em> to do the initial unlock, but then will need to <a href="../spellbook/ssh" class="internal alias" data-slug="spellbook/ssh">SSH</a> in a second time as <em>kali</em> once the system is fully up. Partly, this is due to the fact that there’s not really a way to hand <a href="../spellbook/ssh" class="internal alias" data-slug="spellbook/ssh">SSH</a> off from the initram environment to the full system (this is why you have to log in once to unlock, and again to use the system once it’s fully up). Theoretically it should be possible to add a kali user to the initramfs, but doing so would require both the dropbear initramfs hooks to be modified (which, as previously mentioned, is fragile w.r.t. upgrades) and <em>a lot</em> more magic in generally than seems advisable.</p>
<h2 id="network-hardening">Network hardening<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#network-hardening" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Now that we’ve got the Pi working with our iPad, we’re going to lock down networking a bit</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Become root.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sudo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -s</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Limit SSH access to the kali user over usb0.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">cat</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/ssh/sshd_config.d/lockdown.conf</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> &lt;&lt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> EOF</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">AllowUsers kali</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">ListenAddress 10.55.0.1</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">PermitRootLogin no</span></span>
<span data-line><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">EOF</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> sshd.service</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Basic firewall.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">apt</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> gufw</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> start</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> ufw.service</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> default</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> deny</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> allow</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> in</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> on</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> usb0</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> from</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> 0.0.0.0/0</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> port</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 68</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> 0.0.0.0/0</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> port</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 67</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> proto</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> udp</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> allow</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> in</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> on</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> usb0</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> from</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> 10.55.0.0/29</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> to</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 10.55.0.1</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> port</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 22</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> proto</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> tcp</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> enable</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Drop permissions.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">exit</span></span></code></pre></figure>
<p>If you’re going to be using this device covertly, you almost certainly also want to run <code>sudo systemctl disable NetworkManager.service</code> so that the Pi doesn’t attempt to immediately connect to whatever network you plug it into.</p>
<h2 id="remote-desktop">Remote desktop<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#remote-desktop" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Become root.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sudo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -s</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Install xrdp.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">apt</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> xrdp</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Turn off &quot;new&quot; cursors, as this causes problems with some</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># RDP clients. This isn't necessary if you're using Microsoft</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Remote Desktop, but is required to avoid the cursor being</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># surrounded by a weird box on Jump Desktop. The trade-off</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># here is that the &quot;new&quot; cursors look really nice, while the</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># &quot;old&quot; cursors... Do not.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">sed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -i</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> '</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">s/^new_cursors=true$/new_cursors=false/</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">'</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> /etc/xrdp/xrdp.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Allow connections in over usb0.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> allow</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> in</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> on</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> usb0</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> from</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> 10.55.0.0/29</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> to</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 10.55.0.1</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> port</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 3389</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> proto</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> tcp</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Enable xrdp.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> enable</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> xrdp.service</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Drop permissions.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">exit</span></span></code></pre></figure>
<p>You should now be able to log in using RDP. Standard resolutions work well, but HiDPI/Retina is only marginally more responsive than a slideshow.</p>
<p>As with the dropbear configuration in the previous section, please do <em>not</em> set up RDP like I’m presenting here if you’re using a device that’s exposed to a larger network, or worse yet the internet as a whole. In the real world, RDP servers should <em>only</em> be accessible over <a href="../spellbook/ssh" class="internal alias" data-slug="spellbook/ssh">SSH</a>, a VPN, or some other secure wrapper — never exposed directly as we’re doing here. The reason we can get away with less is (again) because we’re <em>only</em> exposing RDP over the usb0 interface, and the <em>only</em> other device that ever lives on that network is the iPad.</p>
<blockquote class="callout note" data-callout="note">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>NOTE</p></div>
                  
                </div>
<div class="callout-content">
<p>I use <a href="https://apps.apple.com/us/app/jump-desktop-rdp-vnc-fluid/id364876095" class="external" target="_blank">Jump Desktop<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> as my RDP client, rather than <a href="https://apps.apple.com/us/app/remote-desktop-mobile/id714464092" class="external" target="_blank">Microsoft Remote Desktop<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> — while Microsoft’s offering is overall nicer, Jump Desktop is faster and will connect even when the iPad’s <a href="../spells/wifi" class="internal alias" data-slug="spells/wifi">Wi-Fi</a> is disconnected (Microsoft will refuse to connect if <a href="../spells/wifi" class="internal alias" data-slug="spells/wifi">Wi-Fi</a> is disabled, even though the Pi is accessible via USB ethernet!).</p>
</div>
</blockquote></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" id="toc" class><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-0"><a href="#hardware-and-software" data-for="hardware-and-software">Hardware and software</a></li><li class="depth-0"><a href="#create-the-bootstrap-microsd-if-necessary" data-for="create-the-bootstrap-microsd-if-necessary">Create the bootstrap microSD (if necessary)</a></li><li class="depth-0"><a href="#set-up-the-encrypted-microsd-sard" data-for="set-up-the-encrypted-microsd-sard">Set up the encrypted microSD sard</a></li><li class="depth-0"><a href="#first-boot" data-for="first-boot">First boot</a></li><li class="depth-0"><a href="#network-access-and-usb-gadget-mode" data-for="network-access-and-usb-gadget-mode">Network access and USB gadget mode</a></li><li class="depth-0"><a href="#rootfs-unlock-over-ssh" data-for="rootfs-unlock-over-ssh">RootFS unlock over SSH</a></li><li class="depth-0"><a href="#network-hardening" data-for="network-hardening">Network hardening</a></li><li class="depth-0"><a href="#remote-desktop" data-for="remote-desktop">Remote desktop</a></li></ul></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li><a href="../spells/how-to-use-burp-suite-with-firefox" class="internal">How to use Burp Suite with Firefox</a></li><li><a href="../commentaries/2022-08-15-notes-from-hope-and-def-con" class="internal">Notes from HOPE and DEF CON</a></li></ul></div></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.2.4</a> © 2024</p><ul><li><a href="/">Home</a></li><li><a href="https://github.com/necopinus/resume/raw/main/resume.pdf">Resume</a></li><li><a href="/#contact">Contact</a></li><li><a href="/grimoire/index.xml">RSS Feed</a></li></ul></footer></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script type="module">
          let mermaidImport = undefined
          document.addEventListener('nav', async () => {
            if (document.querySelector("code.mermaid")) {
              mermaidImport ||= await import('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs')
              const mermaid = mermaidImport.default
              const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
              mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: darkMode ? 'dark' : 'default'
              })

              await mermaid.run({
                querySelector: '.mermaid'
              })
            }
          });
          </script><script src="../postscript.js" type="module"></script></html>