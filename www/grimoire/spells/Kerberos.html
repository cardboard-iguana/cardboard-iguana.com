<!DOCTYPE html>
<html lang="en"><head><title>Kerberos :: Cardboard Iguana Security</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto Sans:wght@400;700&amp;family=Noto Sans:ital,wght@0,400;0,600;1,400;1,600&amp;family=Noto Sans Mono:wght@400;600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="Cardboard Iguana Security"/><meta property="og:title" content="Kerberos :: Cardboard Iguana Security"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Kerberos :: Cardboard Iguana Security"/><meta name="twitter:description" content="Kerberos: The default authentication method for Windows domains. Intended to be the successor to NTLM."/><meta property="og:description" content="Kerberos: The default authentication method for Windows domains. Intended to be the successor to NTLM."/><meta property="og:image:alt" content="Kerberos: The default authentication method for Windows domains. Intended to be the successor to NTLM."/><meta property="og:image" content="https://cardboard-iguana.com/grimoire/static/og-image.png"/><meta property="og:image:url" content="https://cardboard-iguana.com/grimoire/static/og-image.png"/><meta name="twitter:image" content="https://cardboard-iguana.com/grimoire/static/og-image.png"/><meta property="og:image:type" content="image/.png"/><meta property="twitter:domain" content="cardboard-iguana.com/grimoire"/><meta property="og:url" content="https://cardboard-iguana.com/grimoire/spells/Kerberos"/><meta property="twitter:url" content="https://cardboard-iguana.com/grimoire/spells/Kerberos"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="Kerberos: The default authentication method for Windows domains. Intended to be the successor to NTLM."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><style>.expand-button {
  position: absolute;
  display: flex;
  float: right;
  padding: 0.4rem;
  margin: 0.3rem;
  right: 0;
  color: var(--gray);
  border-color: var(--dark);
  background-color: var(--light);
  border: 1px solid;
  border-radius: 5px;
  opacity: 0;
  transition: 0.2s;
}
.expand-button > svg {
  fill: var(--light);
  filter: contrast(0.3);
}
.expand-button:hover {
  cursor: pointer;
  border-color: var(--secondary);
}
.expand-button:focus {
  outline: 0;
}

pre:hover > .expand-button {
  opacity: 1;
  transition: 0.2s;
}

#mermaid-container {
  position: fixed;
  contain: layout;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: none;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.5);
}
#mermaid-container.active {
  display: inline-block;
}
#mermaid-container > #mermaid-space {
  border: 1px solid var(--lightgray);
  background-color: var(--light);
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 80vh;
  width: 80vw;
  overflow: hidden;
}
#mermaid-container > #mermaid-space > .mermaid-content {
  padding: 2rem;
  position: relative;
  transform-origin: 0 0;
  transition: transform 0.1s ease;
  overflow: visible;
  min-height: 200px;
  min-width: 200px;
}
#mermaid-container > #mermaid-space > .mermaid-content pre {
  margin: 0;
  border: none;
}
#mermaid-container > #mermaid-space > .mermaid-content svg {
  max-width: none;
  height: auto;
}
#mermaid-container > #mermaid-space > .mermaid-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  padding: 8px;
  background: var(--light);
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--lightgray);
  background: var(--light);
  color: var(--dark);
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-family: var(--bodyFont);
  transition: all 0.2s ease;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:hover {
  background: var(--lightgray);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:active {
  transform: translateY(1px);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:nth-child(2) {
  width: auto;
  padding: 0 12px;
  font-size: 14px;
}
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiL1VzZXJzL25lY29waW51cy9SZXBvcy9jYXJkYm9hcmQtaWd1YW5hLmNvbS9idWlsZC9xdWFydHovcXVhcnR6L2NvbXBvbmVudHMvc3R5bGVzIiwic291cmNlcyI6WyJtZXJtYWlkLmlubGluZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBOztBQUdGO0VBQ0U7RUFDQTs7QUFHRjtFQUNFOzs7QUFLRjtFQUNFO0VBQ0E7OztBQUlKO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFOztBQUdGO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7O0FBR0Y7RUFDRTtFQUNBOztBQUlKO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTs7QUFHRjtFQUNFOztBQUlGO0VBQ0U7RUFDQTtFQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLmV4cGFuZC1idXR0b24ge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsb2F0OiByaWdodDtcbiAgcGFkZGluZzogMC40cmVtO1xuICBtYXJnaW46IDAuM3JlbTtcbiAgcmlnaHQ6IDA7IC8vIE5PVEU6IHJpZ2h0IHdpbGwgYmUgc2V0IGluIG1lcm1haWQuaW5saW5lLnRzXG4gIGNvbG9yOiB2YXIoLS1ncmF5KTtcbiAgYm9yZGVyLWNvbG9yOiB2YXIoLS1kYXJrKTtcbiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbGlnaHQpO1xuICBib3JkZXI6IDFweCBzb2xpZDtcbiAgYm9yZGVyLXJhZGl1czogNXB4O1xuICBvcGFjaXR5OiAwO1xuICB0cmFuc2l0aW9uOiAwLjJzO1xuXG4gICYgPiBzdmcge1xuICAgIGZpbGw6IHZhcigtLWxpZ2h0KTtcbiAgICBmaWx0ZXI6IGNvbnRyYXN0KDAuMyk7XG4gIH1cblxuICAmOmhvdmVyIHtcbiAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1zZWNvbmRhcnkpO1xuICB9XG5cbiAgJjpmb2N1cyB7XG4gICAgb3V0bGluZTogMDtcbiAgfVxufVxuXG5wcmUge1xuICAmOmhvdmVyID4gLmV4cGFuZC1idXR0b24ge1xuICAgIG9wYWNpdHk6IDE7XG4gICAgdHJhbnNpdGlvbjogMC4ycztcbiAgfVxufVxuXG4jbWVybWFpZC1jb250YWluZXIge1xuICBwb3NpdGlvbjogZml4ZWQ7XG4gIGNvbnRhaW46IGxheW91dDtcbiAgei1pbmRleDogOTk5O1xuICBsZWZ0OiAwO1xuICB0b3A6IDA7XG4gIHdpZHRoOiAxMDB2dztcbiAgaGVpZ2h0OiAxMDB2aDtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgZGlzcGxheTogbm9uZTtcbiAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDRweCk7XG4gIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC41KTtcblxuICAmLmFjdGl2ZSB7XG4gICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICB9XG5cbiAgJiA+ICNtZXJtYWlkLXNwYWNlIHtcbiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcbiAgICBib3JkZXItcmFkaXVzOiA1cHg7XG4gICAgcG9zaXRpb246IGZpeGVkO1xuICAgIHRvcDogNTAlO1xuICAgIGxlZnQ6IDUwJTtcbiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTtcbiAgICBoZWlnaHQ6IDgwdmg7XG4gICAgd2lkdGg6IDgwdnc7XG4gICAgb3ZlcmZsb3c6IGhpZGRlbjtcblxuICAgICYgPiAubWVybWFpZC1jb250ZW50IHtcbiAgICAgIHBhZGRpbmc6IDJyZW07XG4gICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICB0cmFuc2Zvcm0tb3JpZ2luOiAwIDA7XG4gICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcyBlYXNlO1xuICAgICAgb3ZlcmZsb3c6IHZpc2libGU7XG4gICAgICBtaW4taGVpZ2h0OiAyMDBweDtcbiAgICAgIG1pbi13aWR0aDogMjAwcHg7XG5cbiAgICAgIHByZSB7XG4gICAgICAgIG1hcmdpbjogMDtcbiAgICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgfVxuXG4gICAgICBzdmcge1xuICAgICAgICBtYXgtd2lkdGg6IG5vbmU7XG4gICAgICAgIGhlaWdodDogYXV0bztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAmID4gLm1lcm1haWQtY29udHJvbHMge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgYm90dG9tOiAyMHB4O1xuICAgICAgcmlnaHQ6IDIwcHg7XG4gICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgZ2FwOiA4cHg7XG4gICAgICBwYWRkaW5nOiA4cHg7XG4gICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1saWdodCk7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgICAgYm9yZGVyLXJhZGl1czogNnB4O1xuICAgICAgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwgMCwgMCwgMC4xKTtcbiAgICAgIHotaW5kZXg6IDI7XG5cbiAgICAgIC5tZXJtYWlkLWNvbnRyb2wtYnV0dG9uIHtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICAgIHdpZHRoOiAzMnB4O1xuICAgICAgICBoZWlnaHQ6IDMycHg7XG4gICAgICAgIHBhZGRpbmc6IDA7XG4gICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0KTtcbiAgICAgICAgY29sb3I6IHZhcigtLWRhcmspO1xuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgICBmb250LWZhbWlseTogdmFyKC0tYm9keUZvbnQpO1xuICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlO1xuXG4gICAgICAgICY6aG92ZXIge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIH1cblxuICAgICAgICAmOmFjdGl2ZSB7XG4gICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDFweCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdHlsZSB0aGUgcmVzZXQgYnV0dG9uIGRpZmZlcmVudGx5XG4gICAgICAgICY6bnRoLWNoaWxkKDIpIHtcbiAgICAgICAgICB3aWR0aDogYXV0bztcbiAgICAgICAgICBwYWRkaW5nOiAwIDEycHg7XG4gICAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0= */</style><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://cardboard-iguana.com/grimoire/index.xml"/></head><body data-slug="spells/Kerberos"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"></div><div class="center"><div class="page-header"><header><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="..">Cardboard Iguana Security</a><p> / </p></div><div class="breadcrumb-element"><a href="../spells">spells</a><p> / </p></div><div class="breadcrumb-element"><a href>Kerberos</a></div></nav></header><div class="popover-hint"><p show-comma="true" class="content-meta"><time datetime="2025-06-14T22:37:21.816Z">Saturday, June 14, 2025</time><span>6 min read</span></p><ul class="tags"><li><a href="../tags/Protocol/Kerberos" class="internal tag-link">Protocol/Kerberos</a></li><li><a href="../tags/OS/Windows/ActiveDirectory" class="internal tag-link">OS/Windows/ActiveDirectory</a></li><li><a href="../tags/Application/Mimikatz" class="internal tag-link">Application/Mimikatz</a></li><li><a href="../tags/Application/Rubeus" class="internal tag-link">Application/Rubeus</a></li><li><a href="../tags/FileFormat/kirbi" class="internal tag-link">FileFormat/kirbi</a></li><li><a href="../tags/Cryptography/Hashes/NT" class="internal tag-link">Cryptography/Hashes/NT</a></li><li><a href="../tags/AttackCycle/PrivEsc" class="internal tag-link">AttackCycle/PrivEsc</a></li><li><a href="../tags/AttackCycle/LateralMovement" class="internal tag-link">AttackCycle/LateralMovement</a></li><li><a href="../tags/AttackCycle/Exploitation/Kerberoasting" class="internal tag-link">AttackCycle/Exploitation/Kerberoasting</a></li><li><a href="../tags/Application/PowerShell/Invoke-Kerberoast" class="internal tag-link">Application/PowerShell/Invoke-Kerberoast</a></li><li><a href="../tags/Application/Hashcat" class="internal tag-link">Application/Hashcat</a></li><li><a href="../tags/Application/JohnTheRipper" class="internal tag-link">Application/JohnTheRipper</a></li><li><a href="../tags/OS/Linux/Distros/Kali" class="internal tag-link">OS/Linux/Distros/Kali</a></li><li><a href="../tags/AttackCycle/Exploitation/AS-REPRoasting" class="internal tag-link">AttackCycle/Exploitation/AS-REPRoasting</a></li><li><a href="../tags/AttackCycle/PrivEsc/GoldenTickets" class="internal tag-link">AttackCycle/PrivEsc/GoldenTickets</a></li><li><a href="../tags/AttackCycle/LateralMovement/SilverTickets" class="internal tag-link">AttackCycle/LateralMovement/SilverTickets</a></li></ul></div></div><article class="popover-hint"><p>Kerberos: The default authentication method for Windows domains. Intended to be the successor to NTLM.</p>
<p>The built-in Windows command klist will show you the current Kerberos tickets in memory.</p>
<h2 id="terminology">Terminology<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#terminology" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li><strong>Ticket Granting Ticket (TGT):</strong> An authentication ticket that can be used to request service tickets for specific domain services from the ticket granting service.</li>
<li><strong>Key Distribution Center (KDC):</strong> A domain service that issues tickets; typically composed of the ticket granting service and the authentication service.</li>
<li><strong>Authentication Service (AS):</strong> Issues ticket granting tickets. (Presumably in charge of <em>authenticating</em> users and automations.)</li>
<li><strong>Ticket Granting Service (TGS):</strong> Issues tickets for domain services (and machines?) when presented with a ticket granting ticket. (Presumably in charge of <em>authorizing</em> users and automations.)</li>
<li><strong>Service Principal Name (SPN):</strong> A service identifier. On Windows, SPNs associates a particular service instance with a domain account. All services must have a domain service account. (But it sounds like services might be associated with <em>multiple</em> accounts via multiple principal names assigned to multiple running instances?)</li>
<li><strong>KDC Long Term Secret Key (KDC LT Key):</strong> A secret key used to encrypt ticket granting tickets and sign privilege attribute certificates. This is the NT hash of the KRBTGT service account.</li>
<li><strong>Service Long Term Secret Key (Service LT Key):</strong> A secret key associated with a particular service. Used to encrypt the service portion of a service ticket and sign privilege attribute certificates. Held by individual domain service accounts.</li>
<li><strong>Session Key:</strong> Issued with a ticket to identify a particular user session. Services expects <em>both</em> a ticket and a session key to be present before acting on a user’s behalf.</li>
<li><strong>Privilege Attribute Certificate (PAC):</strong> A bundle of the user’s identifying information, which is provided along with the tickets. Importantly, this contains the user’s username and (on Windows) SID.</li>
</ul>
<p>Note that Active Directory bundles the authentication service, ticket granting service, and KDC into a single “domain controller” role. Non-Windows Kerberos implementations are more likely to separate these roles between different servers.</p>
<h2 id="authentication-process">Authentication process<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#authentication-process" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>The below steps are cut-and-pasted from <a href="https://en.wikipedia.org/wiki/Kerberos_%28protocol%29" class="external" target="_blank">Wikipedia’s walk-through<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>, but with language adapted to match the Windows-specific environment Kerberos is most commonly deployed in. (A close reading of these steps will also explain why it’s sometimes said that “a hash is as good as a password” for a Window’s domain.)</p>
<h2 id="client-authentication-to-the-kdc-aka-pre-authentication">Client authentication to the KDC (a.k.a. “pre-authentication”)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#client-authentication-to-the-kdc-aka-pre-authentication" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ol>
<li>
<p>AS-REQ: The client sends the client/user ID + the current timestamp (the timestamp is used to prevent replay attacks) encrypted with the NT hash of the user’s password + a cleartext message of the user ID to the authentication server to request services on behalf of the user.</p>
</li>
<li>
<p>AS-REP: The authentication server checks to see if the client/user ID is in its database and if it can decrypt the timestamp using the NT hash of the password stored there. If it can, then the authentication server sends back the following two messages to the client:</p>
<ul>
<li>Message A: <em>Client/TGS Session Key</em> encrypted using the NT hash of the client/user.</li>
<li>Message B: <em>Ticket Granting Ticket</em> (including the privilege attribute certificate, client network address, ticket validity period, and the <em>Client/TGS Session Key</em>) encrypted using the KDC long term secret key.</li>
</ul>
</li>
<li>
<p>Once the client receives messages A and B, it attempts to decrypt message A with the NT hash generated from the password entered by the user. If the user entered password does not match the password in the authentication service database then decryption of message A will fail. Once message A is decrypted, the client obtains the <em>Client/TGS Session Key</em>. This session key is used for further communications with the ticket granting service.</p>
</li>
</ol>
<blockquote class="callout important" data-callout="important">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Important</p></div>
                  
                </div>
<div class="callout-content">
<div class="callout-content-inner">
<p>The client cannot decrypt Message B, as it is encrypted using the KDC long term secret key.</p>
</div>
</div>
</blockquote>
<h2 id="client-service-authorization">Client service authorization<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#client-service-authorization" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ol>
<li>
<p>TGS-REQ: When requesting services, the client sends the following messages to the ticket granting service:</p>
<ul>
<li>Message C: Composed of the ticket granting ticket and the service principal name of the requested service.</li>
<li>Message D: Authenticator (which is composed of the client ID and the timestamp), encrypted using the <em>Client/TGS Session Key</em>.</li>
</ul>
</li>
<li>
<p>TGS-REP: Upon receiving messages C and D, the ticket granting service retrieves the ticket granting ticket out of message C and decrypts it using the KDC long term secret key. This gives it the <em>Client/TGS Session Key</em> and the client ID (the client ID is part of the privilege attribute certificate). Using the <em>Client/TGS Session Key</em>, the ticket granting service decrypts message D (Authenticator) and compares the client IDs from the ticket granting ticket and message D; if they match, the server sends the following two messages to the client:</p>
<ul>
<li>Message E: <em>Service ticket</em> (which includes the privilege attribute certificate, client network address, validity period, and <em>Client/Server Session Key</em>) encrypted using the service’s long term secret key.</li>
<li>Message F: <em>Client/Server Session Key</em> encrypted with the <em>Client/TGS Session Key</em>.</li>
</ul>
</li>
</ol>
<h2 id="client-service-access">Client service access<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#client-service-access" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ol>
<li>
<p>AP-REQ: Upon receiving messages E and F from ticket granting service, the client has enough information to authenticate itself to the service server. The client connects to the service server and sends the following two messages:</p>
<ul>
<li>Message E: The <em>service ticket</em> (as provided by the ticket granting service; see above).</li>
<li>Message G: A new Authenticator, which includes the client ID, timestamp and is encrypted using <em>Client/Server Session Key</em>.</li>
</ul>
</li>
<li>
<p>AP-REP: The service server decrypts the service ticket (message E) using its long term secret key to retrieve the <em>Client/Server Session Key</em>. Using the sessions key, it then decrypts the Authenticator and compares client ID from the service ticket and message G. If they match the server sends the following message to the client to confirm its true identity and willingness to serve the client:</p>
<ul>
<li>Message H: The timestamp found in client’s Authenticator (sometimes modified, depending upon the version of Kerberos being used), encrypted using the <em>Client/Server Session Key</em>.</li>
</ul>
</li>
<li>
<p>The client decrypts the confirmation (message H) using the <em>Client/Server Session Key</em> and checks whether the timestamp is correct. If so, then the client can trust the server and can start issuing service requests to the server.</p>
</li>
<li>
<p>The server provides the requested services to the client.</p>
</li>
</ol>
<h2 id="exploitation">Exploitation<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#exploitation" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="kirbi-files">.kirbi files<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#kirbi-files" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>There’s a bit of terminology creep when discussing Kerberos tickets. <a href="../spells/Mimikatz" class="internal" data-slug="spells/Mimikatz">Mimikatz</a> and <a href="../spells/Rubeus" class="internal" data-slug="spells/Rubeus">Rubeus</a> are actually dumping Kerberos data structures (as .kirbi files), which contain <em>both</em> a ticket <em>and</em> the corresponding session key. People tend to call these .kirbi files “tickets”, but it’s worth keeping in mind that they contain <em>both</em> pieces of data (as a “ticket” in the Kerberos sense, not the hacker’s sense, isn’t useful without the corresponding session key).</p>
<h3 id="kerberoasting">Kerberoasting<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#kerberoasting" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="Kerberoasting" data-block data-embed-alias="undefined"><h1>Kerberoasting</h1><p>Kerberoasting is where a service ticket is used to brute force a service password. This password can then be used to either move laterally or (if the service runs with elevated privileges) to elevate your privileges. Note that not every account is kerberoastable; the Kali Linux tool Bloodhound can be used to identify potentially kerberoastable accounts.</p>
<h2 id="impacket">Impacket<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#impacket" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="Kerberoasting-with-Impacket" data-block data-embed-alias="undefined"><h1>Kerberoasting with Impacket</h1><p><a href="../spells/Kerberoasting-with-Impacket/../../spells/Impacket" class="internal" data-slug="spells/Impacket">Impacket</a> can identify kerberoastable accounts and dump packets remotely. It comes standard with Kali Linux.</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetUserSPNs.py</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${DOMAIN}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">${USER}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">${PASSWORD} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	-dc-ip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $DOMAIN_CONTROLLER_IP </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-request</span></span></code></pre></figure>
<p>The password hashes output here can then be cracked with <a href="../spells/Kerberoasting-with-Impacket/../../spells/Hashcat" class="internal" data-slug="spells/Hashcat">Hashcat</a> (use the 13100 hash mode).</p><a href="../spells/Kerberoasting/../../spells/Kerberoasting-with-Impacket" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="rubeus">Rubeus<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#rubeus" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="Kerberoasting-with-Rubeus" data-block data-embed-alias="undefined"><h1>Kerberoasting with Rubeus</h1><figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="github-light github-dark"><code data-language="powershell" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Extract password hashes for all known kerberoastable accounts using</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Rubeus.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Rubeus.exe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kerberoast</span></span></code></pre></figure>
<p>The password hashes output here can then be cracked with <a href="../spells/Kerberoasting-with-Rubeus/../../spells/Hashcat" class="internal" data-slug="spells/Hashcat">Hashcat</a> (use the 13100 hash mode).</p><a href="../spells/Kerberoasting/../../spells/Kerberoasting-with-Rubeus" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="invoke-kerberoast">Invoke-Kerberoast<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#invoke-kerberoast" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>The <a href="https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-Kerberoast.ps1" class="external" target="_blank"><code>Invoke-Kerberoast</code><svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> PowerShell module can be used to create a dump of service tickets that can then be attacked offline using <a href="../spells/Kerberoasting/../../spells/Hashcat" class="internal" data-slug="spells/Hashcat">Hashcat</a> or <a href="../spells/Kerberoasting/../../spells/John-the-Ripper" class="internal alias" data-slug="spells/John-the-Ripper">John the Ripper</a>. (Note that calling Out-File with the <code>-Width 8000</code> option is important in the below example, as otherwise the ticket can be truncated!)</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="github-light github-dark"><code data-language="powershell" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Invoke-Kerberoast</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OutputFormat Hashcat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	Select-Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Hash </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	Out-File</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filepath </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$FILE_PATH</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Width </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span></span></code></pre></figure>
<h2 id="defenses">Defenses<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#defenses" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>The main defenses against kerberoasting are (1) strong passwords and (2) making sure you’re not running any services as domain admin (which you shouldn’t need to do in this day and age anyway).</p><a href="../spells/Kerberoasting" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="as-rep-roasting">AS-REP roasting<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#as-rep-roasting" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="AS-REP-roasting" data-block data-embed-alias="undefined"><h1>AS-REP roasting</h1><p>AES-REP roasting is basically <a href="../spells/AS-REP-roasting/../../spells/Kerberoasting" class="internal" data-slug="spells/Kerberoasting">Kerberoasting</a> for regular user accounts. The only requirement to roast a user account is that <a href="../spells/AS-REP-roasting/../../spells/Kerberos" class="internal" data-slug="spells/Kerberos">Kerberos</a> pre-authentication is disable.</p>
<p>(When pre-authentication is disabled, the authentication server will supply a ticket granting ticket and a session key automatically when requested, <em>without first verifying the user</em>. This data is then stored offline by the Windows machine for later decryption when the user with pre-authentication disabled logs in. But this means that all we need to do is to break the user’s <a href="../spells/AS-REP-roasting/../../spells/NTLM-hashes" class="internal alias" data-slug="spells/NTLM-hashes">NT hash</a>!)</p>
<h2 id="as-rep-roasting-using-impacket">AS-REP Roasting Using Impacket<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#as-rep-roasting-using-impacket" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="AS-REP-roasting-with-Impacket" data-block data-embed-alias="undefined"><h1>AS-REP roasting with Impacket</h1><p><a href="../spells/AS-REP-roasting-with-Impacket/../../spells/Impacket" class="internal" data-slug="spells/Impacket">Impacket</a> (via GetNPUsers.py) support <a href="../spells/AS-REP-roasting-with-Impacket/../../spells/AS-REP-roasting" class="internal alias" data-slug="spells/AS-REP-roasting">AS-REP roasting</a>. However, GetNPUsers.py requires that user accounts already be enumerated and roastable accounts identified.</p>
<p>When using GetNPUsers.py, specify the target as <code>${DOMAIN}/</code> (i.e., leave off the user-part).</p><a href="../spells/AS-REP-roasting/../../spells/AS-REP-roasting-with-Impacket" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="as-rep-roasting-using-rubeus">AS-REP Roasting Using Rubeus<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#as-rep-roasting-using-rubeus" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="AS-REP-roasting-With-Rubeus" data-block data-embed-alias="undefined"><h1>AS-REP roasting With Rubeus</h1><figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="github-light github-dark"><code data-language="powershell" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AS-REP roasting with Rubeus.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Rubeus.exe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> asreproast</span></span></code></pre></figure>
<p>To use <a href="../spells/AS-REP-roasting-With-Rubeus/../../spells/Hashcat" class="internal" data-slug="spells/Hashcat">Hashcat</a> to crack the hashes obtained in this fashion, first insert <code>23$</code> after the leading <code>$kerb5asrep$</code> (so <code>$kerb5asrep$</code> > <code>$kerb5asrep$23$</code>) and then use mode 18200.</p><a href="../spells/AS-REP-roasting/../../spells/AS-REP-roasting-With-Rubeus" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="defenses">Defenses<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#defenses" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Basically the only mitigation for this attack is to keep pre-authentication enabled, though strong password policies can help.</p><a href="../spells/AS-REP-roasting" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h3 id="pass-the-ticket-attacks">Pass the ticket attacks<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#pass-the-ticket-attacks" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>The only real way to defend against this attack is to <em>only</em> allow domain admins to log into domain controllers, <em>not</em> lower privileged machines!</p>
<h3 id="goldensilver-ticket-attacks">Golden/silver ticket attacks<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#goldensilver-ticket-attacks" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p></p><blockquote class="transclude" data-url="Golden-and-silver-ticket-attacks" data-block data-embed-alias="undefined"><h1>Golden and silver ticket attacks</h1><p>The idea with <a href="../spells/Golden-and-silver-ticket-attacks/../../spells/Kerberos" class="internal" data-slug="spells/Kerberos">Kerberos</a> <a href="https://en.hackndo.com/kerberos-silver-golden-tickets/" class="external" target="_blank">gold and silver tickets<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> is that, since the KDC and service long term secret keys are just the NT hashes of the corresponding service account’s passwords, then if you can dump the password (or even its hash), you can <em>forge</em> a Kerberos ticket without ever needing to contact the KDC.</p>
<p>Silver tickets are forged using a service account’s NT hash, and can be used to grant any user access to that service. This works because Kerberos implicitly assumes that <em>only</em> the KDC and the service account know the service account’s long term secret key.</p>
<p>Golden tickets take things a step further - if you can get the krbtgt <em>user</em>’s NT hash, then you can forge a ticket granting ticket for any user, and then use that to get the KDC to provide a valid service ticket for any service that user has access to. This works because Kerberos trusts the encrypted ticket granting ticket blob and <em>doesn’t reauthenticate the user before granting further access</em>.</p>
<p>Golden tickets are powerful (since you can be anyone, it’s trivial to gain control of the domain), but also noisier - because you’re running through the KDC infrastructure, <a href="https://blog.quest.com/golden-ticket-attacks-how-they-work-and-how-to-defend-against-them/" class="external" target="_blank">golden ticket still generate (almost) all of the normal logging, while silver tickets allow you to bypass the KDC completely and only generate logs on the service server (if that)<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>.</p><a href="../spells/Golden-and-silver-ticket-attacks" class="internal transclude-src">Link to original</a></blockquote><p></p></article><hr/><div class="page-footer"><div class="backlinks"><h3>Backlinks</h3><ul id="list-0" class="overflow"><li><a href="../journals/2021-11-04" class="internal">Basic pentesting</a></li><li><a href="../journals/2021-12-07" class="internal">Ice</a></li><li><a href="../journals/2021-12-30" class="internal">Attacktive Directory</a></li><li><a href="../spells/AS-REP-roasting" class="internal">AS-REP roasting</a></li><li><a href="../spells/Enumerate-AD-CS-templates-with-CertUtil" class="internal">Enumerate AD CS templates with CertUtil</a></li><li><a href="../spells/Golden-and-silver-ticket-attacks" class="internal">Golden and silver ticket attacks</a></li><li><a href="../spells/Hashcat" class="internal">Hashcat</a></li><li><a href="../spells/Mimikatz" class="internal">Mimikatz</a></li><li><a href="../spells/Rubeus" class="internal">Rubeus</a></li><li><a href="../spells/SSH" class="internal">SSH</a></li><li class="overflow-end"></li></ul></div></div></div><div class="right sidebar"><div class="flex-component" style="flex-direction: row; flex-wrap: nowrap; gap: 1rem;"><div style="flex-grow: 1; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><div class="search"><button class="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div class="search-container"><div class="search-space"><input autocomplete="off" class="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div class="search-layout" data-preview="true"></div></div></div></div></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div></div><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div class="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false,&quot;enableRadial&quot;:false}"></div><button class="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div class="global-graph-outer"><div class="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.2,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true,&quot;enableRadial&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" class="toc-header" aria-controls="toc-content" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><ul class="toc-content overflow" id="list-1"><li class="depth-0"><a href="#terminology" data-for="terminology">Terminology</a></li><li class="depth-0"><a href="#authentication-process" data-for="authentication-process">Authentication process</a></li><li class="depth-0"><a href="#client-authentication-to-the-kdc-aka-pre-authentication" data-for="client-authentication-to-the-kdc-aka-pre-authentication">Client authentication to the KDC (a.k.a. “pre-authentication”)</a></li><li class="depth-0"><a href="#client-service-authorization" data-for="client-service-authorization">Client service authorization</a></li><li class="depth-0"><a href="#client-service-access" data-for="client-service-access">Client service access</a></li><li class="depth-0"><a href="#exploitation" data-for="exploitation">Exploitation</a></li><li class="depth-1"><a href="#kirbi-files" data-for="kirbi-files">.kirbi files</a></li><li class="depth-1"><a href="#kerberoasting" data-for="kerberoasting">Kerberoasting</a></li><li class="depth-1"><a href="#as-rep-roasting" data-for="as-rep-roasting">AS-REP roasting</a></li><li class="depth-1"><a href="#pass-the-ticket-attacks" data-for="pass-the-ticket-attacks">Pass the ticket attacks</a></li><li class="depth-1"><a href="#goldensilver-ticket-attacks" data-for="goldensilver-ticket-attacks">Golden/silver ticket attacks</a></li><li class="overflow-end"></li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.5.1</a> © 2025</p><ul><li><a href="/">Home</a></li><li><a href="https://github.com/necopinus/resume/raw/main/resume.pdf">Resume</a></li><li><a href="/#contact">Contact</a></li><li><a href="/grimoire/index.xml">RSS Feed</a></li></ul></footer></div></div></body><script type="application/javascript">function n(){let t=this.parentElement;t.classList.toggle("is-collapsed");let e=t.getElementsByClassName("callout-content")[0];if(!e)return;let l=t.classList.contains("is-collapsed");e.style.gridTemplateRows=l?"0fr":"1fr"}function c(){let t=document.getElementsByClassName("callout is-collapsible");for(let e of t){let l=e.getElementsByClassName("callout-title")[0],s=e.getElementsByClassName("callout-content")[0];if(!l||!s)continue;l.addEventListener("click",n),window.addCleanup(()=>l.removeEventListener("click",n));let o=e.classList.contains("is-collapsed");s.style.gridTemplateRows=o?"0fr":"1fr"}}document.addEventListener("nav",c);
</script><script type="module">function f(i,e){if(!i)return;function r(o){o.target===this&&(o.preventDefault(),o.stopPropagation(),e())}function t(o){o.key.startsWith("Esc")&&(o.preventDefault(),e())}i?.addEventListener("click",r),window.addCleanup(()=>i?.removeEventListener("click",r)),document.addEventListener("keydown",t),window.addCleanup(()=>document.removeEventListener("keydown",t))}function y(i){for(;i.firstChild;)i.removeChild(i.firstChild)}var h=class{constructor(e,r){this.container=e;this.content=r;this.setupEventListeners(),this.setupNavigationControls(),this.resetTransform()}isDragging=!1;startPan={x:0,y:0};currentPan={x:0,y:0};scale=1;MIN_SCALE=.5;MAX_SCALE=3;cleanups=[];setupEventListeners(){let e=this.onMouseDown.bind(this),r=this.onMouseMove.bind(this),t=this.onMouseUp.bind(this),o=this.resetTransform.bind(this);this.container.addEventListener("mousedown",e),document.addEventListener("mousemove",r),document.addEventListener("mouseup",t),window.addEventListener("resize",o),this.cleanups.push(()=>this.container.removeEventListener("mousedown",e),()=>document.removeEventListener("mousemove",r),()=>document.removeEventListener("mouseup",t),()=>window.removeEventListener("resize",o))}cleanup(){for(let e of this.cleanups)e()}setupNavigationControls(){let e=document.createElement("div");e.className="mermaid-controls";let r=this.createButton("+",()=>this.zoom(.1)),t=this.createButton("-",()=>this.zoom(-.1)),o=this.createButton("Reset",()=>this.resetTransform());e.appendChild(t),e.appendChild(o),e.appendChild(r),this.container.appendChild(e)}createButton(e,r){let t=document.createElement("button");return t.textContent=e,t.className="mermaid-control-button",t.addEventListener("click",r),window.addCleanup(()=>t.removeEventListener("click",r)),t}onMouseDown(e){e.button===0&&(this.isDragging=!0,this.startPan={x:e.clientX-this.currentPan.x,y:e.clientY-this.currentPan.y},this.container.style.cursor="grabbing")}onMouseMove(e){this.isDragging&&(e.preventDefault(),this.currentPan={x:e.clientX-this.startPan.x,y:e.clientY-this.startPan.y},this.updateTransform())}onMouseUp(){this.isDragging=!1,this.container.style.cursor="grab"}zoom(e){let r=Math.min(Math.max(this.scale+e,this.MIN_SCALE),this.MAX_SCALE),t=this.content.getBoundingClientRect(),o=t.width/2,n=t.height/2,c=r-this.scale;this.currentPan.x-=o*c,this.currentPan.y-=n*c,this.scale=r,this.updateTransform()}updateTransform(){this.content.style.transform=`translate(${this.currentPan.x}px, ${this.currentPan.y}px) scale(${this.scale})`}resetTransform(){this.scale=1;let e=this.content.querySelector("svg");this.currentPan={x:e.getBoundingClientRect().width/2,y:e.getBoundingClientRect().height/2},this.updateTransform()}},C=["--secondary","--tertiary","--gray","--light","--lightgray","--highlight","--dark","--darkgray","--codeFont"],E;document.addEventListener("nav",async()=>{let e=document.querySelector(".center").querySelectorAll("code.mermaid");if(e.length===0)return;E||=await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.esm.min.mjs");let r=E.default,t=new WeakMap;for(let n of e)t.set(n,n.innerText);async function o(){for(let s of e){s.removeAttribute("data-processed");let a=t.get(s);a&&(s.innerHTML=a)}let n=C.reduce((s,a)=>(s[a]=window.getComputedStyle(document.documentElement).getPropertyValue(a),s),{}),c=document.documentElement.getAttribute("saved-theme")==="dark";r.initialize({startOnLoad:!1,securityLevel:"loose",theme:c?"dark":"base",themeVariables:{fontFamily:n["--codeFont"],primaryColor:n["--light"],primaryTextColor:n["--darkgray"],primaryBorderColor:n["--tertiary"],lineColor:n["--darkgray"],secondaryColor:n["--secondary"],tertiaryColor:n["--tertiary"],clusterBkg:n["--light"],edgeLabelBackground:n["--highlight"]}}),await r.run({nodes:e})}await o(),document.addEventListener("themechange",o),window.addCleanup(()=>document.removeEventListener("themechange",o));for(let n=0;n<e.length;n++){let v=function(){let g=l.querySelector("#mermaid-space"),m=l.querySelector(".mermaid-content");if(!m)return;y(m);let w=c.querySelector("svg").cloneNode(!0);m.appendChild(w),l.classList.add("active"),g.style.cursor="grab",u=new h(g,m)},M=function(){l.classList.remove("active"),u?.cleanup(),u=null},c=e[n],s=c.parentElement,a=s.querySelector(".clipboard-button"),d=s.querySelector(".expand-button"),p=window.getComputedStyle(a),L=a.offsetWidth+parseFloat(p.marginLeft||"0")+parseFloat(p.marginRight||"0");d.style.right=`calc(${L}px + 0.3rem)`,s.prepend(d);let l=s.querySelector("#mermaid-container");if(!l)return;let u=null;d.addEventListener("click",v),f(l,M),window.addCleanup(()=>{u?.cleanup(),d.removeEventListener("click",v)})}});
</script><script src="../postscript.js" type="module"></script></html>